<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Video Game Design 4 | Unity Animation Case Study</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Video Game Design 4 | Unity Animation Case Study</h1>
</header>
<section data-field="subtitle" class="p-summary">
Series: Video Game Design
</section>
<section data-field="body" class="e-content">
<section name="97b7" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="de0b" id="de0b" class="graf graf--h3 graf--leading graf--title">Video Game Design 4 | Unity Animation Case¬†Study</h3><figure name="ff2c" id="ff2c" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*3kkosyhy-VqfbpYE.png" data-width="1216" data-height="672" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*3kkosyhy-VqfbpYE.png"></figure><ol class="postList"><li name="4544" id="4544" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Unity Interactive Animation</strong></li></ol><p name="7c4f" id="7c4f" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(1) Clone the Unity Template</strong></p><p name="b152" id="b152" class="graf graf--p graf-after--p">Before we start, let‚Äôs first clone the template <code class="markup--code markup--p-code">CS4455_M1_Support</code> from GitHub. You can find it <a href="https://github.gatech.edu/IMTC/CS4455_M1_Support" data-href="https://github.gatech.edu/IMTC/CS4455_M1_Support" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>. Note that we must have the GitHub enterprise account for Gatech before we clone this file.</p><p name="f5bd" id="f5bd" class="graf graf--p graf-after--p">After having cloned this template, we can open it as a project through Unity Hub.</p><p name="dca5" id="dca5" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(2) Default Scene</strong></p><p name="1db7" id="1db7" class="graf graf--p graf-after--p">Before we talk about the animations, let‚Äôs first play through the template so that we can know what it goes by default. Let‚Äôs hit the play button of the game,</p><figure name="2e69" id="2e69" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*IXqTJbUSsgNwnmOO3HTdJA.png" data-width="1600" data-height="894" src="https://cdn-images-1.medium.com/max/800/1*IXqTJbUSsgNwnmOO3HTdJA.png"></figure><p name="143f" id="143f" class="graf graf--p graf-after--figure">We can notice there are four characters, two humanoids (rigged skeletal animated mesh models), and two minions (Unity primitive objects). Actually, we have different movement approaches for these objects and we would like to move them around.</p><p name="91a9" id="91a9" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(3) Problems for the First Humanoid</strong></p><p name="d89c" id="d89c" class="graf graf--p graf-after--p">We can press WASD to move the first humanoid around, and we can also press T to switch among different characters. In addition, we can change the speed of each character by the number keys 1 (minimum speed) to 9 (maximum speed). The key 0 means the full speed, which is the default speed we have for each character. We can find out that the movement of the first humanoid doesn‚Äôt seem that good, and we can see,</p><ul class="postList"><li name="5c87" id="5c87" class="graf graf--li graf-after--p">Weird feet: the feet slide on the ground</li><li name="925a" id="925a" class="graf graf--li graf-after--li">Skating on ice: if we have a slower speed (‚â§ 6), it seems like we are skating on ice</li><li name="4fa7" id="4fa7" class="graf graf--li graf-after--li">Turn: not so good</li><li name="7248" id="7248" class="graf graf--li graf-after--li">No root motion</li></ul><p name="b62c" id="b62c" class="graf graf--p graf-after--li">If we press T and check another humanoid, things will be a lot better for us because we have embedded root motion for this character.</p><p name="3a39" id="3a39" class="graf graf--p graf-after--p">The downside of root motion is that sometimes character control can be less responsive because one needs to wait for animations to accomplish the desired movement rather than just immediately executing a translation or rotation. It‚Äôs quite common to use root motion for translation but use programmatic rotation for turning. In fact, a lot of Unity demos you find online use this hybrid approach as a compromise.</p><p name="ad2c" id="ad2c" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(4) Minion Movements</strong></p><p name="c485" id="c485" class="graf graf--p graf-after--p">We have also have a look at the movements of two minions. It is quite easy to see that the first minion moves with a jumping motion and the second one is only sliding.</p><p name="1b89" id="1b89" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(5) Open Animation and Animator Window</strong></p><p name="2bc4" id="2bc4" class="graf graf--p graf-after--p">Select Window &gt; Animation &gt; Animation and Window &gt; Animation &gt; Animator to open both the animation and the animator windows in the view. So that we can check out how different animation works for different characters.</p><figure name="9858" id="9858" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*t_nB5ATdqW138JZxoMnOEg.png" data-width="2788" data-height="1442" src="https://cdn-images-1.medium.com/max/800/1*t_nB5ATdqW138JZxoMnOEg.png"></figure><p name="94f4" id="94f4" class="graf graf--p graf-after--figure">If would be better to use if we put them in a new window next to the current Scene view. You can make it by select and drag the Animation and Animator window tag to the position you want. We can put the Hierarchy window next to the Assets below.</p><figure name="b1f5" id="b1f5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*GnTUflwTjiGQeKolcTtosQ.png" data-width="2788" data-height="1442" src="https://cdn-images-1.medium.com/max/800/1*GnTUflwTjiGQeKolcTtosQ.png"></figure><p name="d0c6" id="d0c6" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(6) Character Input Controller</strong></p><p name="0d57" id="0d57" class="graf graf--p graf-after--p">We have played the game and we can use WASD or the arrows to move. In addition, we can hit numerical keys 1‚Äì9 and 0 to change max speeds. 0 is full speed (default). 1 is slowest (10% of full). The keys in-between change the max speed in increments of 10%. Also, Q and E can be used for 50% turn rates.</p><p name="fabc" id="fabc" class="graf graf--p graf-after--p">However, which file controls all of this? This special input code can be found in Project: <code class="markup--code markup--p-code">Assets/Scripts/CharacterControl/CharacterInputController</code>.</p><p name="e1e2" id="e1e2" class="graf graf--p graf-after--p">At the beginning, we should setup <code class="markup--code markup--p-code">h</code> variable as our horizontal (left and right key) input axis, and also setup <code class="markup--code markup--p-code">v</code> variables as our vertical (up and down keys) input axis. We can do filtering here instead of the <code class="markup--code markup--p-code">InputManager</code> by <code class="markup--code markup--p-code">GetAxisRaw</code> function.</p><pre name="3a8a" id="3a8a" class="graf graf--pre graf-after--p">float h = Input.GetAxisRaw(&quot;Horizontal&quot;);<br>float v = Input.GetAxisRaw(&quot;Vertical&quot;);</pre><p name="3c6c" id="3c6c" class="graf graf--p graf-after--pre">If we have to map a square coordinate to a circular, we have to do the following calculation and you can find a proof <a href="http://mathproofs.blogspot.com/2005/07/mapping-square-to-circle.html" data-href="http://mathproofs.blogspot.com/2005/07/mapping-square-to-circle.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>,</p><pre name="a28e" id="a28e" class="graf graf--pre graf-after--p">h = h * Mathf.Sqrt(1f - 0.5f * v * v);<br>v = v * Mathf.Sqrt(1f - 0.5f * h * h);</pre><p name="84f1" id="84f1" class="graf graf--p graf-after--pre">Also, we have to define the letter keys. We can use <code class="markup--code markup--p-code">Input.GetKey</code> for getting the values from the keyboard. If we find Q, E, or other numbers, we have to assign the corresponding values. For example,</p><pre name="3b38" id="3b38" class="graf graf--pre graf-after--p">Input.GetKey(KeyCode.Q)<br>Input.GetKey(KeyCode.E)<br>Input.GetKeyUp(KeyCode.Alpha1)<br>...<br>Input.GetKeyUp(KeyCode.Alpha0)</pre><p name="29c7" id="29c7" class="graf graf--p graf-after--pre">Finally, we should do some filtering of our input as well as clamp to a speed limit. We have to call <code class="markup--code markup--p-code">Math.Clamp</code> and <code class="markup--code markup--p-code">Mathf.Lerp</code> for the final result,</p><pre name="c3de" id="c3de" class="graf graf--pre graf-after--p">filteredForwardInput = Mathf.Clamp(Mathf.Lerp(filteredForwardInput, v, Time.deltaTime * forwardInputFilter), -forwardSpeedLimit, forwardSpeedLimit);<br>filteredTurnInput = Mathf.Lerp(filteredTurnInput, h, Time.deltaTime * turnInputFilter);</pre><p name="62c9" id="62c9" class="graf graf--p graf-after--pre">In the end, let‚Äôs update the position by,</p><pre name="562f" id="562f" class="graf graf--pre graf-after--p">Forward = filteredForwardInput;<br>Turn = filteredTurnInput;</pre><p name="e833" id="e833" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(7) Root Motion for the Humanoid</strong></p><p name="9423" id="9423" class="graf graf--p graf-after--p">We have talked about the root motion previously, and now let‚Äôs analyze it in details. In project, we have two GameObject named <code class="markup--code markup--p-code">SomeDude_NoRootMotion</code> (1st humanoid) and <code class="markup--code markup--p-code">SomeDude_RootMotion</code> (2nd humanoid) respectively. We have seen that the humanoid with root motion looks better especially with different speeds. This is because the root motion animation allows translations and rotations to <strong class="markup--strong markup--p-strong">slightly speed up or slow down</strong>, coinciding with natural movement. This gives the feet of the model a much more planted and realistic look.</p><p name="78c2" id="78c2" class="graf graf--p graf-after--p">However, the downside of root motion is that sometimes character control can be less responsive because one needs to wait for animations to accomplish the desired movement rather than just immediately executing a translation or rotation. It‚Äôs quite common to use root motion for translation but use programmatic rotation for turning. In fact, a lot of Unity demos you find online use this hybrid approach as a compromise.</p><p name="af70" id="af70" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(8) Better Movement for the 1st Humanoid</strong></p><p name="c764" id="c764" class="graf graf--p graf-after--p">In <code class="markup--code markup--p-code">SomeDude_NoRootMotion</code>‚Äôs control script, try disabling the code that sends the rotation input to the animator and test it out. The script for controlling <code class="markup--code markup--p-code">SomeDude_NoRootMotion</code> is the file <code class="markup--code markup--p-code">BasicControlScript.cs</code>. In this file, the corresponding lines for updating the inputs are lines 101 to 103,</p><pre name="0e56" id="0e56" class="graf graf--pre graf-after--p">101 anim.SetFloat(&quot;velx&quot;, inputTurn); <br>102 anim.SetFloat(&quot;vely&quot;, inputForward);<br>103 anim.SetBool(&quot;isFalling&quot;, !isGrounded);</pre><p name="9f6d" id="9f6d" class="graf graf--p graf-after--pre">And the line 101 is what we want to find because it controls the rotation input (i.e. <code class="markup--code markup--p-code">inputTurn</code>). We have to disable this code by,</p><pre name="69a0" id="69a0" class="graf graf--pre graf-after--p">// anim.SetFloat(&quot;velx&quot;, inputTurn);</pre><p name="aef7" id="aef7" class="graf graf--p graf-after--pre">Then save and replay the game. Now, you will probably find that this looks better. Without the subtle root motion corrections, the leaning into the turn is very hard to get to where it looks good using programmatic control. In this case, simply not using turn animations is often better.</p><p name="ad2a" id="ad2a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(9) Running Animations for the 2nd Humanoid</strong></p><p name="5d44" id="5d44" class="graf graf--p graf-after--p">Now let‚Äôs look into making <code class="markup--code markup--p-code">SomeDude_RootMotion</code> more capable by adding some run animations. Since he can only move as fast as the animations allow, run animations will really help him out.</p><p name="edb4" id="edb4" class="graf graf--p graf-after--p">Let‚Äôs first select Hierarchy &gt; SomeDude_RootMotion, then go to the Animator view. Drill down into the Blend Tree-Forward state.</p><figure name="cf43" id="cf43" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*QxOm8g-93lxGB2dHhwW84A.png" data-width="2788" data-height="1442" src="https://cdn-images-1.medium.com/max/800/1*QxOm8g-93lxGB2dHhwW84A.png"></figure><p name="35a9" id="35a9" class="graf graf--p graf-after--figure">Select the Blend Tree and observe the <code class="markup--code markup--p-code">2D</code> Freeform Directional blendtree in the Inspector. You can press the Play button to see the movement of the skeleton. Also, you can drag the red dot üî¥ (like the thumbsticks) in the parameters view to see different animations.</p><figure name="770e" id="770e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mbKXOi5e0SGC_BHzPM48FQ.png" data-width="2788" data-height="1518" src="https://cdn-images-1.medium.com/max/800/1*mbKXOi5e0SGC_BHzPM48FQ.png"></figure><p name="6d00" id="6d00" class="graf graf--p graf-after--figure">Then let‚Äôs go back to the Basic Layer and select Groofy Blend Demo. Here we can see a demo of the running behavior. You can also observe the <code class="markup--code markup--p-code">2D</code> Freeform Directional blendtree in the Inspector.</p><figure name="3063" id="3063" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*iptV5EpYw3uDTXeMXtm_1g.png" data-width="2788" data-height="1518" src="https://cdn-images-1.medium.com/max/800/1*iptV5EpYw3uDTXeMXtm_1g.png"></figure><p name="504e" id="504e" class="graf graf--p graf-after--figure">Now, let‚Äôs go back to the Blend Tree-Forward state and see if we can add some running animations. You can find <code class="markup--code markup--p-code">Run</code>, <code class="markup--code markup--p-code">RunLeft</code>, and <code class="markup--code markup--p-code">RunRight</code> animations under ModelsAndAnimations &gt; Runs.</p><figure name="3897" id="3897" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*X-SZRdOveaOYrMEHBTRuzQ.png" data-width="2788" data-height="1654" src="https://cdn-images-1.medium.com/max/800/1*X-SZRdOveaOYrMEHBTRuzQ.png"></figure><p name="4192" id="4192" class="graf graf--p graf-after--figure">To add a running animation, we have to select the Blend Tree &gt; Inspector &gt; + &gt; Add Motion Field to create a new motion,</p><figure name="aa33" id="aa33" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*cYOfsMPae3NBn-LiOcO8JA.png" data-width="2788" data-height="1654" src="https://cdn-images-1.medium.com/max/800/1*cYOfsMPae3NBn-LiOcO8JA.png"></figure><p name="e3a0" id="e3a0" class="graf graf--p graf-after--figure">Then, we can drag the Run animation in ModelsAndAnimations to the Motion field we just created. We should also change the position of this newly created field. The Pos X of it should be 0 and the Pox Y of it should be 1. To make things even clear and to avoid conflicts, we also have to change the WalkForward movement with its Pos Y equals 1 to value 0.6. After this, we can drag and move the red dot again to see the running movements.</p><figure name="b1fe" id="b1fe" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*GGBcUGUWNOszrNxlCNeHqg.png" data-width="2788" data-height="1654" src="https://cdn-images-1.medium.com/max/800/1*GGBcUGUWNOszrNxlCNeHqg.png"></figure><p name="0e45" id="0e45" class="graf graf--p graf-after--figure">Once you get everything dialed in, run the game and test things out a bit. Now, you can see that the second humanoid can run by default, and if we change it to a lower speed, it will walk.</p><p name="3b6d" id="3b6d" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(10) Tricky Tweaks for Running Movements</strong></p><p name="9a15" id="9a15" class="graf graf--p graf-after--p">Next up, let‚Äôs see if we can add an extra degree of control over <code class="markup--code markup--p-code">SomeDude_RootMotion</code>‚Äôs animations. Since you probably don‚Äôt have the 3D animation software or motion capture hardware to revise the animations, you‚Äôll want to know about other methods of tweaking root motion. Basically, there are two ways for these settings,</p><ul class="postList"><li name="b357" id="b357" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Adjust animation Mecanim state Transitions</strong>: this is the first way to tweak the movements. We can configure it by clicking on the lines in the Base Layer, and then choose to modify Inspector &gt; Settings &gt; ExitTime, TransitionDuration and other settings.</li></ul><figure name="9f68" id="9f68" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*sdl1rJmx8ehgRgwmtP7e9Q.png" data-width="2790" data-height="1390" src="https://cdn-images-1.medium.com/max/800/1*sdl1rJmx8ehgRgwmtP7e9Q.png"></figure><p name="286b" id="286b" class="graf graf--p graf-after--figure">For instance, we can disable <code class="markup--code markup--p-code">ExitTime</code> for immediate animation transitions to speed up responsiveness. This can be done by uncheck the box of Has Exit Time. Also, the <code class="markup--code markup--p-code">TransitionDuration</code> (i.e. 0.2 in our example) can be shortened for the same purpose or increased to make cleaner and more realistic looking animations due to the blending.</p><ul class="postList"><li name="6450" id="6450" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Add some tweaks to the playback of animations</strong>: For example, with <code class="markup--code markup--li-code">SomeDude_RootMotion</code>, we can add three public member variable floats to the <code class="markup--code markup--li-code">RootMotionControlScript</code>: namely <code class="markup--code markup--li-code">animationSpeed</code>, <code class="markup--code markup--li-code">rootMovementSpeed</code>, and <code class="markup--code markup--li-code">rootTurnSpeed</code> (default values of 1f).</li></ul><p name="e99c" id="e99c" class="graf graf--p graf-after--li">In our template, we should go to open the script <code class="markup--code markup--p-code">RootMotionControlScript</code> and then modify its content. First of all, let‚Äôs add these three <code class="markup--code markup--p-code">public float</code> variables. I am going to add these after the line 27, which is,</p><pre name="fd43" id="fd43" class="graf graf--pre graf-after--p">27 public float exitMatchTargetsAnimTime = 0.75f;</pre><p name="dfa9" id="dfa9" class="graf graf--p graf-after--pre">After this line, we have to add,</p><pre name="0756" id="0756" class="graf graf--pre graf-after--p">30 public float animationSpeed = 1f;<br>31 public float rootMovementSpeed = 1f;<br>32 public float rootTurnSpeed = 1f;</pre><p name="40e5" id="40e5" class="graf graf--p graf-after--pre">Then in <code class="markup--code markup--p-code">FixedUpdate()</code> of the same script (<strong class="markup--strong markup--p-strong">NOT</strong> the <code class="markup--code markup--p-code">Update()</code> function), we can set the Animator Component‚Äôs speed to the animationSpeed scalar. Refer to Unity‚Äôs online documentation of the <code class="markup--code markup--p-code">speed</code> property of the Animator component. This will cause the entire Mecanim animation state machine and blendtrees to play faster or slower as animationSpeed is adjusted. A setting of <code class="markup--code markup--p-code">1f</code> is regular speed, <code class="markup--code markup--p-code">0.5f</code> is half speed and <code class="markup--code markup--p-code">2f</code> is twice as fast. I am going to put the code in the line 114.</p><pre name="9123" id="9123" class="graf graf--pre graf-after--p">114 anim.speed = animationSpeed;</pre><p name="fb19" id="fb19" class="graf graf--p graf-after--pre">Now modify <code class="markup--code markup--p-code">OnAnimatorMove()</code> in the same script to scale the difference in position and rotation from the previous frame (i.e. <code class="markup--code markup--p-code">this.transform</code>) as compared to the new candidate root motion pose.</p><p name="f79b" id="f79b" class="graf graf--p graf-after--p">It is recommended you accomplish this with <code class="markup--code markup--p-code">Vector3.LerpUnclamped()</code> and <code class="markup--code markup--p-code">Quaternion.LerpUnclamped()</code> using your two new scalars, <code class="markup--code markup--p-code">rootMovementSpeed</code> and <code class="markup--code markup--p-code">rootTurnSpeed</code>. You can refer to Unity‚Äôs online API documentation if you aren‚Äôt familiar with <code class="markup--code markup--p-code">Lerp</code> (linear interpolation/extrapolation).</p><p name="9925" id="9925" class="graf graf--p graf-after--p">To modify this function, let‚Äôs locate to,</p><pre name="9403" id="9403" class="graf graf--pre graf-after--p">220 //<strong class="markup--strong markup--pre-strong">TODO</strong> Here, you could scale the difference in position and rotation to make the character go faster or slower</pre><p name="1b43" id="1b43" class="graf graf--p graf-after--pre">And we have to add some codes after it. Here is an example of how to update the <code class="markup--code markup--p-code">newRootPosition</code> by <code class="markup--code markup--p-code">Vector3.LerpUnclamped</code>.</p><pre name="4d9e" id="4d9e" class="graf graf--pre graf-after--p">newRootPosition = Vector3.LerpUnclamped(this.transform.position, newRootPosition, rootMovementSpeed);</pre><p name="77e1" id="77e1" class="graf graf--p graf-after--pre">While you have to finish the function for updating the <code class="markup--code markup--p-code">newRootRotation</code> with the function <code class="markup--code markup--p-code">Quaternion.LerpUnclamped()</code> and public float variable <code class="markup--code markup--p-code">rootTurnSpeed</code> in a similar way. After you finished, you have to save the script for the project. Inside the project, we then select the GameObject <code class="markup--code markup--p-code">SomeDude_RootMotion</code>¬†. In its Inspector, we can change the public values of. Animation Speed, Root Movement Speed, and Root Turn Speed. Note that the recommended values for Animation Speed and Root Movement Speed is <code class="markup--code markup--p-code">1.1</code>¬†, and you have to try out a few times before you decide the value for Root Turn Speed.</p><figure name="e060" id="e060" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*I0kPp792mNMXyy82nh0w2g.png" data-width="2790" data-height="1390" src="https://cdn-images-1.medium.com/max/800/1*I0kPp792mNMXyy82nh0w2g.png"></figure><p name="eecf" id="eecf" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(11) Minions Movements Overview</strong></p><p name="abb2" id="abb2" class="graf graf--p graf-after--p">Next up are the minion characters. Both of the minions follow the same pattern as the humans with programmatic movement and root motion control. The trade-offs between the two types of movement aren‚Äôt nearly as noticeable since these particular minions don‚Äôt have feet (lost in a workplace accident).</p><p name="2489" id="2489" class="graf graf--p graf-after--p">One thing about the minions is that their model was made within Unity using primitive shapes. <strong class="markup--strong markup--p-strong">Mecanim</strong> is able to animate nearly any attribute of any GameObject. Creating new interactive characters like the minion example is really quite easy. The trick is to leverage the Hierarchy relationships between the GameObjects that make up a character and animate the relative poses. You can even use Mecanim to animate things that aren‚Äôt characters like elevators, drawbridges, etc.</p><p name="d9ef" id="d9ef" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(12) Minions No Root Motion Animations</strong></p><p name="76f4" id="76f4" class="graf graf--p graf-after--p">Let‚Äôs select <code class="markup--code markup--p-code">Minion_NoRootMotion</code> to see its Blend Tree-Forward,</p><figure name="717e" id="717e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*79PyF6UKxdLhQD1xLmVXOA.png" data-width="2790" data-height="1630" src="https://cdn-images-1.medium.com/max/800/1*79PyF6UKxdLhQD1xLmVXOA.png"></figure><p name="d570" id="d570" class="graf graf--p graf-after--figure">We can click on the Blend Tree, drag the red pointer in the Inspector &gt; Parameter, and then click on the Play button to check the animation in Blend Tree.</p><figure name="5156" id="5156" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*qJy8uzpIcEk1IqFNg85NjA.png" data-width="2790" data-height="1630" src="https://cdn-images-1.medium.com/max/800/1*qJy8uzpIcEk1IqFNg85NjA.png"></figure><p name="a3ce" id="a3ce" class="graf graf--p graf-after--figure">To check the animation of this GameObject <code class="markup--code markup--p-code">Minion_NoRootMotion</code>¬†, let‚Äôs first left-click on the Hierarchy &gt; <code class="markup--code markup--p-code">Minion_NoRootMotion</code>¬†, then select the Animation window.</p><figure name="2ad6" id="2ad6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*sBYLQB3AmauaVwI9nRubCw.png" data-width="2790" data-height="1630" src="https://cdn-images-1.medium.com/max/800/1*sBYLQB3AmauaVwI9nRubCw.png"></figure><p name="0ca0" id="0ca0" class="graf graf--p graf-after--figure">In particular, check out <code class="markup--code markup--p-code">Minion_NoRootMotion</code>‚Äôs Minion Forward No Root.</p><figure name="1131" id="1131" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hq1FCWbewsSDjEOh3YEr8A.png" data-width="2790" data-height="1630" src="https://cdn-images-1.medium.com/max/800/1*hq1FCWbewsSDjEOh3YEr8A.png"></figure><p name="b905" id="b905" class="graf graf--p graf-after--figure">We can either scrub through the timeline to see the animation progress through the keyframes or simply click on the Play button of the Animation tab to see the animation. This animation simply moves the minion up and down and rotates slightly around the Z axis.</p><figure name="177d" id="177d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*fTVHFzUe0VB1kxPn0d44uA.png" data-width="2790" data-height="1630" src="https://cdn-images-1.medium.com/max/800/1*fTVHFzUe0VB1kxPn0d44uA.png"></figure><p name="fbe8" id="fbe8" class="graf graf--p graf-after--figure">Now, let‚Äôs have a look at the key frames and see how we create the key frames. We can click on the MinionModel: Position and MinionModel: Rotation for the XYZ Position/Rotation of each key frame,</p><ul class="postList"><li name="87f6" id="87f6" class="graf graf--li graf-after--p">Key Frame 0: Position.x/y/z = 0, Rotation.x/y/z = 0</li><li name="b70c" id="b70c" class="graf graf--li graf-after--li">Key Frame 1: Position.y = 0.5, Rotation.z = 10</li><li name="5685" id="5685" class="graf graf--li graf-after--li">Key Frame 2: Position.x/y/z = 0, Rotation.x/y/z = 0</li><li name="2037" id="2037" class="graf graf--li graf-after--li">Key Frame 3: Position.y = 0.5, Rotation.z = -10</li><li name="868f" id="868f" class="graf graf--li graf-after--li">Key Frame 4: Position.x/y/z = 0, Rotation.x/y/z = 0</li></ul><p name="847a" id="847a" class="graf graf--p graf-after--li">If we look at the <code class="markup--code markup--p-code">curves</code> tab of the Animation, you can see that the interpolation between keyframes is not simply linear but follows a curve (defined by control tangents). The ability to control the tangents for keyframe interpolation is great for making nice animations.</p><figure name="2a4f" id="2a4f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*dC8C3dY87btTkik_YeUg8w.png" data-width="2790" data-height="1630" src="https://cdn-images-1.medium.com/max/800/1*dC8C3dY87btTkik_YeUg8w.png"></figure><p name="36d7" id="36d7" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(13) Minions Root Motion Animations</strong></p><p name="4271" id="4271" class="graf graf--p graf-after--p">Next, let‚Äôs check out <code class="markup--code markup--p-code">Minion_RootMotion</code>‚Äôs (the other one) Minion Forward and Minion Forward Turn Left animations. Minion Forward only defines a simple <code class="markup--code markup--p-code">Z</code> direction translation in a straight line. Minion Forward Turn Left rotates while moving forward and to the left along a curve. Note if you can not see the animations, play the game, try the movement of this minion, and then go back to see the animations. Ignore the <code class="markup--code markup--p-code">Missing!</code> stuff because it seems like an irrelevant issue for us.</p><figure name="b969" id="b969" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*PD70mIbAYDc-Z5OJrHhL-Q.png" data-width="2790" data-height="1630" src="https://cdn-images-1.medium.com/max/800/1*PD70mIbAYDc-Z5OJrHhL-Q.png"></figure><p name="f1fb" id="f1fb" class="graf graf--p graf-after--figure">You should also check out the <code class="markup--code markup--p-code">Curves</code> view to see what‚Äôs really going on. Setting the tangents lets us get away with only two keyframes to pull off a turn animation. You could of course add more keyframes and rely less on the tangents though.</p><p name="8282" id="8282" class="graf graf--p graf-after--p">By the way, the view controls of the <code class="markup--code markup--p-code">Curves</code> tabs of Animation is a bit cumbersome to navigate. You can zoom with a mouse scroll wheel or two-finger touchpad zoom. However, this zooms both axis equally. Hold down either SHIFT or COMMAND (maybe ALT on Windows) to zoom the axis independently¬†.</p><figure name="a4be" id="a4be" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nnlTAMqw1DLKaMak6l7vMg.png" data-width="2790" data-height="1588" src="https://cdn-images-1.medium.com/max/800/1*nnlTAMqw1DLKaMak6l7vMg.png"></figure><figure name="649e" id="649e" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*9a-Nf9p2_WkQGuSVHRM0Nw.png" data-width="2790" data-height="1588" src="https://cdn-images-1.medium.com/max/800/1*9a-Nf9p2_WkQGuSVHRM0Nw.png"></figure><p name="5411" id="5411" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(14) Creating Hopping Motion Animations for Minions</strong></p><p name="0caf" id="0caf" class="graf graf--p graf-after--p">Since <code class="markup--code markup--p-code">Minion_RootMotion</code>‚Äôs animation is pretty boring, add a hop and a twist to the movement of Minion Forward similar to Minion Forward No Root. You‚Äôll probably want to preserve the original Minion Forward in case you mess up. To make a duplicate animation, select the animation in the Project View and execute Edit &gt; Duplicate (or press Shift + D) to the Minion Forward animation and rename the new file to something appropriate like Minion Hop.</p><figure name="ac68" id="ac68" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*-KhuS--R_WkK17ZoWdn1dA.png" data-width="2790" data-height="1628" src="https://cdn-images-1.medium.com/max/800/1*-KhuS--R_WkK17ZoWdn1dA.png"></figure><p name="09b8" id="09b8" class="graf graf--p graf-after--figure">Note that if you can not view the current animation in the right-down corner, and the error is,</p><pre name="4e2b" id="4e2b" class="graf graf--pre graf-after--p">No model is available for preview.<br>Please drag a model into this Preview Area.</pre><p name="2fc1" id="2fc1" class="graf graf--p graf-after--pre">Then, you can directly drag the GameObject (e.g. <code class="markup--code markup--p-code">Minion_RootMotion</code>) from Hierarchy here if you want to view it in this position.</p><p name="c725" id="c725" class="graf graf--p graf-after--p">Before we edit the animation for hopping, make sure we have Minion Hop selected. Then in the Dopesheet view, we have to create some extra key frames. For example, we can right-click in the middle and select Add Key. We only have to add the key frames for MinionModel: Position and MinionModel: Rotation.</p><figure name="ee61" id="ee61" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*VzV3mA2nn0LXEQbihdc1KA.png" data-width="2790" data-height="1628" src="https://cdn-images-1.medium.com/max/800/1*VzV3mA2nn0LXEQbihdc1KA.png"></figure><p name="873d" id="873d" class="graf graf--p graf-after--figure">To add this hopping animation, we should change Position.y of the key frame in the current time to 1. Then we can click on the play button in the right-down corner to see this movement.</p><figure name="662c" id="662c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*dJoL8_clRB81YAw2E1Fj1Q.png" data-width="2790" data-height="1628" src="https://cdn-images-1.medium.com/max/800/1*dJoL8_clRB81YAw2E1Fj1Q.png"></figure><p name="cb87" id="cb87" class="graf graf--p graf-after--figure">Do the same with the Minion Forward Turn Left and Minion Forward Turn Right animations. Name these files <code class="markup--code markup--p-code">Minion Hop Turn Left</code> and <code class="markup--code markup--p-code">Minion Hop Turn Right</code>. Just makes sure all of them follow the same pattern. For instance, if the first hop leans to the left and the next leans to the right, you should replicate that in all three animations.</p><p name="c04d" id="c04d" class="graf graf--p graf-after--p">When adding new keyframes for the hopping, be sure to modify the minion model transform and not the root game object position (otherwise you‚Äôll mess up the capsule collider orientation). Also, you can add partial keyframes (only keyframing the parameters that are changing). If you add complete keyframes for all parameters you might end up messing up the curves for the root motion of the game object. After your configuration, the keyframes of all these three animation files should be looked like the ones below.</p><figure name="eb40" id="eb40" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*oLU2rfIcX2idjOozmsLVIA.png" data-width="1314" data-height="296" src="https://cdn-images-1.medium.com/max/800/1*oLU2rfIcX2idjOozmsLVIA.png"></figure><p name="1fc9" id="1fc9" class="graf graf--p graf-after--figure">Now test it out in the Basic Layer of Mecanim Animator <code class="markup--code markup--p-code">MinionAnimatorController</code>.</p><figure name="92ad" id="92ad" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*rUnfUYvM8T7vUY53SDriuw.png" data-width="2796" data-height="1558" src="https://cdn-images-1.medium.com/max/800/1*rUnfUYvM8T7vUY53SDriuw.png"></figure><p name="bcb1" id="bcb1" class="graf graf--p graf-after--figure">Change the forward blendtree‚Äôs referenced animations to your new ones with the hop.</p><figure name="e122" id="e122" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Q5O0mUT_l8tE8BZ2NIBMmg.png" data-width="2796" data-height="1558" src="https://cdn-images-1.medium.com/max/800/1*Q5O0mUT_l8tE8BZ2NIBMmg.png"></figure><p name="afd0" id="afd0" class="graf graf--p graf-after--figure">If the animations match well enough the hops should smoothly blend for any ratio of forward and turning. You should carefully check all the hops in case there are any mistakes.</p><p name="c39e" id="c39e" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(15) Creating Footstep Animation Events for Minions</strong></p><p name="5e00" id="5e00" class="graf graf--p graf-after--p">The other thing the minion needs are some squeaky footsteps like his brother. To accomplish this, let‚Äôs first check out the installed components on the <code class="markup--code markup--p-code">Minion_NoRootMotion</code> in the Inspector.</p><figure name="07f6" id="07f6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Stmem5YZ72gvTw5ey1o4iQ.png" data-width="2796" data-height="1558" src="https://cdn-images-1.medium.com/max/800/1*Stmem5YZ72gvTw5ey1o4iQ.png"></figure><p name="74bd" id="74bd" class="graf graf--p graf-after--figure">You should see that it has a <code class="markup--code markup--p-code">MinionFootstepEmitter</code> attached. Add that same script to <code class="markup--code markup--p-code">Minion_RootMotion</code>.</p><figure name="c8d1" id="c8d1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*b_xeiAJdNeEl4wu9u6sHiQ.png" data-width="2796" data-height="1558" src="https://cdn-images-1.medium.com/max/800/1*b_xeiAJdNeEl4wu9u6sHiQ.png"></figure><p name="383c" id="383c" class="graf graf--p graf-after--figure">Also, look at the actual script code. The script should be located in Scripts &gt; MinionSupport &gt; MinionFootstepEmitter. You‚Äôll notice that it implements a method <code class="markup--code markup--p-code">ExecuteFootstep()</code>. When called, this method generates an event that is consumed by the AudioEventManager, which plays the sound.</p><figure name="9577" id="9577" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*TzWKsXQV_bmsbjagN_yprw.png" data-width="2542" data-height="1558" src="https://cdn-images-1.medium.com/max/800/1*TzWKsXQV_bmsbjagN_yprw.png"></figure><p name="2dd2" id="2dd2" class="graf graf--p graf-after--figure">So where is the method <code class="markup--code markup--p-code">ExecuteFootstep()</code> actually called? Unity supports a feature called <strong class="markup--strong markup--p-strong">animation events</strong>. These are events that you can embed within an animation. When the event is triggered, Unity will call a callback method of your choice.</p><p name="0736" id="0736" class="graf graf--p graf-after--p">In the Animation view of Minion Forward (Now it should be changed to Minion Hop) and with the Dopesheet tab selected, click the ‚ÄúAdd Event‚Äù button (looks like a white pencil with a plus next to it). The new event will show up just below the timeline as a little pencil shape. Drag it left/right to wherever on the timeline the footstep should occur.</p><figure name="073d" id="073d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8OneLMdZ1lxervpWaKi3dQ.png" data-width="2792" data-height="1570" src="https://cdn-images-1.medium.com/max/800/1*8OneLMdZ1lxervpWaKi3dQ.png"></figure><p name="4117" id="4117" class="graf graf--p graf-after--figure">With the animation event selected (little pencil turns blue), select the <code class="markup--code markup--p-code">ExecuteFootstep()</code> callback in the Inspector view Function setting and send it to the <code class="markup--code markup--p-code">MinionFootstepEmitter</code> as the receiving Object. Also, add any more animation events you need for other footsteps (probably at least two).</p><figure name="7503" id="7503" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*o29bKrcY3DPwZ4iLvc8ZbQ.png" data-width="2792" data-height="1570" src="https://cdn-images-1.medium.com/max/800/1*o29bKrcY3DPwZ4iLvc8ZbQ.png"><figcaption class="imageCaption">Make Sure the animation is <strong class="markup--strong markup--figure-strong">Minion¬†Hop</strong></figcaption></figure><p name="d894" id="d894" class="graf graf--p graf-after--figure">If your footstep occurs at the very beginning of the animation, you don‚Äôt need one at the very end. This is because of the looping nature of the animation (beginning and end are essentially the same moment). Implementing footstep animation events only in Minion Forward (Now it should be changed to Minion Hop) is fine for now. If all the things are correct, we are expected to hear squeaky footstep sound events to our forward animation.</p><p name="66da" id="66da" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(16) Inverse Kinematic for Pressing Button</strong></p><p name="c405" id="c405" class="graf graf--p graf-after--p">Now we are going to go back to <code class="markup--code markup--p-code">SomeDude_RootMotion</code>. You may have noticed a stick with a red ball on it just ahead of the character. You are now going to leverage Unity‚Äôs Inverse Kinematic (IK) features so that the character can press the red ball as if it is a button.</p><p name="600b" id="600b" class="graf graf--p graf-after--p">If you run the game and select <code class="markup--code markup--p-code">SomeDude_RootMotion</code>, you can press the ‚ÄúFire1‚Äù button to execute a button pressing animation. But it only works if you get SomeDude_RootMotion perfectly placed on the blue marker and facing the button. On a keyboard ‚ÄúFire1‚Äù should be the Left-Control key. Otherwise, you can check Unity‚Äôs InputManager setting to see what mapping is configured. To view the InputManager, we should select Edit &gt; Project Settings &gt; Input Manager &gt; Fire 1 &gt; Positive Button.</p><figure name="b469" id="b469" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3TxR1134xBLKLcbclmOrFg.png" data-width="1888" data-height="1262" src="https://cdn-images-1.medium.com/max/800/1*3TxR1134xBLKLcbclmOrFg.png"></figure><p name="bc75" id="bc75" class="graf graf--p graf-after--figure">This distance/angle constraint is already implemented for you. Many games will only allow a character to interact with something if they are close enough. This constraint is implemented via a reference to a buttonPressStandingSpot object (the blue marker in the scene) and conditional evaluation of <code class="markup--code markup--p-code">buttonDistance</code> and <code class="markup--code markup--p-code">buttonAngleDegrees</code> in <code class="markup--code markup--p-code">FixedUpdate()</code> of <code class="markup--code markup--p-code">RootMotionController.cs</code>.</p><p name="a7ed" id="a7ed" class="graf graf--p graf-after--p">Take a look at <code class="markup--code markup--p-code">SomeDude_RootMotion</code>‚Äôs Animator Controller state machine. You will see that there are two transition paths through the state machine that lead to the ButtonPress state. Either a transition directly from the following two paths,</p><ul class="postList"><li name="d533" id="d533" class="graf graf--li graf--startsWithDoubleQuote graf-after--p">‚ÄúIdle Turn‚Äù &gt; ‚ÄúButtonPress‚Äù</li><li name="ee03" id="ee03" class="graf graf--li graf--startsWithDoubleQuote graf-after--li">‚ÄúIdle Turn‚Äù &gt; ‚ÄúMatchToButtonPress‚Äù &gt; ‚ÄúButtonPress‚Äù</li></ul><figure name="4666" id="4666" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*S-VHcMGhkUTMUa_dA9Ukdw.png" data-width="900" data-height="510" src="https://cdn-images-1.medium.com/max/800/1*S-VHcMGhkUTMUa_dA9Ukdw.png"></figure><p name="0b08" id="0b08" class="graf graf--p graf-after--figure">The reason for this is that we want SomeDude to immediately press the button if he is perfectly aligned but if not, then he will move into alignment first via <code class="markup--code markup--p-code">MatchToButtonPress</code>. The <code class="markup--code markup--p-code">MatchToButtonPress</code> animation state is simply the character taking a couple steps forward. It is unlikely that this animation will be sufficient to get SomeDude where he needs to be to press the button. However, through the use of <code class="markup--code markup--p-code">Animator.MatchTarget()</code> we can augment the animation to align with the standing spot.</p><p name="a96d" id="a96d" class="graf graf--p graf-after--p">The first thing we want is to make the button press action a little more forgiving regarding where <code class="markup--code markup--p-code">SomeDude_RootMotion</code> is relative to the button. To do this, we will use Unity‚Äôs <code class="markup--code markup--p-code">Animator.MatchTarget()</code> method. Let‚Äôs first open the <code class="markup--code markup--p-code">RootMotionControlScript</code> and locate <code class="markup--code markup--p-code">// TODO UNCOMMENT THESE LINES FOR TARGET MATCHING</code>¬†. We should uncomment the two lines below it,</p><pre name="445b" id="445b" class="graf graf--pre graf-after--p">// TODO UNCOMMENT THESE LINES FOR TARGET MATCHING<br>Debug.Log(&quot;match to button initiated&quot;);<br>doMatchToButtonPress = true;</pre><p name="48b2" id="48b2" class="graf graf--p graf-after--pre">Next, replace the comment <code class="markup--code markup--p-code">// TODO HANDLE BUTTON MATCH TARGET HERE</code> with the following,</p><pre name="7e29" id="7e29" class="graf graf--pre graf-after--p">// TODO HANDLE BUTTON MATCH TARGET HERE<br>// get info about current animation<br>var animState = anim.GetCurrentAnimatorStateInfo(0);<br>// If the transition to button press has been initiated then we want // to correct the character position to the correct place<br>if (animState.IsName(&quot;MatchToButtonPress&quot;)<br>   &amp;&amp; !anim.IsInTransition(0) &amp;&amp; !anim.isMatchingTarget)<br>{</pre><pre name="2df6" id="2df6" class="graf graf--pre graf-after--pre">}</pre><p name="de11" id="de11" class="graf graf--p graf-after--pre">The code you just pasted queries for the current animation state. This allows us to know when a particular animation is playing. Additionally, we check to make sure we aren‚Äôt in a transition between animations and that we aren‚Äôt already performing <code class="markup--code markup--p-code">Animator.MatchTarget()</code>. Next, add the following inside the if-clause you just placed,</p><pre name="53d8" id="53d8" class="graf graf--pre graf-after--p">if (buttonPressStandingSpot != null)<br>{<br>    Debug.Log(&quot;Target matching correction started&quot;);<br>    initalMatchTargetsAnimTime = animState.normalizedTime;<br>    var t = buttonPressStandingSpot.transform;<br>    anim.MatchTarget(t.position, t.rotation, AvatarTarget.Root, new MatchTargetWeightMask(new Vector3(1f, 0f, 1f), 1f), initalMatchTargetsAnimTime, exitMatchTargetsAnimTime);<br>}</pre><p name="6a49" id="6a49" class="graf graf--p graf-after--pre">The call to <code class="markup--code markup--p-code">MatchTarget()</code> allows us to reference a current animation to serve as a time line. Over the progression of this timeline we will override root motion and interpolate towards a desired pose. The specifics of the pose are determined by which part of the character is used as a reference point and which dimensions are used via a <code class="markup--code markup--p-code">MatchTargetWeightMask()</code>. The time period of the interpolation is controlled by a normalized time reference for the start <code class="markup--code markup--p-code">initalMatchTargetsAnimTime</code> and stop <code class="markup--code markup--p-code">exitMatchTargetsAnimTime</code>. You can check out <a href="https://docs.unity3d.com/ScriptReference/Animator.MatchTarget.html" data-href="https://docs.unity3d.com/ScriptReference/Animator.MatchTarget.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">this link</a> for more details.</p><p name="afe3" id="afe3" class="graf graf--p graf-after--p">Now, try it out. You should be able to walk <code class="markup--code markup--p-code">SomeDude_RootMotion</code> close to the marker and when you press ‚ÄúFire1‚Äù you will see him turn and take a couple steps ending with alignment with the button followed by a press animation.</p><p name="0894" id="0894" class="graf graf--p graf-after--p">However, the <code class="markup--code markup--p-code">MatchTarget()</code> call doesn‚Äôt work perfectly. What you just implemented is a minimal solution. Ideally, you would include more animations and possibly some AI control to get the character closer to the button before using <code class="markup--code markup--p-code">MatchTarget()</code>. However, even this minimal solution is a big improvement in the quality of interaction.</p><p name="45f3" id="45f3" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(17) Actural Button Pressing</strong></p><p name="aca1" id="aca1" class="graf graf--p graf-after--p">Now let‚Äôs focus on the actual button press. Note that the button press animation always moves the hand to exactly the same spot according to the keyframes of the animation. But we want the hand to go to where the red ball is. In order to do this, we will override the animation with IK to go to the ball.</p><p name="8ccf" id="8ccf" class="graf graf--p graf-after--p">IK works in the opposite direction of forward kinematics. In this case, we specify the desired pose of one of the extremities of the character (hands, feet, head) and IK will determine a valid pose configuration of all bone rotations up the chain. For instance, if a hand is set to be positioned at a particular point, a pose will be determined for the wrist, elbow, and shoulder.</p><p name="e7fc" id="e7fc" class="graf graf--p graf-after--p">In order to get IK working, the first thing you need to do is enable IK on the appropriate Animation Layer of the character‚Äôs Animator. In this case, there is only one layer, the Base Layer. Under the <code class="markup--code markup--p-code">Layers</code> tab of the Animator, click the gear and check IK pass (note that it may already be checked).</p><figure name="a864" id="a864" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*x7WInW8FOQlbodxwm4bvNQ.png" data-width="2768" data-height="1398" src="https://cdn-images-1.medium.com/max/800/1*x7WInW8FOQlbodxwm4bvNQ.png"></figure><p name="dd5a" id="dd5a" class="graf graf--p graf-after--figure">Next up, we will add a callback to the <code class="markup--code markup--p-code">RootMotionControlScript</code> called <code class="markup--code markup--p-code">OnAnimatorIK()</code>. It should have a void return type and <code class="markup--code markup--p-code">int layerIndex</code><em class="markup--em markup--p-em"> </em>as the parameter. Within this method, you will implement the logic necessary for the character to be able to look at the button and to reach out and touch the button. We will add this function right before the <code class="markup--code markup--p-code">OnAnimatorMove()</code> function. Within OnAnimatorIK(), we need to add some logic to recognize when the ButtonPress Animator state is playing.</p><pre name="7044" id="7044" class="graf graf--pre graf-after--p">private void OnAnimatorIK(int layerIndex)<br>    {<br>        if (anim)<br>        {<br>            AnimatorStateInfo astate = anim.GetCurrentAnimatorStateInfo(0);<br>            if (astate.IsName(&quot;ButtonPress&quot;))<br>            {</pre><pre name="ed1c" id="ed1c" class="graf graf--pre graf-after--pre">            }<br>            else<br>            {</pre><pre name="0000" id="0000" class="graf graf--pre graf-after--pre">            }<br>        }<br>    }</pre><p name="b2ce" id="b2ce" class="graf graf--p graf-after--pre">Now add a public member variable before this function to <code class="markup--code markup--p-code">RootMotionControlScript</code> for a GameObject named buttonObject.</p><pre name="712e" id="712e" class="graf graf--pre graf-after--p">public GameObject buttonObject;</pre><p name="f070" id="f070" class="graf graf--p graf-after--pre">Next, we will add some calls to the Animator to solve IK. Add the following to the if-clause from above.</p><pre name="7ecd" id="7ecd" class="graf graf--pre graf-after--p">float buttonWeight = 1.0f;<br>// Set the look target position, if one has been assigned<br>if (buttonObject != null)<br>{<br>    anim.SetLookAtWeight(buttonWeight);<br>    anim.SetLookAtPosition(buttonObject.transform.position);<br>    anim.SetIKPositionWeight(AvatarIKGoal.RightHand, buttonWeight);<br>    anim.SetIKPosition(AvatarIKGoal.RightHand,<br>        buttonObject.transform.position);<br>}</pre><p name="b8e1" id="b8e1" class="graf graf--p graf-after--pre">In the else-clause, add the following,</p><pre name="b4c9" id="b4c9" class="graf graf--pre graf-after--p">anim.SetIKPositionWeight(AvatarIKGoal.RightHand,0); anim.SetLookAtWeight(0);</pre><p name="92f5" id="92f5" class="graf graf--p graf-after--pre">Then, save this script. Now in the Inspector view of <code class="markup--code markup--p-code">SomeDude_RootMotion</code>, connect the public parameter buttonObject to the Scene Hierarcy game object <code class="markup--code markup--p-code">ButtonHandle</code> (child of ButtonParent).</p><figure name="9cb5" id="9cb5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*7o0rcAhKUtQSHKHk7T9j8w.png" data-width="2768" data-height="1398" src="https://cdn-images-1.medium.com/max/800/1*7o0rcAhKUtQSHKHk7T9j8w.png"></figure><p name="fbae" id="fbae" class="graf graf--p graf-after--figure">You should now be able to play the game and observe the character touching the button when you press the ‚ÄúFire1‚Äù key.</p><p name="1656" id="1656" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(18) Smoothly Button Pressing</strong></p><p name="3ef0" id="3ef0" class="graf graf--p graf-after--p">However, you will notice that the hand immediately snaps to the button during the animation and then snaps back down again at the end. This is because we are using a weight of 1.0 for the IK pose versus the current animation pose. So what we really want is to smoothly transition from the animation to the IK override.</p><p name="4f4a" id="4f4a" class="graf graf--p graf-after--p">This can be handled by animating the <code class="markup--code markup--p-code">buttonWeight</code> float value. The Mecanim animation system can be used for animating all sorts of things, including float values such as the <code class="markup--code markup--p-code">buttonWeight</code>.</p><p name="0c41" id="0c41" class="graf graf--p graf-after--p">In the Project View (Assets), navigate to and select ModelsAndAnimations YBot button push &gt; ybot@Button Pushing. In the Inspector, scroll to the <code class="markup--code markup--p-code">Curves</code> section and expand it. You will see that there is a <code class="markup--code markup--p-code">buttonClose</code> curve already created for you.</p><figure name="2911" id="2911" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*352P3A4UY7B3kY5k9a9cFA.png" data-width="2768" data-height="1398" src="https://cdn-images-1.medium.com/max/800/1*352P3A4UY7B3kY5k9a9cFA.png"></figure><p name="172a" id="172a" class="graf graf--p graf-after--figure">Scrub through the animation preview and you will see that the <code class="markup--code markup--p-code">buttonClose</code> parameter is 1.0 during the time that the hand is pressing the button. Outside of that period of time, <code class="markup--code markup--p-code">buttonClose</code> is a value less than 1.0. This animation curve can be used to smoothly transition the IK weight and, therefore, create a smooth correction of the animation to get the character to properly click the button.</p><p name="2172" id="2172" class="graf graf--p graf-after--p">So in the script, we should change the <code class="markup--code markup--p-code">buttonWeight</code> declaration line to use the <code class="markup--code markup--p-code">buttonClose</code> animation curve value read from the Animator,</p><pre name="8166" id="8166" class="graf graf--pre graf-after--p">float buttonWeight = anim.GetFloat(&quot;buttonClose&quot;);</pre><p name="d58c" id="d58c" class="graf graf--p graf-after--pre">Now run the game and try out the button press again. It should animate nicely with the hand going to the correct location.</p><p name="e1f5" id="e1f5" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">2. Submission Details</strong></p><p name="8c99" id="8c99" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(1) Update the HUD</strong></p><p name="2410" id="2410" class="graf graf--p graf-after--p">Update the HUD to show your name. Edit the Name game object under the ‚ÄúFramerateCounter‚Ää‚Äî‚ÄäNAME TEXT IS HERE‚Äù.</p><p name="714c" id="714c" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(2) Modification Check List</strong></p><p name="019a" id="019a" class="graf graf--p graf-after--p">a. <code class="markup--code markup--p-code">SomeDude_NoRootMotion</code>:</p><ul class="postList"><li name="671a" id="671a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">[10 pt]</strong> disable turn animation by NOT passing turn input to the Animator (only turning programmatically)</li></ul><p name="ff43" id="ff43" class="graf graf--p graf-after--li">b. <code class="markup--code markup--p-code">SomeDude_RootMotion</code>:</p><ul class="postList"><li name="4259" id="4259" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">[20 pt]</strong> add running animations to forward blendtree and move the blend ratios around as appropriate so that the player can easily control the character</li><li name="8a94" id="8a94" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">[20 pt]</strong> add public scalars that allow adjustment of animation speed and root motion scale (translation and rotation). Adjust the scalars slightly faster than default until you are happy with control speed and overall animation quality.</li><li name="bd2e" id="bd2e" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">[20 pt]</strong> Match Target and Inverse Kinematics addition for button press animation.</li></ul><p name="9b5c" id="9b5c" class="graf graf--p graf-after--li">c. <code class="markup--code markup--p-code">Minion_RootMotion</code>:</p><ul class="postList"><li name="4b73" id="4b73" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">[15 pt]</strong> Replace/modify the forward and turn animations to include some comical hopping steps.</li><li name="ae94" id="ae94" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">[15 pt]</strong> Add animation events that generate minion squeaky footstep events to your forward animation.</li></ul><p name="9e3b" id="9e3b" class="graf graf--p graf-after--li">d. Format Requirements [Up to 20 pts deducted]</p><ul class="postList"><li name="54d7" id="54d7" class="graf graf--li graf-after--p">Update the name that appears on the HUD. The placeholder is found under the framerate overlay canvas.</li><li name="99e6" id="99e6" class="graf graf--li graf-after--li">Make sure to provide builds of your project with the auditor configured and generating no errors from your build. You will need to set Project Settings &gt; Player::Product Name to ‚ÄúLast_FirstInit_m1‚Äù.</li><li name="6f9e" id="6f9e" class="graf graf--li graf-after--li">Follow Assignment Packaging and Submission formatting and use the Auditor for checking.</li></ul><p name="ed46" id="ed46" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(3) Select Auditor</strong></p><p name="e618" id="e618" class="graf graf--p graf-after--p">Drag the Auditor prefab from the Prefabs folder to Hierarchy. In Hierarchy, navigate to Auditor\Auditor. Now in the Inspector, go to the Auditor component and set Assignment Code = <code class="markup--code markup--p-code">m1</code>. We should also assign the proper Last Name and First Initial.</p><figure name="63fc" id="63fc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*WPMfj6tQPjwJWcmsdqsIRg.png" data-width="2768" data-height="1516" src="https://cdn-images-1.medium.com/max/800/1*WPMfj6tQPjwJWcmsdqsIRg.png"></figure><p name="5abc" id="5abc" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(4) Game Building</strong></p><ul class="postList"><li name="66bd" id="66bd" class="graf graf--li graf-after--p">File &gt; Save to save the file</li><li name="5b21" id="5b21" class="graf graf--li graf-after--li">Select File &gt; Build Settings</li><li name="1b46" id="1b46" class="graf graf--li graf-after--li">Choose MacOS, Intel 64-bit + Apple Silicon</li><li name="2e7e" id="2e7e" class="graf graf--li graf-after--li">Create a new folder named <code class="markup--code markup--li-code">Last_FirstInit_m1</code> (replace with your name Info). This is the root folder.</li><li name="f502" id="f502" class="graf graf--li graf-after--li">Create a path <code class="markup--code markup--li-code">&lt;root&gt;/Build/OSX</code>¬†. Name the build <code class="markup--code markup--li-code">Last_FirstInit_m1</code> and save it here.</li><li name="6330" id="6330" class="graf graf--li graf-after--li">Select File &gt; Build Settings again</li><li name="9634" id="9634" class="graf graf--li graf-after--li">Choose Windows, x86_64</li><li name="0e4b" id="0e4b" class="graf graf--li graf-after--li">Build it in the path <code class="markup--code markup--li-code">&lt;root&gt;/Build</code> and name it <code class="markup--code markup--li-code">Windows</code>¬†.</li></ul><p name="2478" id="2478" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(5) Create </strong><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">UNTESTED</strong></code><strong class="markup--strong markup--p-strong"> file</strong></p><p name="c819" id="c819" class="graf graf--p graf-after--p">Because one of the builds (<code class="markup--code markup--p-code">.app</code> or¬†<code class="markup--code markup--p-code">.exe</code>) has not been tested, we should add a file <code class="markup--code markup--p-code">UNTESTED</code> to the folder, if we don‚Äôt test it.</p><pre name="50f1" id="50f1" class="graf graf--pre graf-after--p">$ touch UNTESTED</pre><p name="0fb9" id="0fb9" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(6) Clean Up the Root</strong></p><p name="1884" id="1884" class="graf graf--p graf-after--p">We have to clean the root before we submit.</p><pre name="e621" id="e621" class="graf graf--pre graf-after--p">$ rm -rf .git<br>$ rm -rf Library<br>$ rm -rf temp<br>$ rm -rf Obj<br>$ rm -rf Logs<br>$ rm *.sln<br>$ rm *.csproj</pre><p name="e13d" id="e13d" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(7) Create the Readme File</strong></p><p name="0b1c" id="0b1c" class="graf graf--p graf-after--p">In the root directory,</p><pre name="a3d0" id="a3d0" class="graf graf--pre graf-after--p">$ touch <code class="markup--code markup--pre-code">Last_FirstInit_m1_readme.md</code></pre><p name="f69b" id="f69b" class="graf graf--p graf-after--pre">Add some information on how to test your build.</p><p name="e165" id="e165" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(8) Submission</strong></p><p name="73db" id="73db" class="graf graf--p graf-after--p graf--trailing">We should submit a ZIP file of the root directory. The name of this file should be <code class="markup--code markup--p-code">&lt;lastName_firstInitial&gt;_m&lt;milestone number&gt;.zip</code>¬†.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/5249ae5adcc1"><time class="dt-published" datetime="2021-09-11T17:18:34.780Z">September 11, 2021</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/video-game-design-4-unity-animation-case-study-5249ae5adcc1" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>