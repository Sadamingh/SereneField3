<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Relational Database 9 | AWS IAM, S3, and RDS Services</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Relational Database 9 | AWS IAM, S3, and RDS Services</h1>
</header>
<section data-field="subtitle" class="p-summary">
Series: Relational Database
</section>
<section data-field="body" class="e-content">
<section name="196e" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="617e" id="617e" class="graf graf--h3 graf--leading graf--title">Relational Database 9 | AWS IAM, S3, and RDS Services</h3><figure name="14c4" id="14c4" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*V5neOlktR3wS7ts8cbXf5A.png" data-width="1106" data-height="828" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*V5neOlktR3wS7ts8cbXf5A.png"></figure><ol class="postList"><li name="8281" id="8281" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">AWS Identity and Access Management (IAM)</strong></li></ol><p name="ef6c" id="ef6c" class="graf graf--p graf-after--li">In practice, we have to collaborate with others. For the reason that several people should have the access to an instance, we have to manage the identity and the accessibility for that specific instance that we are going to use. This is called the IAM for AWS.</p><p name="2d26" id="2d26" class="graf graf--p graf-after--p">To change the accessibility of an instance or to create a new identity, from the AWS Management Console, we click on our user name and then choose “My Security Credentials”.</p><figure name="8503" id="8503" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*woxhPYtOxTSrY1grxg7ctQ.png" data-width="1452" data-height="518" src="https://cdn-images-1.medium.com/max/800/1*woxhPYtOxTSrY1grxg7ctQ.png"></figure><ul class="postList"><li name="b361" id="b361" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Create a new IAM user</strong></li></ul><p name="e811" id="e811" class="graf graf--p graf-after--li">An IAM user is different from the root user, and the IAM user only has the accessibility of a few instances selected by the root user. As a root user, we have the permission to create IAM users for a specific instance, however, the IAM user doesn’t have the permission to add or delete users.</p><p name="71d8" id="71d8" class="graf graf--p graf-after--p">To create a new IAM user, click on the Users tab from the left bar and then click on the “Add user” button,</p><figure name="bb84" id="bb84" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*M30SorlSpt8efxlh6brFdQ.png" data-width="2794" data-height="840" src="https://cdn-images-1.medium.com/max/800/1*M30SorlSpt8efxlh6brFdQ.png"></figure><p name="e2ca" id="e2ca" class="graf graf--p graf-after--figure">For example, Jeff is our friend and we would like to give him permission for my instances. Then check the boxes of “Programmatic access” and “AWS Management Console access”. For the password, we just simply write “Abc12345” (or you can write what you want) for an original one because the AWS will ask the IAM user to change the password after they log in for the very first time because of the security issues. Then we click on the “Next: Permissions” button to continue.</p><figure name="b056" id="b056" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*xflheRe5EiIOdupV_2_K2g.png" data-width="2660" data-height="1350" src="https://cdn-images-1.medium.com/max/800/1*xflheRe5EiIOdupV_2_K2g.png"></figure><p name="5c13" id="5c13" class="graf graf--p graf-after--figure">On the Permission page, we are supposed to restrict the IAM user because we don’t want the other sensitive information being accessed. So we have to create some policies for the IAM user. Because the IAM users can be more than one for a specific project and in most of the cases, we have to set the same policies for all of them, that’s why we create groups to give policies to all of the IAM users with the same permission. Because it is said that we haven’t got a group now, then we have to create a group first.</p><p name="3df1" id="3df1" class="graf graf--p graf-after--p">Click on the “Create Group” button,</p><figure name="2bd5" id="2bd5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*nZcclz4Fa-EgLjxM37zSxw.png" data-width="2314" data-height="808" src="https://cdn-images-1.medium.com/max/800/1*nZcclz4Fa-EgLjxM37zSxw.png"></figure><p name="518a" id="518a" class="graf graf--p graf-after--figure">Then in the popped-up window, we can write the Group name randomly (i.e. I use projectname for this). We can either create some new policies or we can search for some common permission policies.</p><p name="363b" id="363b" class="graf graf--p graf-after--p">For example, suppose we are going to give access to the EC2 servers, so then we can check the box of the EC2 policies (note that the description will describe specifically what’s the meaning for this policy).</p><figure name="bf0d" id="bf0d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*hNf8mwoCmCtZy5_ysvgjSw.png" data-width="2368" data-height="1218" src="https://cdn-images-1.medium.com/max/800/1*hNf8mwoCmCtZy5_ysvgjSw.png"></figure><p name="1e4e" id="1e4e" class="graf graf--p graf-after--figure">However, we are going to create a policy because the common policies are not enough for us to use. So we click on the “Create policy” button and then we will be redirected to a new page for creating policy.</p><p name="c6a8" id="c6a8" class="graf graf--p graf-after--p">a. Allow the permission to S3</p><p name="77b6" id="77b6" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Step 1</strong>. Add S3 to the service</p><figure name="4872" id="4872" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*XRgUYhd3L9M8WjcHCadTbg.png" data-width="2648" data-height="1284" src="https://cdn-images-1.medium.com/max/800/1*XRgUYhd3L9M8WjcHCadTbg.png"></figure><p name="8078" id="8078" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 2</strong>. Choose all S3 actions except for the permissions management, because the IAM user should not have the ability to change the permissions</p><figure name="14b5" id="14b5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*pLxEhtdMZQTzTo19fgp-Sg.png" data-width="2648" data-height="1284" src="https://cdn-images-1.medium.com/max/800/1*pLxEhtdMZQTzTo19fgp-Sg.png"></figure><p name="aadc" id="aadc" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 3</strong>. From the source part, choose the permission for the buckets (i.e. in our case, we only allow the bucket named “project1127” for our resource). It doesn’t matter whether we have created this bucket or not. And what is the bucket? We will talk about it later.</p><figure name="186a" id="186a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*XP67aJybc_bhSofvJPI-Lg.png" data-width="1836" data-height="808" src="https://cdn-images-1.medium.com/max/800/1*XP67aJybc_bhSofvJPI-Lg.png"></figure><p name="753a" id="753a" class="graf graf--p graf-after--figure">b. Allow the permission to RDS</p><p name="7c1a" id="7c1a" class="graf graf--p graf-after--p">Now, let’s do the same stuff to add permission to the RDS. To make things easier, we just give all the action permissions and all the resource permissions at this time.</p><figure name="bae5" id="bae5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CipUyAyzl81EAUjh3V-uxg.png" data-width="1754" data-height="704" src="https://cdn-images-1.medium.com/max/800/1*CipUyAyzl81EAUjh3V-uxg.png"></figure><figure name="0ef1" id="0ef1" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*8fFx8nx3UrpmlFSUZ7pq3w.png" data-width="1754" data-height="704" src="https://cdn-images-1.medium.com/max/800/1*8fFx8nx3UrpmlFSUZ7pq3w.png"></figure><p name="684b" id="684b" class="graf graf--p graf-after--figure">Then we click on the “Review policy” button to continue. For this policy, we just simply name it as “newpolicy”. After that and make sure all the permissions are set correctly, we then click on the “Create policy” to create this policy.</p><figure name="c49f" id="c49f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5U05LOJgEqkSz9xKXI7iGQ.png" data-width="2672" data-height="1162" src="https://cdn-images-1.medium.com/max/800/1*5U05LOJgEqkSz9xKXI7iGQ.png"></figure><p name="d6f6" id="d6f6" class="graf graf--p graf-after--figure">It will be fine if we can see this sign,</p><figure name="605b" id="605b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*zn3CoZDsWuKyAsjdFZTmPQ.png" data-width="2194" data-height="166" src="https://cdn-images-1.medium.com/max/800/1*zn3CoZDsWuKyAsjdFZTmPQ.png"></figure><p name="78cf" id="78cf" class="graf graf--p graf-after--figure">Then we go back to the “Create Group” page and click on the “Refresh” button to refresh the policy list. In the policy search box, we write “newpolicy” and then we can find the policy that we have created. Check the box of it and then click on the “Create group” button to create this group.</p><figure name="5e07" id="5e07" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Bu_q4Fc8pVvki2KHurd6YA.png" data-width="2372" data-height="1216" src="https://cdn-images-1.medium.com/max/800/1*Bu_q4Fc8pVvki2KHurd6YA.png"></figure><p name="65b3" id="65b3" class="graf graf--p graf-after--figure">Select “Add user to group” and check the box of this group to make the permissions that we have set working on the current IAM user. Then we click on the “Next: Tags” button to continue.</p><figure name="21ce" id="21ce" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ez37d6DF3-F9ysOux46rIg.png" data-width="2372" data-height="1320" src="https://cdn-images-1.medium.com/max/800/1*ez37d6DF3-F9ysOux46rIg.png"></figure><p name="4bbf" id="4bbf" class="graf graf--p graf-after--figure">On the “Add tags” page, we can add some information about this IAM user. For example, name, email, phone number, etc. Or we can just leave it there because this is an optional page for us. Then we click on the “Next: Review” button to continue.</p><figure name="b08b" id="b08b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HX1IsGvYg0iIg0LbqnOnSQ.png" data-width="2372" data-height="666" src="https://cdn-images-1.medium.com/max/800/1*HX1IsGvYg0iIg0LbqnOnSQ.png"></figure><p name="bc78" id="bc78" class="graf graf--p graf-after--figure">The review page will show us the settings that we have made to that IAM user and if there’s nothing wrong, click on the “Create user” button to continue.</p><figure name="25b7" id="25b7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZmHRlHwe844Yc7qNlfmaLg.png" data-width="2372" data-height="1466" src="https://cdn-images-1.medium.com/max/800/1*ZmHRlHwe844Yc7qNlfmaLg.png"></figure><p name="730b" id="730b" class="graf graf--p graf-after--figure">The next page will show us the access key ID and the secret access key for that IAM user and we should download a CSV file with all these pieces of information because they are not going to show for a second time. Click on the “Download .csv” button to download the information.</p><figure name="7cc5" id="7cc5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*TzmR_r9wzE0TMyvyIpK5Pw.png" data-width="1690" data-height="536" src="https://cdn-images-1.medium.com/max/800/1*TzmR_r9wzE0TMyvyIpK5Pw.png"></figure><p name="c594" id="c594" class="graf graf--p graf-after--figure">Then from the downloaded CSV file, we can find a console login link. With this link, we can log into the IAM account.</p><figure name="e20a" id="e20a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*b-PnQcssUtwim-hQA7a0sg.png" data-width="1760" data-height="180" src="https://cdn-images-1.medium.com/max/800/1*b-PnQcssUtwim-hQA7a0sg.png"></figure><p name="d733" id="d733" class="graf graf--p graf-after--figure">Click on the link to open it (or copy and paste it in the browser). In case you forget, the username and the password are,</p><pre name="43d7" id="43d7" class="graf graf--pre graf-after--p">Username: Jeff<br>Password: Abc12345</pre><figure name="4083" id="4083" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*za-rShMYI7fBPfhvpwop8Q.png" data-width="1788" data-height="812" src="https://cdn-images-1.medium.com/max/800/1*za-rShMYI7fBPfhvpwop8Q.png"></figure><p name="90e7" id="90e7" class="graf graf--p graf-after--figure">Then we are asked to change the password because we have checked (by default) the box of “Require password reset” in the previous settings.</p><figure name="2bc0" id="2bc0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*gJEgTzWqFJwT5mzG5pwo-A.png" data-width="2768" data-height="1070" src="https://cdn-images-1.medium.com/max/800/1*gJEgTzWqFJwT5mzG5pwo-A.png"></figure><p name="fb7e" id="fb7e" class="graf graf--p graf-after--figure">After resetting the password, we can then check the accessibility of our IAM account. Because we didn’t choose to give the accessibility of the EC2 service, let’s see what will it be if I go to the EC2 dashboard. We can discover that we haven’t got any accessibility to the current instance of the root account, and also, we don’t have the permission to create a new EC2 instance. This is basically what we want to set for this IAM account.</p><figure name="120d" id="120d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*MOc6BzHtf33QFxs0BjwUSg.png" data-width="1614" data-height="912" src="https://cdn-images-1.medium.com/max/800/1*MOc6BzHtf33QFxs0BjwUSg.png"></figure><figure name="4c92" id="4c92" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*dGErBmPko0kFFxNXVykRyg.png" data-width="2796" data-height="782" src="https://cdn-images-1.medium.com/max/800/1*dGErBmPko0kFFxNXVykRyg.png"></figure><ul class="postList"><li name="0c4d" id="0c4d" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">IAM Log in with the command line</strong></li></ul><p name="f312" id="f312" class="graf graf--p graf-after--li">Remember we have got the access key ID and the secret access key of the IAM account and this is used for log in the AWS through the command line. For macOS, firstly, we have to download the latest version of the AWS Command Line Interface and install it,</p><pre name="ef39" id="ef39" class="graf graf--pre graf-after--p">$ curl &quot;https://awscli.amazonaws.com/AWSCLIV2.pkg&quot; -o &quot;AWSCLIV2.pkg&quot;<br>$ sudo installer -pkg AWSCLIV2.pkg -target /</pre><p name="2e70" id="2e70" class="graf graf--p graf-after--pre">Then we type in,</p><pre name="5e74" id="5e74" class="graf graf--pre graf-after--p">$ aws configure</pre><p name="eea6" id="eea6" class="graf graf--p graf-after--pre">to open the aws service. In this window, we enter the AWS Access Key and the AWS Secret Access Key that is stored in the CSV file we have downloaded,</p><pre name="a940" id="a940" class="graf graf--pre graf-after--p">AWS Access Key ID [None]: .........<br>AWS Secret Access Key [None]: ...........<br>Default region name [None]: <br>Default output format [None]:</pre><p name="f0f1" id="f0f1" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">2. AWS S3 Bucket</strong></p><p name="8018" id="8018" class="graf graf--p graf-after--p">Amazon Simple Storage Service (Amazon S3) is an object storage service that offers data storage services. The basic storage units of Amazon S3 service are objects which are organized into <strong class="markup--strong markup--p-strong">buckets</strong>. To make things easier, we can abstract that an S3 bucket is a remote disk that can be used to store data.</p><ul class="postList"><li name="cfbb" id="cfbb" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Create a new bucket</strong></li></ul><p name="8f03" id="8f03" class="graf graf--p graf-after--li">In the dashboard of the S3 service, let’s click on the orange button with “Create bucket”.</p><figure name="939a" id="939a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*HAHk5CST2aaUCTl-kjlzOQ.png" data-width="2196" data-height="770" src="https://cdn-images-1.medium.com/max/800/1*HAHk5CST2aaUCTl-kjlzOQ.png"></figure><p name="00ac" id="00ac" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 1</strong>. Assign a unique bucket name. This bucket can not be the same as any buckets that is existing and created by any users of S3. I will use “project1127” as the bucket name and of course, you can not use this unless I delete this bucket (it may happen).</p><figure name="899b" id="899b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mViQ_1r_Z0lPGJDxhkNDzQ.png" data-width="1682" data-height="878" src="https://cdn-images-1.medium.com/max/800/1*mViQ_1r_Z0lPGJDxhkNDzQ.png"></figure><p name="1005" id="1005" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 2.</strong> Make it a public bucket</p><p name="881d" id="881d" class="graf graf--p graf-after--p">In my case, I want this bucket to be publically available, so I uncheck the box of block all public access and check the box of acknowledging the risks.</p><figure name="795c" id="795c" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4t_QJHz3-zhHurpP89f0pA.png" data-width="1682" data-height="1394" src="https://cdn-images-1.medium.com/max/800/1*4t_QJHz3-zhHurpP89f0pA.png"></figure><p name="5c75" id="5c75" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 3</strong>. Click on “Creat bucket” to create this bucket</p><figure name="9027" id="9027" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*qPAD2p_PYvJVLpHWbiO_TA.png" data-width="1682" data-height="410" src="https://cdn-images-1.medium.com/max/800/1*qPAD2p_PYvJVLpHWbiO_TA.png"></figure><ul class="postList"><li name="d7c4" id="d7c4" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Upload files to the bucket</strong></li></ul><p name="2d32" id="2d32" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">Step 1</strong>. Click on the bucket that we have created and from the object page of this bucket, we can choose to upload files. We click on the “Upload” button to upload the files.</p><figure name="0fbe" id="0fbe" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6F_VsTscLxn2qEQLMFSrng.png" data-width="2244" data-height="984" src="https://cdn-images-1.medium.com/max/800/1*6F_VsTscLxn2qEQLMFSrng.png"></figure><p name="b54d" id="b54d" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 2</strong>. Click on “Add files” to select the files we want to upload. For example, I choose two PDF files for this,</p><figure name="17a6" id="17a6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8zATT6sbctQSA3C2Pw-5tQ.png" data-width="1524" data-height="784" src="https://cdn-images-1.medium.com/max/800/1*8zATT6sbctQSA3C2Pw-5tQ.png"></figure><p name="7c24" id="7c24" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 3.</strong> Click on the “Upload” button to upload these two files to the server.</p><figure name="4a71" id="4a71" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*gt4hG_b2vMsq_O-rvicH-w.png" data-width="1524" data-height="160" src="https://cdn-images-1.medium.com/max/800/1*gt4hG_b2vMsq_O-rvicH-w.png"></figure><p name="3804" id="3804" class="graf graf--p graf-after--figure">After a second, we can see that those files are uploaded successfully.</p><figure name="d736" id="d736" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*6Xjqr_6AkaGGnT-yBLDoOw.png" data-width="2718" data-height="1342" src="https://cdn-images-1.medium.com/max/800/1*6Xjqr_6AkaGGnT-yBLDoOw.png"></figure><ul class="postList"><li name="7783" id="7783" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Change the permission of a bucket</strong></li></ul><p name="76a5" id="76a5" class="graf graf--p graf-after--li">To modify the permission of a bucket, we will go to its Permissions page and then click on “Edit”,</p><figure name="b649" id="b649" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*KqIaN2ijbsN4r-imbtHP3A.png" data-width="2718" data-height="994" src="https://cdn-images-1.medium.com/max/800/1*KqIaN2ijbsN4r-imbtHP3A.png"></figure><p name="2213" id="2213" class="graf graf--p graf-after--figure">We can also change the bucket policy by clicking on the “Edit” button of the Bucket policy part,</p><figure name="1d88" id="1d88" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Devj_p-HP6iAK0BK025ANg.png" data-width="2718" data-height="994" src="https://cdn-images-1.medium.com/max/800/1*Devj_p-HP6iAK0BK025ANg.png"></figure><p name="5a0c" id="5a0c" class="graf graf--p graf-after--figure">We don’t have to write the JSON policy because we can use the policy generator. We click on the “Policy generator”,</p><figure name="c7bd" id="c7bd" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*k_UPJb4D0q2AlGoqUrZbqQ.png" data-width="1550" data-height="674" src="https://cdn-images-1.medium.com/max/800/1*k_UPJb4D0q2AlGoqUrZbqQ.png"></figure><p name="376e" id="376e" class="graf graf--p graf-after--figure">Then for the AWS Policy Generator we choose the type as S3 Bucket Policy. The * for the principle means this can be used for all the users. GetObject is selected as our action and ARN shoule be the bucket ARN of this bucket plus the name of the files separated by comma (for example, my ARN for this is arn:aws:s3:::project1127/Q7.pdf,arn:aws:s3:::project1127/Q8.pdf).</p><figure name="ffc9" id="ffc9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*g8ZUcT3kqPCqrHwpzlr8ZA.png" data-width="2148" data-height="1218" src="https://cdn-images-1.medium.com/max/800/1*g8ZUcT3kqPCqrHwpzlr8ZA.png"></figure><p name="fc51" id="fc51" class="graf graf--p graf-after--figure">Then we click on thee “Add Statement” to add this statement. Finally, we should click on the “Generate Policy” button to create a JSON file.</p><figure name="2fa8" id="2fa8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mhfmWKcAk9r3plnkKQbWFg.png" data-width="2148" data-height="432" src="https://cdn-images-1.medium.com/max/800/1*mhfmWKcAk9r3plnkKQbWFg.png"></figure><p name="b149" id="b149" class="graf graf--p graf-after--figure">Then we copy and paste the generated policy to the bucket policy and then click on the “Save changes” button to make it works for this bucket.</p><pre name="1641" id="1641" class="graf graf--pre graf-after--p">{<br>  &quot;Id&quot;: &quot;Policy1606547208127&quot;,<br>  &quot;Version&quot;: &quot;2012-10-17&quot;,<br>  &quot;Statement&quot;: [<br>    {<br>      &quot;Sid&quot;: &quot;Stmt1606547131805&quot;,<br>      &quot;Action&quot;: [<br>        &quot;s3:GetObject&quot;<br>      ],<br>      &quot;Effect&quot;: &quot;Allow&quot;,<br>      &quot;Resource&quot;: [<br>        &quot;arn:aws:s3:::project1127/Q7.pdf&quot;,<br>        &quot;arn:aws:s3:::project1127/Q8.pdf&quot;<br>      ],<br>      &quot;Principal&quot;: &quot;*&quot;<br>    }<br>  ]<br>}</pre><figure name="e35b" id="e35b" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*GbdlGz5-AzWF-ho_k2EWnA.png" data-width="1480" data-height="1374" src="https://cdn-images-1.medium.com/max/800/1*GbdlGz5-AzWF-ho_k2EWnA.png"></figure><p name="20a7" id="20a7" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">3. AWS RDS Cloud-Based Database</strong></p><p name="0cfa" id="0cfa" class="graf graf--p graf-after--p">AWS relation database service makes it easier to deloy a relational database in the cloud.</p><ul class="postList"><li name="ce55" id="ce55" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Create a cloud database</strong></li></ul><p name="faba" id="faba" class="graf graf--p graf-after--li">To create a cloud-based database, first of all, we have to click on the “Create Database” button and then we choose “Standard create”. Then we should choose PostgreSQL (or other relational databases) and the “Free tier” template (because this service can be really expensive for us).</p><figure name="d9e5" id="d9e5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*eHI7ej7lydUf1S5eeeyNnw.png" data-width="2164" data-height="326" src="https://cdn-images-1.medium.com/max/800/1*eHI7ej7lydUf1S5eeeyNnw.png"></figure><figure name="c562" id="c562" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*YX6qGfNlBWr3QiM8tV8glg.png" data-width="1422" data-height="1358" src="https://cdn-images-1.medium.com/max/800/1*YX6qGfNlBWr3QiM8tV8glg.png"></figure><p name="06fb" id="06fb" class="graf graf--p graf-after--figure">For the Settings part, the should create a name for our database instance (i.e. projectdb) and then we create the username (by default, postgres) and the password for our database.</p><figure name="47e6" id="47e6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*JLiUA1gIqmTn50gSgJVKdg.png" data-width="1422" data-height="1136" src="https://cdn-images-1.medium.com/max/800/1*JLiUA1gIqmTn50gSgJVKdg.png"></figure><p name="310e" id="310e" class="graf graf--p graf-after--figure">If you are not using the free tier, you should then choose a proper DB instance size. Of course, a higher performance machine means a more expensive cost and we should be careful about this. For me, because I choose the free tier, so it won’t be a problem.</p><figure name="5e31" id="5e31" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*IgB46Hps5NIGGJMLpxKgLA.png" data-width="1422" data-height="712" src="https://cdn-images-1.medium.com/max/800/1*IgB46Hps5NIGGJMLpxKgLA.png"></figure><p name="617c" id="617c" class="graf graf--p graf-after--figure">Then in the connectivity part, select yes for the Public access because we want the others connect to the database freely form their local machines.</p><figure name="7b40" id="7b40" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*eHKxMBVpXfmbhf4Wh5-GDw.png" data-width="1422" data-height="1380" src="https://cdn-images-1.medium.com/max/800/1*eHKxMBVpXfmbhf4Wh5-GDw.png"></figure><p name="514f" id="514f" class="graf graf--p graf-after--figure">Remember to check the bill before we continue. For me, it is a free service and I am not worrying.</p><p name="cc05" id="cc05" class="graf graf--p graf-after--p">Finally, click on the “Create database” button to create this database. It can take quite a while before we can use this database. If you see there’s no endpoint and port, keep patient and wait for some time until they appear.</p><figure name="c1a5" id="c1a5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*NxODJvuIA3fuhHCPnbnM3Q.png" data-width="1254" data-height="596" src="https://cdn-images-1.medium.com/max/800/1*NxODJvuIA3fuhHCPnbnM3Q.png"></figure><ul class="postList"><li name="f28e" id="f28e" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Add the cloud-based server to the PgAdimn</strong></li></ul><p name="fadc" id="fadc" class="graf graf--p graf-after--li">To connect the PgAdmin to that cloud server that we have created, we should right click on the Server and choose “Create &gt; Server”.</p><figure name="1223" id="1223" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*rSftwvFuqGJcIHA-TBr-fg.png" data-width="2800" data-height="1282" src="https://cdn-images-1.medium.com/max/800/1*rSftwvFuqGJcIHA-TBr-fg.png"></figure><p name="9570" id="9570" class="graf graf--p graf-after--figure">Then we give its name as the “projectdb” and we select the connection tag to configure more about this server.</p><figure name="762d" id="762d" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*SLJUQ8BrjGkUTCf37k7lVA.png" data-width="1562" data-height="1140" src="https://cdn-images-1.medium.com/max/800/1*SLJUQ8BrjGkUTCf37k7lVA.png"></figure><p name="a85b" id="a85b" class="graf graf--p graf-after--figure">Under the connection tag, first of all, we copy and paste the endpoint information from the AWS and then we should type in the password of this database. Keep the other blanks as default if you followed our steps of creating a RDS instance. Then click on Save to save our server.</p><figure name="2a6f" id="2a6f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*WS4TJK5CkkfWirdRrErvUg.png" data-width="1562" data-height="1140" src="https://cdn-images-1.medium.com/max/800/1*WS4TJK5CkkfWirdRrErvUg.png"></figure><p name="8d22" id="8d22" class="graf graf--p graf-after--figure">Now, after a second, we will have a problem: connection time out! Again, this is a problem because of our firewall settings.</p><figure name="36c0" id="36c0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*BEZ-KS6jQySq62HmJjg78g.png" data-width="1562" data-height="386" src="https://cdn-images-1.medium.com/max/800/1*BEZ-KS6jQySq62HmJjg78g.png"></figure><p name="c442" id="c442" class="graf graf--p graf-after--figure">Let’s go back to our RDS dashboard and from the Security, we can find a VPC security groups. Click on it to change its inbound rules. Then click on the “Security group ID” to change the rules.</p><figure name="3186" id="3186" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*SiE4ToWY88zcKKwp1e90Dg.png" data-width="2274" data-height="740" src="https://cdn-images-1.medium.com/max/800/1*SiE4ToWY88zcKKwp1e90Dg.png"></figure><p name="167f" id="167f" class="graf graf--p graf-after--figure">Then we select the type as PostgreSQL and choose anywhere for the Source. Click on “Save rules” to make this work.</p><figure name="05b7" id="05b7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5ZJPY_eh0RMwKzvBzgq1aQ.png" data-width="2646" data-height="1174" src="https://cdn-images-1.medium.com/max/800/1*5ZJPY_eh0RMwKzvBzgq1aQ.png"></figure><p name="929f" id="929f" class="graf graf--p graf-after--figure">Now let’s go back to the PgAdmin, and reconnect. Now we can successfully connect to the database service.</p><figure name="5187" id="5187" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*kFgeunwtL_pOiGEn30-uYw.png" data-width="600" data-height="270" src="https://cdn-images-1.medium.com/max/800/1*kFgeunwtL_pOiGEn30-uYw.png"></figure><ul class="postList"><li name="ed78" id="ed78" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Load data from S3 to RDS</strong></li></ul><p name="baba" id="baba" class="graf graf--p graf-after--li">First of all, we upload the “nyt_bestsellers.json” file to the S3 bucket. Remember to change the permissions after this.</p><pre name="e740" id="e740" class="graf graf--pre graf-after--p">{<br>    &quot;Version&quot;: &quot;2012-10-17&quot;,<br>    &quot;Id&quot;: &quot;Policy1606547208127&quot;,<br>    &quot;Statement&quot;: [<br>        {<br>            &quot;Sid&quot;: &quot;Stmt1606547131805&quot;,<br>            &quot;Effect&quot;: &quot;Allow&quot;,<br>            &quot;Principal&quot;: &quot;*&quot;,<br>            &quot;Action&quot;: &quot;s3:GetObject&quot;,<br>            &quot;Resource&quot;: [<br>                &quot;arn:aws:s3:::project1127/nyt_bestsellers.json&quot;<br>            ]<br>        }<br>    ]<br>}</pre><p name="040b" id="040b" class="graf graf--p graf-after--pre">Secondly, we go back to the RDS dashboard and open the query tool of this database,</p><figure name="6e6f" id="6e6f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*yu43fHmCQhsIyIoG0-55mw.png" data-width="2802" data-height="1036" src="https://cdn-images-1.medium.com/max/800/1*yu43fHmCQhsIyIoG0-55mw.png"></figure><p name="ac59" id="ac59" class="graf graf--p graf-after--figure">Where we can write,</p><pre name="ec01" id="ec01" class="graf graf--pre graf-after--p">CREATE EXTENSION aws_s3 CASCADE;</pre><p name="9edb" id="9edb" class="graf graf--p graf-after--pre">this query will install the aws_s3 extension for us,</p><pre name="9e6c" id="9e6c" class="graf graf--pre graf-after--p">| NOTICE:  installing required extension &quot;aws_commons&quot; <br>| CREATE EXTENSION</pre><p name="f2df" id="f2df" class="graf graf--p graf-after--pre">Then we create a new table as we have done for the other database,</p><pre name="9561" id="9561" class="graf graf--pre graf-after--p">CREATE TABLE nyt_bestsellers (<br>    bestsellers JSON<br>);</pre><p name="ad80" id="ad80" class="graf graf--p graf-after--pre">To load the data from the S3 to RDS, we should add an IAM role to this database. From the Manage IAM roles section, we choose the role of “AWSServiceRoleForRDS” with the feature “s3Import”.</p><figure name="6c89" id="6c89" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*2bGn7Wtn9FLqyN7eXfnmbQ.png" data-width="2284" data-height="632" src="https://cdn-images-1.medium.com/max/800/1*2bGn7Wtn9FLqyN7eXfnmbQ.png"></figure><p name="af93" id="af93" class="graf graf--p graf-after--figure">Then we go back to the PgAdmin and run the following query,</p><pre name="0c65" id="0c65" class="graf graf--pre graf-after--p">SELECT aws_s3.table_import_from_s3(<br>    &#39;nyt_bestsellers&#39;, &#39;bestsellers&#39;, &#39;&#39;,<br>    aws_commons.create_s3_uri(&#39;project1127&#39;, &#39;nyt_bestsellers.json&#39;, &#39;us-east-2&#39;)<br>);</pre><p name="5a60" id="5a60" class="graf graf--p graf-after--pre">where the we have to add a “create_s3_uri function” which follows the rules of aws_commons.create_s3_uri(&lt;bucketname&gt;,&lt;filepathname&gt;,&lt;region&gt;).</p><p name="aec1" id="aec1" class="graf graf--p graf-after--p">Then we can successfully load the data from S3 to RDS by this method. To check our result, we can write,</p><pre name="aac0" id="aac0" class="graf graf--pre graf-after--p graf--trailing">SELECT * <br>FROM nyt_bestsellers;</pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/8abe8e77e8ca"><time class="dt-published" datetime="2020-11-28T08:36:48.616Z">November 28, 2020</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/relational-database-9-aws-iam-s3-and-rds-services-8abe8e77e8ca" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>