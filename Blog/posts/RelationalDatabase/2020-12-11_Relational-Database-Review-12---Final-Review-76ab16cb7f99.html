<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Relational Database Review 12 | Final Review</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Relational Database Review 12 | Final Review</h1>
</header>
<section data-field="subtitle" class="p-summary">
Series: Relational Database
</section>
<section data-field="body" class="e-content">
<section name="d025" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="65bb" id="65bb" class="graf graf--h3 graf--leading graf--title">Relational Database Review 12 | Final Review</h3><figure name="0a60" id="0a60" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*3IaCF_vbefdstmWFpZxCRw.png" data-width="1600" data-height="1200" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*3IaCF_vbefdstmWFpZxCRw.png"></figure><ol class="postList"><li name="cbba" id="cbba" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">GROUP BY &amp; HAVING &amp; Window Functions</strong></li></ol><p name="60f6" id="60f6" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(1) Question 1 </strong><a href="https://www.windowfunctions.com/questions/intro/0" data-href="https://www.windowfunctions.com/questions/intro/0" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="07f6" id="07f6" class="graf graf--p graf-after--p">We would like to find the total weight of cats grouped by age. But only return those groups with a total weight larger than 12.</p><p name="87da" id="87da" class="graf graf--p graf-after--p">Wrong, because total_weight is not defined as the column from table cats.</p><pre name="ad0c" id="ad0c" class="graf graf--pre graf-after--p">SELECT age, SUM(weight) AS total_weight<br>FROM cats<br>GROUP BY age<br>HAVING total_weight &gt; 12<br>ORDER BY age;</pre><p name="c883" id="c883" class="graf graf--p graf-after--pre">Right answer,</p><pre name="9744" id="9744" class="graf graf--pre graf-after--p">SELECT age, SUM(weight) AS total_weight<br>FROM cats<br>GROUP BY age<br>HAVING SUM(weight) &gt; 12<br>ORDER BY age;</pre><p name="5a51" id="5a51" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(2) Question 2.</strong> <a href="https://www.windowfunctions.com/questions/over/0" data-href="https://www.windowfunctions.com/questions/over/0" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="8ed6" id="8ed6" class="graf graf--p graf-after--p">The cats must be ordered by name and will enter an elevator one by one. We would like to know what the running total weight is.</p><p name="3a46" id="3a46" class="graf graf--p graf-after--p">Wrong, because the result is not an elevator one by one,</p><pre name="ef32" id="ef32" class="graf graf--pre graf-after--p">SELECT name, SUM(weight) AS running_total_weight<br>FROM cats<br>GROUP BY name<br>ORDER BY name;</pre><p name="dcbd" id="dcbd" class="graf graf--p graf-after--pre">Right answer,</p><pre name="de1f" id="de1f" class="graf graf--pre graf-after--p">SELECT name, <br>       SUM(weight) OVER (ORDER BY name) AS running_total_weight<br>FROM cats;</pre><p name="3f11" id="3f11" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(3) Question 3.</strong> <a href="https://www.windowfunctions.com/questions/over/1" data-href="https://www.windowfunctions.com/questions/over/1" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="2c6a" id="2c6a" class="graf graf--p graf-after--p">The cats must be ordered first by breed and second by name. They are about to enter an elevator one by one. When all the cats of the same breed have entered they leave.</p><p name="8fbf" id="8fbf" class="graf graf--p graf-after--p">We would like to know what the running total weight of the cats is.</p><p name="4c75" id="4c75" class="graf graf--p graf-after--p">Wrong. The result is elevated, but is not grouped by the breed,</p><pre name="0d06" id="0d06" class="graf graf--pre graf-after--p">SELECT name, breed,<br>       SUM(weight) OVER (ORDER BY breed, name) AS running_total_weight<br>FROM cats;</pre><p name="16b9" id="16b9" class="graf graf--p graf-after--pre">Right answer,</p><pre name="40e6" id="40e6" class="graf graf--pre graf-after--p">SELECT name, breed,<br>       SUM(weight) OVER (PARTITION BY breed ORDER BY breed, name) AS running_total_weight<br>FROM cats;</pre><p name="5283" id="5283" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(4) Question 4. </strong><a href="https://www.windowfunctions.com/questions/over/2" data-href="https://www.windowfunctions.com/questions/over/2" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="a91b" id="a91b" class="graf graf--p graf-after--p">The cats would like to see the average of the weight of them, the cat just after them and the cat just before them. The first and last cats are content to have an average weight consisting of 2 cats, not 3.</p><p name="7aba" id="7aba" class="graf graf--p graf-after--p">Wrong, the following SQL doesn&#39;t order by weight,</p><pre name="fc6b" id="fc6b" class="graf graf--pre graf-after--p">SELECT name, weight, <br>       AVG(weight) OVER (ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)<br>FROM cats;</pre><p name="b11b" id="b11b" class="graf graf--p graf-after--pre">Right answer,</p><pre name="8965" id="8965" class="graf graf--pre graf-after--p">SELECT name, weight, <br>       AVG(weight) OVER (ORDER BY weight ROWS BETWEEN 1 PRECEDING AND 1 FOLLOWING)<br>FROM cats;</pre><p name="e350" id="e350" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(5) Question 5. </strong><a href="https://www.windowfunctions.com/questions/over/3" data-href="https://www.windowfunctions.com/questions/over/3" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="f1b4" id="f1b4" class="graf graf--p graf-after--p">The cats must be ordered by weight descending and will enter an elevator one by one. We would like to know what the running total weight is. If two cats have the same weight they must enter separately.</p><p name="709f" id="709f" class="graf graf--p graf-after--p">Wrong, this is because the first row and the second row have the same value and thus they are evaluated to the same thing,</p><pre name="9793" id="9793" class="graf graf--pre graf-after--p">SELECT name,<br>       SUM(weight) OVER (ORDER BY weight DESC) AS running_total_weight<br>FROM cats;</pre><p name="e588" id="e588" class="graf graf--p graf-after--pre">Right answer,</p><pre name="5e90" id="5e90" class="graf graf--pre graf-after--p">SELECT name,<br>       SUM(weight) OVER (ORDER BY weight DESC ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS running_total_weight<br>FROM cats;</pre><p name="0c95" id="0c95" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(6) Question 6. </strong><a href="https://learnsql.com/course/window-functions/introduction/introduction/question-4" data-href="https://learnsql.com/course/window-functions/introduction/introduction/question-4" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="0a5a" id="0a5a" class="graf graf--p graf-after--p">Show each <code class="markup--code markup--p-code">breed</code> with the average age of the dogs of that <code class="markup--code markup--p-code">breed</code>. Do not show breeds where the average <code class="markup--code markup--p-code">age</code> is lower than 5.</p><pre name="0b3d" id="0b3d" class="graf graf--pre graf-after--p">SELECT breed, AVG(age) <br>FROM dog<br>GROUP BY breed<br>HAVING AVG(age) &gt;= 5;</pre><p name="9e0a" id="9e0a" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(7) Question 7. </strong><a href="https://learnsql.com/course/window-functions/over/over/over-example" data-href="https://learnsql.com/course/window-functions/over/over/over-example" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="bf91" id="bf91" class="graf graf--p graf-after--p">For each employee, find their first name, last name, salary, and the sum of all salaries in the company. Note that the last column is an aggregated column, even though you’re not using a <code class="markup--code markup--p-code">GROUP BY</code>.</p><p name="9e00" id="9e00" class="graf graf--p graf-after--p">Wrong, we are not asking to accumulate in the last column, just show the aggregated number without GROUP BY,</p><pre name="4bdc" id="4bdc" class="graf graf--pre graf-after--p">SELECT first_name, last_name, salary,<br>       SUM(salary) OVER (ORDER BY salary)<br>FROM employee;</pre><p name="f8c9" id="f8c9" class="graf graf--p graf-after--pre">Right answer,</p><pre name="75fa" id="75fa" class="graf graf--pre graf-after--p">SELECT first_name, last_name, salary,<br>       SUM(salary) OVER ()<br>FROM employee;</pre><p name="8825" id="8825" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(8) Question 8. </strong><a href="https://learnsql.com/course/window-functions/over/over/over-practice-2" data-href="https://learnsql.com/course/window-functions/over/over/over-practice-2" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="f7d7" id="f7d7" class="graf graf--p graf-after--p">For each item in the <code class="markup--code markup--p-code">purchase</code> table, select its name (column <code class="markup--code markup--p-code">item</code>), <code class="markup--code markup--p-code">price</code> and the average price of all items.</p><pre name="b4d7" id="b4d7" class="graf graf--pre graf-after--p">SELECT item, price, AVG(price) OVER ()<br>FROM purchase;</pre><p name="b8e9" id="b8e9" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(9) Question 9. </strong><a href="https://learnsql.com/course/window-functions/over/computations-with-over/over-mathematic" data-href="https://learnsql.com/course/window-functions/over/computations-with-over/over-mathematic" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[Link]</a></p><p name="6167" id="6167" class="graf graf--p graf-after--p">For each employee in table <code class="markup--code markup--p-code">employee</code>, select first and last name, <code class="markup--code markup--p-code">years_worked</code>, an average of years spent in the company by all employees, and the difference between the <code class="markup--code markup--p-code">years_worked</code> and the average as <code class="markup--code markup--p-code">difference</code>.</p><pre name="7084" id="7084" class="graf graf--pre graf-after--p">SELECT first_name, last_name, years_worked,<br>       AVG(years_worked) OVER (),<br>       years_worked - AVG(years_worked) OVER () AS difference<br>FROM employee</pre><p name="6b93" id="6b93" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(10) Question 10. </strong><a href="https://learnsql.com/course/window-functions/over/aggregate-functions-with-OVER/over-count" data-href="https://learnsql.com/course/window-functions/over/aggregate-functions-with-OVER/over-count" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[link]</a></p><p name="b1cb" id="b1cb" class="graf graf--p graf-after--p">For each employee that earns more than 4000, show their <code class="markup--code markup--p-code">first_name</code>, <code class="markup--code markup--p-code">last_name</code>, <code class="markup--code markup--p-code">salary</code> and the number of all employees who earn more than 4000.</p><pre name="8ca3" id="8ca3" class="graf graf--pre graf-after--p">SELECT first_name, last_name, salary,<br>       COUNT(*) OVER ()<br>FROM employee<br>WHERE salary &gt; 4000;</pre><p name="ec4c" id="ec4c" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(11) Question 11 (slightly modified). </strong><a href="https://learnsql.com/course/window-functions/over/over-and-where/range-of-over" data-href="https://learnsql.com/course/window-functions/over/over-and-where/range-of-over" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[link]</a></p><p name="1d85" id="1d85" class="graf graf--p graf-after--p">Show the <code class="markup--code markup--p-code">first_name</code>, <code class="markup--code markup--p-code">last_name</code> and <code class="markup--code markup--p-code">salary</code> of every person who works in departments with <code class="markup--code markup--p-code">id</code> 1, 2, or 3, along with the average salary calculated in each of those three departments.</p><pre name="82eb" id="82eb" class="graf graf--pre graf-after--p">SELECT first_name, last_name, salary, AVG(salary) OVER (PARTITION BY department.id)<br>FROM employee<br>LEFT JOIN department<br>ON employee.department_id = department.id<br>WHERE department.id = 1 <br>OR department.id = 2<br>OR department.id = 3;</pre><p name="0691" id="0691" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(12) Question 12. </strong><a href="https://learnsql.com/course/window-functions/over/over-and-where/over-and-where" data-href="https://learnsql.com/course/window-functions/over/over-and-where/over-and-where" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">[link]</a></p><p name="2df2" id="2df2" class="graf graf--p graf-after--p">You cannot put window functions in <code class="markup--code markup--p-code">WHERE</code>. Why? The window functions are applied after the rows are selected. If the window functions were in a <code class="markup--code markup--p-code">WHERE</code> clause, you&#39;d get a circular dependency: in order to compute the window function, you have to filter the rows with <code class="markup--code markup--p-code">WHERE</code>, which requires to compute the window function. For example, it can’t be,</p><pre name="301e" id="301e" class="graf graf--pre graf-after--p">SELECT first_name, last_name, salary,<br>       AVG(salary) OVER()<br>FROM employee<br>WHERE salary &gt; AVG(salary) OVER ();</pre><p name="b42a" id="b42a" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">2. JSON &amp; User-defined Functions &amp; Views &amp; CTE</strong></p><p name="8afe" id="8afe" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(1) Answer the following questions.</strong></p><ul class="postList"><li name="bd9a" id="bd9a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Fill in the blank: Suppose we have the following data as the first row in the table nytimes, then what will be blank if we want to query the text typed oid?</strong></li></ul><p name="54fa" id="54fa" class="graf graf--p graf-after--li">Query:</p><pre name="c1ef" id="c1ef" class="graf graf--pre graf-after--p">SELECT data __________ FROM nytimes;</pre><p name="f143" id="f143" class="graf graf--p graf-after--pre">data:</p><pre name="b177" id="b177" class="graf graf--pre graf-after--p">{&quot;_id&quot;:{&quot;$oid&quot;:&quot;5b4aa4ead3089013507db18b&quot;},<br> &quot;bestsellers_date&quot;:<br> {&quot;$date&quot;:{&quot;$numberLong&quot;:&quot;1211587200000&quot;}},<br> &quot;published_date&quot;:<br> {&quot;$date&quot;:{&quot;$numberLong&quot;:&quot;1212883200000&quot;}},<br> &quot;amazon_product_url&quot;:&quot;<a href="http://www.amazon.com/Odd-Hours-Dean-Koontz/dp/0553807056?tag=NYTBS-20" data-href="http://www.amazon.com/Odd-Hours-Dean-Koontz/dp/0553807056?tag=NYTBS-20" class="markup--anchor markup--pre-anchor" rel="nofollow noopener" target="_blank">http://www.amazon.com/Odd-Hours-Dean-Koontz/dp/0553807056?tag=NYTBS-20</a>&quot;,<br> &quot;author&quot;:&quot;Dean R Koontz&quot;,<br> &quot;description&quot;:&quot;Odd Thomas, who can communicate with the dead, confronts evil forces in a California coastal town.&quot;,<br> &quot;price&quot;:{&quot;$numberInt&quot;:&quot;27&quot;},<br> &quot;publisher&quot;:&quot;Bantam&quot;,<br> &quot;title&quot;:&quot;ODD HOURS&quot;,<br> &quot;rank&quot;:{&quot;$numberInt&quot;:&quot;1&quot;},<br> &quot;rank_last_week&quot;:{&quot;$numberInt&quot;:&quot;0&quot;},<br> &quot;weeks_on_list&quot;:{&quot;$numberInt&quot;:&quot;1&quot;}}</pre><p name="8821" id="8821" class="graf graf--p graf-after--pre">Ans:</p><pre name="cf1c" id="cf1c" class="graf graf--pre graf-after--p">-&gt; &#39;_id&#39; -&gt;&gt; &#39;$oid&#39;</pre><ul class="postList"><li name="c1eb" id="c1eb" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">Fill in the blank: Suppose we have the following data as the first row in the table nytimes, then what will be blank if we want to query the JSON typed oid?</strong></li></ul><p name="630d" id="630d" class="graf graf--p graf-after--li">Query:</p><pre name="abac" id="abac" class="graf graf--pre graf-after--p">SELECT data __________ FROM nytimes;</pre><p name="1441" id="1441" class="graf graf--p graf-after--pre">data:</p><pre name="8686" id="8686" class="graf graf--pre graf-after--p">{&quot;_id&quot;:{&quot;$oid&quot;:&quot;5b4aa4ead3089013507db18b&quot;},<br> &quot;bestsellers_date&quot;:<br> {&quot;$date&quot;:{&quot;$numberLong&quot;:&quot;1211587200000&quot;}},<br> &quot;published_date&quot;:<br> {&quot;$date&quot;:{&quot;$numberLong&quot;:&quot;1212883200000&quot;}},<br> &quot;amazon_product_url&quot;:&quot;<a href="http://www.amazon.com/Odd-Hours-Dean-Koontz/dp/0553807056?tag=NYTBS-20" data-href="http://www.amazon.com/Odd-Hours-Dean-Koontz/dp/0553807056?tag=NYTBS-20" class="markup--anchor markup--pre-anchor" rel="nofollow noopener noopener" target="_blank">http://www.amazon.com/Odd-Hours-Dean-Koontz/dp/0553807056?tag=NYTBS-20</a>&quot;,<br> &quot;author&quot;:&quot;Dean R Koontz&quot;,<br> &quot;description&quot;:&quot;Odd Thomas, who can communicate with the dead, confronts evil forces in a California coastal town.&quot;,<br> &quot;price&quot;:{&quot;$numberInt&quot;:&quot;27&quot;},<br> &quot;publisher&quot;:&quot;Bantam&quot;,<br> &quot;title&quot;:&quot;ODD HOURS&quot;,<br> &quot;rank&quot;:{&quot;$numberInt&quot;:&quot;1&quot;},<br> &quot;rank_last_week&quot;:{&quot;$numberInt&quot;:&quot;0&quot;},<br> &quot;weeks_on_list&quot;:{&quot;$numberInt&quot;:&quot;1&quot;}}</pre><p name="db90" id="db90" class="graf graf--p graf-after--pre">Ans:</p><pre name="1cda" id="1cda" class="graf graf--pre graf-after--p">-&gt; &#39;_id&#39; -&gt; &#39;$oid&#39;</pre><ul class="postList"><li name="5867" id="5867" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">Fill in the blank: If we want to check the data type of the data column in the relation nytimes, what function can we write in the blank?</strong></li></ul><p name="295d" id="295d" class="graf graf--p graf-after--li">Query:</p><pre name="d4e0" id="d4e0" class="graf graf--pre graf-after--p">SELECT __________(data) FROM nytimes;</pre><p name="2a67" id="2a67" class="graf graf--p graf-after--pre">Ans:</p><pre name="9f32" id="9f32" class="graf graf--pre graf-after--p">pg_typeof</pre><ul class="postList"><li name="b727" id="b727" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">Fill in the blank: Suppose we want to change the text typed column to the JSON type, what function can we use to fill in the blank?</strong></li></ul><p name="7879" id="7879" class="graf graf--p graf-after--li">Query:</p><pre name="6b35" id="6b35" class="graf graf--pre graf-after--p">WITH tmp AS (SELECT &#39;something&#39; AS txt)<br>SELECT _________(txt) AS js FROM tmp;</pre><p name="b033" id="b033" class="graf graf--p graf-after--pre">Ans:</p><pre name="204e" id="204e" class="graf graf--pre graf-after--p">TO_JSON</pre><ul class="postList"><li name="d449" id="d449" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">Fill in the blank: Suppose we want to change a table of values to a JSON table, then what function can we use to fill in the blank?</strong></li></ul><p name="7561" id="7561" class="graf graf--p graf-after--li">Query:</p><pre name="5078" id="5078" class="graf graf--pre graf-after--p">SELECT ________(tablename) FROM tablename;</pre><p name="cd43" id="cd43" class="graf graf--p graf-after--pre">Ans:</p><pre name="62f0" id="62f0" class="graf graf--pre graf-after--p">TO_JSON</pre><p name="d290" id="d290" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(2) T/F Questions</strong></p><ul class="postList"><li name="a071" id="a071" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">You can query a view.</strong></li></ul><p name="22c0" id="22c0" class="graf graf--p graf-after--li">Ans: True</p><ul class="postList"><li name="a71f" id="a71f" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The view is a table stored in the disk.</strong></li></ul><p name="3953" id="3953" class="graf graf--p graf-after--li">Ans: False</p><ul class="postList"><li name="36a8" id="36a8" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The view is a table stored in the memory.</strong></li></ul><p name="402e" id="402e" class="graf graf--p graf-after--li">Ans: False</p><ul class="postList"><li name="c1c0" id="c1c0" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The view is a table stored in the schema.</strong></li></ul><p name="9785" id="9785" class="graf graf--p graf-after--li">Ans: False</p><ul class="postList"><li name="b514" id="b514" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The view is an operation stored in the schema (disk).</strong></li></ul><p name="4d0e" id="4d0e" class="graf graf--p graf-after--li">Ans: True</p><ul class="postList"><li name="f5f1" id="f5f1" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">If you update data in a view, the corresponding rows in the base table that the view is referencing are also updated.</strong></li></ul><p name="be6d" id="be6d" class="graf graf--p graf-after--li">Ans: True. We can test the following query,</p><pre name="46c7" id="46c7" class="graf graf--pre graf-after--p">CREATE TABLE hi (<br>   id INTEGER,<br>   name TEXT<br>);</pre><pre name="62ba" id="62ba" class="graf graf--pre graf-after--pre">INSERT INTO hi VALUES (1, &#39;Adam&#39;);<br>INSERT INTO hi VALUES (2, &#39;Echo&#39;);</pre><pre name="0bf6" id="0bf6" class="graf graf--pre graf-after--pre">SELECT * FROM hi;</pre><pre name="e4dc" id="e4dc" class="graf graf--pre graf-after--pre">CREATE VIEW hi_view AS (<br>   SELECT * FROM hi<br>);</pre><pre name="d83b" id="d83b" class="graf graf--pre graf-after--pre">SELECT * FROM hi_view;</pre><pre name="2689" id="2689" class="graf graf--pre graf-after--pre">UPDATE hi_view SET id = 3 WHERE name = &#39;Echo&#39;;</pre><pre name="9420" id="9420" class="graf graf--pre graf-after--pre">SELECT * FROM hi_view;<br>SELECT * FROM hi;</pre><ul class="postList"><li name="ba71" id="ba71" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">If you update data in a base table, the corresponding rows in the view that is referencing this table are also updated.</strong></li></ul><p name="cdfb" id="cdfb" class="graf graf--p graf-after--li">Ans: True. We can test the following query (follows the last query),</p><pre name="2b11" id="2b11" class="graf graf--pre graf-after--p">CREATE OR REPLACE VIEW hi_view AS (<br>   SELECT * FROM hi<br>);</pre><pre name="6711" id="6711" class="graf graf--pre graf-after--pre">SELECT * FROM hi_view;</pre><pre name="b531" id="b531" class="graf graf--pre graf-after--pre">UPDATE hi SET id = 4 WHERE name = &#39;Echo&#39;;</pre><pre name="69b1" id="69b1" class="graf graf--pre graf-after--pre">SELECT * FROM hi_view;<br>SELECT * FROM hi;</pre><ul class="postList"><li name="a90d" id="a90d" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">A temporary table (created from a CTE) can be referenced in different queries.</strong></li></ul><p name="0aea" id="0aea" class="graf graf--p graf-after--li">Ans: False.</p><ul class="postList"><li name="8e7a" id="8e7a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The full name of the CTE is Consistency Table Expression.</strong></li></ul><p name="8c18" id="8c18" class="graf graf--p graf-after--li">Ans: False. It is called the common table expression.</p><ul class="postList"><li name="e110" id="e110" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Json is commonly used for browser-server communication for REST APIs.</strong></li></ul><p name="6a55" id="6a55" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="9c6a" id="9c6a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Postgres automatically validates the JSON format.</strong></li></ul><p name="225e" id="225e" class="graf graf--p graf-after--li">Ans: True.</p><p name="9122" id="9122" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(3) Coding Question</strong></p><p name="a6d4" id="a6d4" class="graf graf--p graf-after--p">Use the following query to create a table named cats,</p><pre name="d377" id="d377" class="graf graf--pre graf-after--p">DROP TABLE IF EXISTS cats;</pre><pre name="315c" id="315c" class="graf graf--pre graf-after--pre">CREATE TABLE cats (<br>    name TEXT,<br>    age INTEGER,<br>    breed TEXT,<br>    owner_id INTEGER<br>);</pre><pre name="fffa" id="fffa" class="graf graf--pre graf-after--pre">INSERT INTO cats (name, age, breed, owner_id) VALUES (&#39;Maru&#39;, 3 , &#39;Scottish Fold&#39;, 1);<br>INSERT INTO cats (name, age, breed, owner_id) VALUES (&#39;Hana&#39;, 1 , &#39;Tabby&#39;, 1);<br>INSERT INTO cats (name, age, breed) VALUES (&#39;Lily Bub&#39;, 5, &#39;American Shorthair&#39;);<br>INSERT INTO cats (name, age, breed) VALUES (&#39;Moe&#39;, 10, &#39;Tabby&#39;);<br>INSERT INTO cats (name, age, breed) VALUES (&#39;Patches&#39;, 2, &#39;Calico&#39;);</pre><pre name="1ee7" id="1ee7" class="graf graf--pre graf-after--pre">SELECT * FROM cats;</pre><figure name="f926" id="f926" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*258aUhBHDK4Vs9ugsgkOEw.png" data-width="1418" data-height="330" src="https://cdn-images-1.medium.com/max/800/1*258aUhBHDK4Vs9ugsgkOEw.png"></figure><ul class="postList"><li name="cdec" id="cdec" class="graf graf--li graf-after--figure">Create a function owner when given a cat’s name, it will return the owner id for us. Test Hana and Moe for our result.</li></ul><pre name="f95b" id="f95b" class="graf graf--pre graf-after--li">CREATE OR REPLACE FUNCTION owner (input_name TEXT)<br>RETURNS INTEGER AS<br>$$<br>    SELECT owner_id<br>    FROM cats<br>    WHERE name = input_name<br>$$<br>LANGUAGE SQL;</pre><pre name="3307" id="3307" class="graf graf--pre graf-after--pre">SELECT owner(&#39;Hana&#39;), owner(&#39;Moe&#39;);</pre><ul class="postList"><li name="7fab" id="7fab" class="graf graf--li graf-after--pre">Create a function that returns the table of information with a cat when there’s an owner of it. Test this function.</li></ul><pre name="debe" id="debe" class="graf graf--pre graf-after--li">CREATE OR REPLACE FUNCTION with_owner ()<br>RETURNS TABLE (name TEXT, age INTEGER, breed TEXT, owner_id INTEGER) AS<br>$$<br>    SELECT * <br>    FROM cats <br>    WHERE owner_id IS NOT NULL<br>$$<br>LANGUAGE SQL;</pre><pre name="c392" id="c392" class="graf graf--pre graf-after--pre">SELECT * FROM with_owner() AS tmp;</pre><ul class="postList"><li name="87f7" id="87f7" class="graf graf--li graf-after--pre">Create a function that deletes the records of cats when there’s no owner of them. Test this function.</li></ul><pre name="438d" id="438d" class="graf graf--pre graf-after--li">CREATE OR REPLACE FUNCTION delete_owner ()<br>RETURNS VOID AS<br>$$<br>    DELETE FROM cats <br>    WHERE owner_id IS NULL<br>$$<br>LANGUAGE SQL;</pre><pre name="1a53" id="1a53" class="graf graf--pre graf-after--pre">SELECT delete_owner();<br>SELECT * FROM cats;</pre><p name="0a4f" id="0a4f" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">3. Database Transactions</strong></p><p name="9795" id="9795" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(1) Answer the following questions</strong></p><ul class="postList"><li name="03a8" id="03a8" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What are the ACID properties of the transaction?</strong></li></ul><p name="79c8" id="79c8" class="graf graf--p graf-after--li">Ans: Atomicity, Consistency, Isolation, Durability</p><ul class="postList"><li name="5d8e" id="5d8e" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What are the 4 isolation levels?</strong></li></ul><p name="3290" id="3290" class="graf graf--p graf-after--li">Ans: Serializable, Repeatable Read, Read Committed, Read Uncommitted</p><ul class="postList"><li name="9a2e" id="9a2e" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Which isolation level is the safest/most isolated?</strong></li></ul><p name="9529" id="9529" class="graf graf--p graf-after--li">Ans: serializable</p><ul class="postList"><li name="3133" id="3133" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Which isolation schedule allows interleaved transactions?</strong></li></ul><p name="a449" id="a449" class="graf graf--p graf-after--li">Ans: serializable schedule</p><ul class="postList"><li name="6681" id="6681" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">How is durability preserved in a database?</strong></li></ul><p name="86b7" id="86b7" class="graf graf--p graf-after--li">Ans: WAL — Write-Ahead Logging. This means that the steps taken to make modifications to a database are logged first before they are actually committed. This way, if the DB crashes, we’ll still have the log with the instructions of what to do.</p><ul class="postList"><li name="e33e" id="e33e" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What is the throughput?</strong></li></ul><p name="c5d3" id="c5d3" class="graf graf--p graf-after--li">Ans: Transactions per second.</p><ul class="postList"><li name="8023" id="8023" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What’s the anomaly with the following transactions? (w = write, r = read, c = commit, ro = rollback, d = delete, s = search)</strong></li></ul><p name="a514" id="a514" class="graf graf--p graf-after--li">Schedule: w1(A)w2(A)r2(A)c2r1(A)c1</p><p name="1724" id="1724" class="graf graf--p graf-after--p">Ans: Lost update problem</p><ul class="postList"><li name="80ca" id="80ca" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What’s the anomaly with the following transactions?</strong></li></ul><p name="76d1" id="76d1" class="graf graf--p graf-after--li">Schedule: r1(X)r2(X)w1(X)r2(X)c1</p><p name="45d1" id="45d1" class="graf graf--p graf-after--p">Ans: Unrepeatable/Nonrepeatable read problem</p><ul class="postList"><li name="9dab" id="9dab" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What’s the anomaly with the following transactions?</strong></li></ul><p name="dcca" id="dcca" class="graf graf--p graf-after--li">Schedule: r1(X)s2(X)d1(X)s2(X)c1</p><p name="682d" id="682d" class="graf graf--p graf-after--p">Ans: Phantom read problem</p><ul class="postList"><li name="69c9" id="69c9" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What’s the anomaly with the following transactions?</strong></li></ul><p name="1587" id="1587" class="graf graf--p graf-after--li">Schedule: r1(X)w1(X)r2(X)ro1r2(X)c1</p><p name="431f" id="431f" class="graf graf--p graf-after--p">Ans: Dirty read problem</p><ul class="postList"><li name="1239" id="1239" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What’s the anomaly with the following transactions?</strong></li></ul><p name="99bb" id="99bb" class="graf graf--p graf-after--li">Schedule: r1(A)w1(A)r2(A)w2(A)r1(B)c2ro1</p><p name="b2a6" id="b2a6" class="graf graf--p graf-after--p">Ans: Dirty read problem</p><ul class="postList"><li name="7081" id="7081" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Which isolation level will allow the following schedule?</strong></li></ul><p name="6c10" id="6c10" class="graf graf--p graf-after--li">Schedule: r1(A)w1(A)r2(A)w2(A)r1(B)c2ro1</p><p name="813e" id="813e" class="graf graf--p graf-after--p">Ans: Read Uncommitted</p><ul class="postList"><li name="c551" id="c551" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Which isolation level will allow the following schedule?</strong></li></ul><p name="a47f" id="a47f" class="graf graf--p graf-after--li">Schedule: r1(A)r2(A)w2(A)r1(A)r2(B)w2(B)c1c2</p><p name="44a8" id="44a8" class="graf graf--p graf-after--p">Ans: Read Committed or Read Uncommitted, because the schedule above has the non-repeatable read problem.</p><ul class="postList"><li name="6aff" id="6aff" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What will be the schedule if we set the REPEATABLE READ level?</strong></li></ul><p name="85df" id="85df" class="graf graf--p graf-after--li">Original Schedule: r1(A)r2(A)w2(A)r1(A)r2(B)w2(B)c1c2</p><p name="b1e6" id="b1e6" class="graf graf--p graf-after--p">Ans: r1(A)r1(A)c1w2(A)r2(A)r2(B)w2(B)c2, because REPEATABLE READ will make an object read-only after reading until the transaction is ended.</p><ul class="postList"><li name="32c9" id="32c9" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What will be the problem with the following schedule under the REPEATABLE READ level?</strong></li></ul><p name="c0c6" id="c0c6" class="graf graf--p graf-after--li">Schedule: r1(A)r2(B)w1(B)w2(A)r1(A)r2(B)c1c2</p><p name="4e60" id="4e60" class="graf graf--p graf-after--p">Ans: Deadlock problem.</p><ul class="postList"><li name="eb01" id="eb01" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">What will be the schedule if we set the REPEATABLE READ level?</strong></li></ul><p name="c191" id="c191" class="graf graf--p graf-after--li">Original Schedule: r1(A)w1(A)r2(A)w2(A)r1(A)c1c2</p><p name="5bc3" id="5bc3" class="graf graf--p graf-after--p">Ans: r1(A)w1(A)r2(A)r1(A)c1w2(A)c2, this is because there’s a lost update problem and REPEATABLE READ will make an object read-only after reading until the transaction is ended.</p><ul class="postList"><li name="546f" id="546f" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">How can you avoid getting into the thrashing region?</strong></li></ul><p name="2086" id="2086" class="graf graf--p graf-after--li">Ans:</p><p name="1547" id="1547" class="graf graf--p graf-after--p">1) lock the smallest possible object (ex. lock rows instead of entire tables)<br>2) decrease the amount of time a transaction holds a lock<br>3) reduce hotspots (objects that frequently get locks placed on them)</p><p name="f5f4" id="f5f4" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(2) T/F Questions</strong></p><ul class="postList"><li name="fb68" id="fb68" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">A transaction is said to be a unit of the program’s execution.</strong></li></ul><p name="961f" id="961f" class="graf graf--p graf-after--li">Ans: True</p><ul class="postList"><li name="dae8" id="dae8" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Serializability is the property that a (possibly interleaved) execution of a group of transactions has the same effect on the database and produces the same output as some serial execution of those transactions.</strong></li></ul><p name="4b22" id="4b22" class="graf graf--p graf-after--li">Ans: True</p><ul class="postList"><li name="96b2" id="96b2" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">There can be conflicts in a serial schedule.</strong></li></ul><p name="e23d" id="e23d" class="graf graf--p graf-after--li">Ans: False. Because the serial schedule is not interleaved.</p><ul class="postList"><li name="777a" id="777a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">There’s no dirty read problem in PostgreSQL.</strong></li></ul><p name="512c" id="512c" class="graf graf--p graf-after--li">Ans: True. PostgreSQL <strong class="markup--strong markup--p-strong">doesn’t support the dirty read</strong>.</p><ul class="postList"><li name="cf24" id="cf24" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">There’s no phantom read problem in PostgreSQL.</strong></li></ul><p name="1900" id="1900" class="graf graf--p graf-after--li">Ans: True. PostgreSQL <strong class="markup--strong markup--p-strong">doesn’t support the phantom read</strong>.</p><ul class="postList"><li name="bd6b" id="bd6b" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">In PostgreSQL, the READ UNCOMMITTED level is treated as the READ COMMITTED level</strong></li></ul><p name="5bcd" id="5bcd" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="74ab" id="74ab" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">In PostgreSQL, the REPEATABLE READ level is treated as the SERIALIZABLE level</strong></li></ul><p name="8bac" id="8bac" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="4817" id="4817" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The time cost of executing a transaction can be predictable.</strong></li></ul><p name="e4ec" id="e4ec" class="graf graf--p graf-after--li">Ans: False. Because there can be a performance degradation problem.</p><ul class="postList"><li name="8f1c" id="8f1c" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The throughput</strong> <strong class="markup--strong markup--li-strong">is non-linear to the number of transactions.</strong></li></ul><p name="d663" id="d663" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="ecbf" id="ecbf" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">If you ROLLBACK at the end of a transaction, it goes back to the initial status before it started</strong></li></ul><p name="d8cc" id="d8cc" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="011e" id="011e" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">If you meet an error in the middle of a transaction, then a COMMIT will become a ROLLBACK.</strong></li></ul><p name="f766" id="f766" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="5ac6" id="5ac6" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Level of READ COMMITTED guarantees repeatable reads.</strong></li></ul><p name="9dd8" id="9dd8" class="graf graf--p graf-after--li">Ans: False. Or why we will need a REPEATABLE READ level?</p><ul class="postList"><li name="028f" id="028f" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Isolation means that either all commands or none of the commands are executed in one transaction.</strong></li></ul><p name="5697" id="5697" class="graf graf--p graf-after--li">Ans: False. This is atomicity.</p><ul class="postList"><li name="8e64" id="8e64" class="graf graf--li graf-after--p">Isolation guarantees that once a transaction has committed, its effects remain in the database.</li></ul><p name="5ed8" id="5ed8" class="graf graf--p graf-after--li">Ans: False. This is durability.</p><ul class="postList"><li name="eaed" id="eaed" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">When there’s a change (update/insert/ etc.) happens, the shared lock is upgraded to an exclusive lock.</strong></li></ul><p name="5152" id="5152" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="5199" id="5199" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">A shared lock will not prevent reads from the other transactions.</strong></li></ul><p name="3399" id="3399" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="5f8c" id="5f8c" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">A serializable schedule is always more efficient than a serial schedule based on the same transactions.</strong></li></ul><p name="f278" id="f278" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="c6da" id="c6da" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The more transactions you’re running, the higher the throughput.</strong></li></ul><p name="0b8d" id="0b8d" class="graf graf--p graf-after--li">Ans: False.</p><ul class="postList"><li name="ef97" id="ef97" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The READ UNCOMMITTED level barely means no locks.</strong></li></ul><p name="d9ce" id="d9ce" class="graf graf--p graf-after--li">Ans: True</p><p name="f793" id="f793" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">4. Schema Refinement</strong></p><p name="7b7a" id="7b7a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(1) 1NF</strong></p><ul class="postList"><li name="aa0d" id="aa0d" class="graf graf--li graf-after--p">The table has a primary key</li><li name="b7b6" id="b7b6" class="graf graf--li graf-after--li">There are no repeating attributes or lists within a column</li></ul><p name="74a1" id="74a1" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(2) 2NF</strong></p><ul class="postList"><li name="242c" id="242c" class="graf graf--li graf-after--p">It should be in the First Normal form.</li><li name="fc73" id="fc73" class="graf graf--li graf-after--li">And, it should not have <strong class="markup--strong markup--li-strong">Partial Dependency</strong>.</li></ul><p name="7f12" id="7f12" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(3) 3NF</strong></p><ul class="postList"><li name="2e76" id="2e76" class="graf graf--li graf-after--p">It is in the Second Normal form.</li><li name="3de2" id="3de2" class="graf graf--li graf-after--li">And, it doesn’t have <strong class="markup--strong markup--li-strong">Transitive Dependency</strong>.</li></ul><p name="29ca" id="29ca" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(4) T/F Questions</strong></p><ul class="postList"><li name="c0a4" id="c0a4" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">A relation is in 1NF if it doesn’t contain any functional dependencies.</strong></li></ul><p name="1023" id="1023" class="graf graf--p graf-after--li">Ans: False. 1NF should have at least one functional dependency.</p><ul class="postList"><li name="b0f0" id="b0f0" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">A relation is in 1NF if it doesn’t contain any repeating groups.</strong></li></ul><p name="0711" id="0711" class="graf graf--p graf-after--li">Ans: True</p><ul class="postList"><li name="e22a" id="e22a" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">A table is in 2NF if the table is in 1NF and there are no functional dependencies.</strong></li></ul><p name="b14d" id="b14d" class="graf graf--p graf-after--li">Ans: False. A table is in 2NF if the table is in 1NF and there are no partial dependencies.</p><ul class="postList"><li name="4782" id="4782" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">In 2NF, there are no attributes that are not functionally dependent on the relation’s primary key.</strong></li></ul><p name="6a3d" id="6a3d" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="cc68" id="cc68" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">When you normalize a relation by breaking it into two smaller relations, you must a primary key(s) for the new relation.</strong></li></ul><p name="75f8" id="75f8" class="graf graf--p graf-after--li">Ans: True. Because 1NF maintains a primary key for every relation.</p><ul class="postList"><li name="b985" id="b985" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Decomposition can improve performance.</strong></li></ul><p name="9eff" id="9eff" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="f329" id="f329" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">It will be costly to join all the subtables if you want to see the original table again.</strong></li></ul><p name="7793" id="7793" class="graf graf--p graf-after--li">Ans: True</p><ul class="postList"><li name="a4cf" id="a4cf" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">If every non-key attribute is only fully functionally dependent on the primary key, then the relation will be in 3NF.</strong></li></ul><p name="769e" id="769e" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="8d5e" id="8d5e" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">If every non-key attribute is fully functionally dependent on the primary key, then the relation will be in 2NF.</strong></li></ul><p name="7dae" id="7dae" class="graf graf--p graf-after--li">Ans: True. Because there can also be transitively dependent.</p><ul class="postList"><li name="5114" id="5114" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Suppose a relation R is in 3NF. Then an FD: X→A is not valid when X is not a proper subset of any key.</strong></li></ul><p name="5500" id="5500" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="f0d2" id="f0d2" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Redundancy in data may lead to its inconsistency.</strong></li></ul><p name="ccbb" id="ccbb" class="graf graf--p graf-after--li">Ans: True.</p><ul class="postList"><li name="0ec9" id="0ec9" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Inconsistency in data may lead to Redundancy.</strong></li></ul><p name="ffcd" id="ffcd" class="graf graf--p graf-after--li">Ans: False.</p><ul class="postList"><li name="7f85" id="7f85" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">Normalization is the process of minimizing redundancy and is accomplished through the various normal forms</strong></li></ul><p name="b2d9" id="b2d9" class="graf graf--p graf-after--li">Ans: True</p><ul class="postList"><li name="fa46" id="fa46" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The most common problems for data redundancy are redundant storage and update/insert/delete anomalies.</strong></li></ul><p name="a673" id="a673" class="graf graf--p graf-after--li">Ans: True.</p><p name="1f08" id="1f08" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(5) Coding Questions</strong></p><p name="b63c" id="b63c" class="graf graf--p graf-after--p">Use the following transactions to create a table named author and then answer the following questions,</p><pre name="d316" id="d316" class="graf graf--pre graf-after--p">DROP TABLE IF EXISTS author;</pre><pre name="8cdd" id="8cdd" class="graf graf--pre graf-after--pre">CREATE TABLE author (<br>    id INTEGER,<br>    author VARCHAR(50),<br>    birth_year INTEGER,<br>    two_books VARCHAR[]);</pre><pre name="8555" id="8555" class="graf graf--pre graf-after--pre">INSERT INTO author VALUES <br>(1, &#39;Ernest Hemingway&#39;, 1899, &#39;{The Old Man and the Sea, A Farewell to Arms}&#39;),<br>(2, &#39;Mark Twain&#39;, 1835,&#39;{Adventures of Huckleberry Finn, The Adventures of Tom Sawyer}&#39;),<br>(3, &#39;Virginia Woolf&#39;,1882 ,&#39;{Mrs Dalloway, A Room of One&#39;&#39;s Own}&#39;),<br>(4, &#39;Jane Austen&#39;, 1775, &#39;{Pride and Prejudice, Sense and Sensibility}&#39;);</pre><pre name="b028" id="b028" class="graf graf--pre graf-after--pre">SELECT * FROM author;</pre><figure name="81bf" id="81bf" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*3kW53TtFfjoHL1_kZTK-vQ.png" data-width="1512" data-height="326" src="https://cdn-images-1.medium.com/max/800/1*3kW53TtFfjoHL1_kZTK-vQ.png"></figure><ul class="postList"><li name="6707" id="6707" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">How to change this relation to 1NF?</strong></li></ul><p name="40b6" id="40b6" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">Step 1. There are no repeating attributes or lists within a column</strong></p><pre name="dfc5" id="dfc5" class="graf graf--pre graf-after--p">DROP TABLE IF EXISTS author_1nf;</pre><pre name="b841" id="b841" class="graf graf--pre graf-after--pre">CREATE TABLE author_1nf<br>(<br> id INTEGER,<br> author VARCHAR(50),<br> birth_year INTEGER,<br> books VARCHAR<br>);</pre><pre name="3db8" id="3db8" class="graf graf--pre graf-after--pre">INSERT INTO author_1nf (<br>    SELECT id, author, birth_year, two_books[1]<br>    FROM author<br>);</pre><pre name="dbc8" id="dbc8" class="graf graf--pre graf-after--pre">INSERT INTO author_1nf (<br>    SELECT id, author, birth_year, two_books[2]<br>    FROM author<br>);</pre><figure name="fb6d" id="fb6d" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*RLkadKWRIn8TZ2lw8jdojQ.png" data-width="1434" data-height="694" src="https://cdn-images-1.medium.com/max/800/1*RLkadKWRIn8TZ2lw8jdojQ.png"></figure><p name="2190" id="2190" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">Step 2. Assign a primary key for the relation</strong></p><p name="69d4" id="69d4" class="graf graf--p graf-after--p">FD: id, books → author; id, books → birth_year.</p><p name="3513" id="3513" class="graf graf--p graf-after--p">Thus, the PRIMARY KEY should be (id, books)</p><pre name="178c" id="178c" class="graf graf--pre graf-after--p">ALTER TABLE author_1nf ADD PRIMARY KEY (id, books);</pre><ul class="postList"><li name="1e3d" id="1e3d" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">With the 1NF result, how to change this relation to 2NF?</strong></li></ul><p name="106b" id="106b" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">Step 1. Remove any partial dependency.</strong></p><p name="f3ac" id="f3ac" class="graf graf--p graf-after--p">PD: id → author, birth_year</p><p name="6dc9" id="6dc9" class="graf graf--p graf-after--p">Thus, we have to split the relation into two smaller relations, author_2nf, and books. First, let’s create them all,</p><pre name="4b74" id="4b74" class="graf graf--pre graf-after--p">DROP TABLE IF EXISTS author_2nf, books CASCADE;</pre><pre name="c814" id="c814" class="graf graf--pre graf-after--pre">CREATE TABLE author_2nf<br>(<br>    id INTEGER,<br>    author VARCHAR(50),<br>    birth_year INTEGER<br>);</pre><pre name="8e3d" id="8e3d" class="graf graf--pre graf-after--pre">CREATE TABLE books<br>(<br>    author_id INTEGER,<br>    book VARCHAR<br>);</pre><p name="8d5f" id="8d5f" class="graf graf--p graf-after--pre">Then we insert data to them,</p><pre name="cf1f" id="cf1f" class="graf graf--pre graf-after--p">INSERT INTO author_2nf<br>(<br>    SELECT <strong class="markup--strong markup--pre-strong">DISTINCT</strong> id, author, birth_year <br>    FROM author_1nf<br>);</pre><pre name="189f" id="189f" class="graf graf--pre graf-after--pre">INSERT INTO books<br>(<br>    SELECT id, books<br>    FROM author_1nf<br>);</pre><p name="192e" id="192e" class="graf graf--p graf-after--pre">Third, set the primary key because the relations should be in the 1NF forms.</p><pre name="8b50" id="8b50" class="graf graf--pre graf-after--p">ALTER TABLE author_2nf ADD PRIMARY KEY (id);</pre><pre name="bb30" id="bb30" class="graf graf--pre graf-after--pre">ALTER TABLE books ADD COLUMN book_id SERIAL;<br>ALTER TABLE books ADD PRIMARY KEY (book_id);</pre><p name="e6c9" id="e6c9" class="graf graf--p graf-after--pre">Last, add a foreign key to the “books” relation so that its column id will depend on the values of the author_2nf relation.</p><pre name="9573" id="9573" class="graf graf--pre graf-after--p">ALTER TABLE books ADD CONSTRAINT author_foreign_key FOREIGN KEY  (author_id) REFERENCES author_2nf(id) ON UPDATE CASCADE ON DELETE CASCADE;</pre><p name="6ce0" id="6ce0" class="graf graf--p graf-after--pre">Finally, check out the results.</p><pre name="c749" id="c749" class="graf graf--pre graf-after--p">SELECT * FROM author_2nf;</pre><figure name="46e7" id="46e7" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*ioLUTVVHWyCV74wk1DoIYg.png" data-width="1018" data-height="342" src="https://cdn-images-1.medium.com/max/800/1*ioLUTVVHWyCV74wk1DoIYg.png"></figure><pre name="c83e" id="c83e" class="graf graf--pre graf-after--figure">SELECT * FROM books;</pre><figure name="43bb" id="43bb" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*4Jc-Ekg6Xic6SxrccKjt_A.png" data-width="1506" data-height="670" src="https://cdn-images-1.medium.com/max/800/1*4Jc-Ekg6Xic6SxrccKjt_A.png"></figure><ul class="postList"><li name="f9d5" id="f9d5" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Join the two split relations to create the original one.</strong></li></ul><pre name="98ea" id="98ea" class="graf graf--pre graf-after--li">SELECT author_2nf.*, books.book<br>FROM author_2nf<br>LEFT JOIN books<br>ON author_2nf.id = books.author_id;</pre><ul class="postList"><li name="9160" id="9160" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">With the 2NF result, how to change this relation to 3NF?</strong></li></ul><p name="21b4" id="21b4" class="graf graf--p graf-after--li">TD: id → author; id → birth_year; author → birth_year.</p><p name="5392" id="5392" class="graf graf--p graf-after--p">So we have to split the 2NF relation for a 3NF result. First, let’s create two new relations,</p><pre name="a888" id="a888" class="graf graf--pre graf-after--p">DROP TABLE IF EXISTS author_3nf, author_birth_year;</pre><pre name="890c" id="890c" class="graf graf--pre graf-after--pre">CREATE TABLE author_3nf<br>(<br>    id INTEGER PRIMARY KEY,<br>    author VARCHAR<br>);</pre><pre name="6274" id="6274" class="graf graf--pre graf-after--pre">CREATE TABLE author_birth_year<br>(<br>    id INTEGER PRIMARY KEY,<br>    birth_year INTEGER<br>);</pre><p name="982a" id="982a" class="graf graf--p graf-after--pre">Then, let’s split the author_2nf relation,</p><pre name="41fe" id="41fe" class="graf graf--pre graf-after--p">INSERT INTO author_3nf (<br>    SELECT id, author <br>    FROM author_2nf<br>);</pre><pre name="e376" id="e376" class="graf graf--pre graf-after--pre">INSERT INTO author_birth_year<br>(<br>    SELECT id, birth_year<br>    FROM author_2nf<br>);</pre><p name="ba0e" id="ba0e" class="graf graf--p graf-after--pre">Third, we don’t have to assign primary keys to all of them (for 1NF purpose), this is because the newly created relations will inherit the PRIMARY KEY from the 2nf relation automatically. For example, if we try,</p><pre name="1c50" id="1c50" class="graf graf--pre graf-after--p">ALTER TABLE author_3nf ADD PRIMARY KEY (id);<br>ALTER TABLE author_birth_year ADD PRIMARY KEY (id);</pre><p name="072e" id="072e" class="graf graf--p graf-after--pre">Then there will be errors for us,</p><pre name="b817" id="b817" class="graf graf--pre graf-after--p">multiple primary keys for table &quot;author_3nf&quot; are not allowed<br>multiple primary keys for table &quot;author_birth_year&quot; are not allowed</pre><p name="30e3" id="30e3" class="graf graf--p graf-after--pre">Fourth, add a foreign key to the author_birth_year so that its id will depend on the id from the author_3nf (for 2NF purpose),</p><pre name="09d1" id="09d1" class="graf graf--pre graf-after--p">ALTER TABLE author_birth_year ADD CONSTRAINT birth_year_foreign_key FOREIGN KEY (id) REFERENCES author_3nf(id) ON UPDATE CASCADE ON DELETE CASCADE;</pre><p name="99a3" id="99a3" class="graf graf--p graf-after--pre">Also, we have to update the foreign key for the “books” relation,</p><pre name="9d1e" id="9d1e" class="graf graf--pre graf-after--p">ALTER TABLE books DROP CONSTRAINT author_foreign_key;<br>ALTER TABLE books ADD CONSTRAINT author_foreign_key FOREIGN KEY (author_id) REFERENCES author_3nf(id) ON UPDATE CASCADE ON DELETE CASCADE;</pre><p name="766f" id="766f" class="graf graf--p graf-after--pre">Finally, we can check them out,</p><pre name="6ca5" id="6ca5" class="graf graf--pre graf-after--p">SELECT * FROM author_3nf;</pre><figure name="1e1a" id="1e1a" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*DBYoBCQST_9BdU_rQO4Kug.png" data-width="1060" data-height="334" src="https://cdn-images-1.medium.com/max/800/1*DBYoBCQST_9BdU_rQO4Kug.png"></figure><pre name="3eec" id="3eec" class="graf graf--pre graf-after--figure">SELECT * FROM author_birth_year;</pre><figure name="c2af" id="c2af" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*VsEFUj63jN98ge8pR3twqg.png" data-width="1444" data-height="334" src="https://cdn-images-1.medium.com/max/800/1*VsEFUj63jN98ge8pR3twqg.png"></figure><pre name="fc47" id="fc47" class="graf graf--pre graf-after--figure">SELECT * FROM books;</pre><figure name="d65d" id="d65d" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*4Jc-Ekg6Xic6SxrccKjt_A.png" src="https://cdn-images-1.medium.com/max/800/1*4Jc-Ekg6Xic6SxrccKjt_A.png"></figure><ul class="postList"><li name="24ed" id="24ed" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Join the three split relations of 3NF to create the original relationship.</strong></li></ul><pre name="98d4" id="98d4" class="graf graf--pre graf-after--li graf--trailing">SELECT author_3nf.*, author_birth_year.birth_year, books.book<br>FROM author_3nf<br>LEFT JOIN author_birth_year<br>ON author_3nf.id = author_birth_year.id<br>LEFT JOIN books<br>ON author_3nf.id = books.author_id;</pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/76ab16cb7f99"><time class="dt-published" datetime="2020-12-11T04:21:21.609Z">December 11, 2020</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/relational-database-review-12-final-review-76ab16cb7f99" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>