<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>High-Performance Computer Architecture 14 | Tomasulo’s Algorithm Part 2</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">High-Performance Computer Architecture 14 | Tomasulo’s Algorithm Part 2</h1>
</header>
<section data-field="subtitle" class="p-summary">
Series: High-Performance Computer Architecture
</section>
<section data-field="body" class="e-content">
<section name="4779" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="11fb" id="11fb" class="graf graf--h3 graf--leading graf--title">High-Performance Computer Architecture 14 | Tomasulo’s Algorithm Part 2</h3><figure name="5d87" id="5d87" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*6U3RIIwHCgd8nw5D.png" data-width="1446" data-height="864" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*6U3RIIwHCgd8nw5D.png"></figure><ol class="postList"><li name="1dec" id="1dec" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Load &amp; Store Instructions</strong></li></ol><p name="5e97" id="5e97" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(1) Dependencies for Memory</strong></p><p name="901c" id="901c" class="graf graf--p graf-after--p">Just like we have the data dependencies for the registers, there can be dependencies through memory.</p><ul class="postList"><li name="5a11" id="5a11" class="graf graf--li graf-after--p">RAW Dependency: First <code class="markup--code markup--li-code">SW</code> (store) to address <code class="markup--code markup--li-code">A</code>, then <code class="markup--code markup--li-code">LW</code> (load) from it.</li><li name="09bd" id="09bd" class="graf graf--li graf-after--li">WAR Dependency: First <code class="markup--code markup--li-code">LW</code> from address <code class="markup--code markup--li-code">A</code>, then <code class="markup--code markup--li-code">SW</code> to it. If we <code class="markup--code markup--li-code">LW</code> again, we will get a value different from before.</li><li name="21ec" id="21ec" class="graf graf--li graf-after--li">WAW Dependency: Conduct <code class="markup--code markup--li-code">SW</code> twice to the same address <code class="markup--code markup--li-code">A</code>. Because we want the final value in the memory to be the value from the later <code class="markup--code markup--li-code">SW</code>, we have to keep the order of these two <code class="markup--code markup--li-code">SW</code>s.</li></ul><p name="6170" id="6170" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(2) Tomasulo’s Algorithm for Memory Dependencies</strong></p><p name="c4eb" id="c4eb" class="graf graf--p graf-after--p">Basically, we have two ways to deal with the memory dependencies,</p><ul class="postList"><li name="8073" id="8073" class="graf graf--li graf-after--p">Loads and stores are <strong class="markup--strong markup--li-strong">in-order</strong></li></ul><p name="5626" id="5626" class="graf graf--p graf-after--li">For all the load and store instructions, we first put them in the load or store queue (buffer) and then we just follow the order of these instructions. For example, a load doesn’t execute if there is a previous store pending, even though the load is ready to go but the store is still waiting.</p><ul class="postList"><li name="0a6d" id="0a6d" class="graf graf--li graf-after--p">Identify dependencies and reorder them</li></ul><p name="839c" id="839c" class="graf graf--p graf-after--li">This turns out to be more complicated than doing it for register-based dependencies. This is not the approach that we have chosen for Tomasulo’s algorithm, but this dependencies identification is actually used by the modern processors that we are going to talk about later.</p><p name="fc57" id="fc57" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">2. Tomasulo’s Algorithm: A Complex Example</strong></p><p name="52ea" id="52ea" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(0) Basic Settings</strong></p><p name="7e05" id="7e05" class="graf graf--p graf-after--p">Suppose we have the following assembly code and .D means double-precision,</p><pre name="0bd6" id="0bd6" class="graf graf--pre graf-after--p">L.D F6, 34(R2)<br>L.D F2, 45(R3)<br>MUL.D F0, F2, F4<br>SUB.D F8, F2, F6<br>DIV.D F10, F0, F6<br>ADD.D F6, F8, F2</pre><p name="6f31" id="6f31" class="graf graf--p graf-after--pre">Suppose we have 2 load and store reservation stations <code class="markup--code markup--p-code">LD1</code> and <code class="markup--code markup--p-code">LD2</code>, 3 add and subtract reservation stations <code class="markup--code markup--p-code">AD1</code>, <code class="markup--code markup--p-code">AD2</code>, and <code class="markup--code markup--p-code">AD3</code>, and 2 multiple and divide reservation stations <code class="markup--code markup--p-code">ML1</code> and <code class="markup--code markup--p-code">ML2</code>. We use <code class="markup--code markup--p-code">BUSY</code> to represent whether or not a reservation station is empty, <code class="markup--code markup--p-code">Op</code> for the operation, <code class="markup--code markup--p-code">Vj</code> for the first operand, <code class="markup--code markup--p-code">Vk</code> for the second operand, <code class="markup--code markup--p-code">Qj</code> for the first operand we are waiting for, <code class="markup--code markup--p-code">Qk</code> for the second operand we are waiting for, and <code class="markup--code markup--p-code">Disp</code> means whether or not this instruction can be dispatched.</p><figure name="4a13" id="4a13" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*J74jiUelE0wuic7uMUgyag.png" data-width="1728" data-height="614" src="https://cdn-images-1.medium.com/max/800/1*J74jiUelE0wuic7uMUgyag.png"></figure><p name="538b" id="538b" class="graf graf--p graf-after--figure">Also, we have to consider the execution cycles. In reality, we need more than 1 cycles for any arithmetic operations. Particularly, in this case, the cycles we need for these arithmetic operations are,</p><pre name="cd08" id="cd08" class="graf graf--pre graf-after--p">Load:  2 cycles<br> Add:  2 cycles<br> Mul: 10 cycles<br> Div: 40 cycles</pre><p name="4e0f" id="4e0f" class="graf graf--p graf-after--pre">We also have to know about the think about the register file. Originally, the <code class="markup--code markup--p-code">R2</code> is set to <code class="markup--code markup--p-code">100</code>, <code class="markup--code markup--p-code">R3</code> is set to <code class="markup--code markup--p-code">200</code>, and <code class="markup--code markup--p-code">F4</code> is set to <code class="markup--code markup--p-code">2.5</code>. The other registers are left empty.</p><figure name="c403" id="c403" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Bqx3XNcg0myOg-eKJOhHzA.png" data-width="1606" data-height="216" src="https://cdn-images-1.medium.com/max/800/1*Bqx3XNcg0myOg-eKJOhHzA.png"></figure><p name="f08e" id="f08e" class="graf graf--p graf-after--figure">Also, the RAT should be kept empty,</p><figure name="2bd3" id="2bd3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*JhPN_fG3uL3mFHigXh1qHg.png" data-width="1182" data-height="456" src="https://cdn-images-1.medium.com/max/800/1*JhPN_fG3uL3mFHigXh1qHg.png"></figure><p name="66a4" id="66a4" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(1) Cycle 1</strong></p><p name="911d" id="911d" class="graf graf--p graf-after--p">In cycle 1, the <code class="markup--code markup--p-code">L.D F6, 34(R2)</code> is issued to the reservation station. Because the address generation unit is independent, so we can directly get the value of <code class="markup--code markup--p-code">R2 + 34 = 134</code>.</p><figure name="8a8e" id="8a8e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*BpKeM3CRvfOZoIo_DrCoxw.png" data-width="1530" data-height="598" src="https://cdn-images-1.medium.com/max/800/1*BpKeM3CRvfOZoIo_DrCoxw.png"></figure><p name="63b6" id="63b6" class="graf graf--p graf-after--figure">Also, because the value returned will be assigned to F6, thus, we should rename the <code class="markup--code markup--p-code">F6</code> to <code class="markup--code markup--p-code">LD1</code> by RAT,</p><figure name="c5c4" id="c5c4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*tGbtwz81wyx3e4WrHCqZYA.png" data-width="1530" data-height="454" src="https://cdn-images-1.medium.com/max/800/1*tGbtwz81wyx3e4WrHCqZYA.png"></figure><p name="92ae" id="92ae" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(2) Cycle 2</strong></p><p name="daf4" id="daf4" class="graf graf--p graf-after--p">In cycle 2, the <code class="markup--code markup--p-code">L.D F2, 45(R3)</code> is issued to the reservation station and we can directly get the value of <code class="markup--code markup--p-code">R3 + 45 = 245</code>. We should also dispatch the <code class="markup--code markup--p-code">LD1</code> because it is ready after the first cycle. Note that we need 2 cycles to finish the load execution.</p><figure name="9a0f" id="9a0f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*piKUWORTefjmouLkbaYRiA.png" data-width="1530" data-height="606" src="https://cdn-images-1.medium.com/max/800/1*piKUWORTefjmouLkbaYRiA.png"></figure><p name="e4de" id="e4de" class="graf graf--p graf-after--figure">Also, the RAT should map <code class="markup--code markup--p-code">F2</code> to <code class="markup--code markup--p-code">LD2</code>.</p><figure name="f2c7" id="f2c7" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*muapN2MfeyXjWvKIGzYMuA.png" data-width="1530" data-height="452" src="https://cdn-images-1.medium.com/max/800/1*muapN2MfeyXjWvKIGzYMuA.png"></figure><p name="82f3" id="82f3" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(3) Cycle 3</strong></p><p name="9939" id="9939" class="graf graf--p graf-after--p">In cycle 3, the <code class="markup--code markup--p-code">MUL.D F0, F2, F4</code> is issued to the reservation station. When it is issued, according to the RAT, <code class="markup--code markup--p-code">F2</code> is mapping to <code class="markup--code markup--p-code">LD2</code>, and <code class="markup--code markup--p-code">F4</code> has a direct value <code class="markup--code markup--p-code">2.5</code> on RF. So the second operand <code class="markup--code markup--p-code">Vk</code> should be assigned to <code class="markup--code markup--p-code">2.5</code> and the first operand we are waiting for <code class="markup--code markup--p-code">Qj</code> should be assigned to <code class="markup--code markup--p-code">LD2</code>. Because the execution unit of the LD1 is still working, so we will not dispatch any instruction in this cycle.</p><figure name="75dd" id="75dd" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*IHrhm6Xezq3umMGjkLpdlA.png" data-width="1530" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*IHrhm6Xezq3umMGjkLpdlA.png"></figure><p name="eabe" id="eabe" class="graf graf--p graf-after--figure">Also, we have to rename <code class="markup--code markup--p-code">F0</code> to <code class="markup--code markup--p-code">ML1</code> by RAT,</p><figure name="8e45" id="8e45" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*4nmeWqoQeOswqeiLqSd1ug.png" data-width="1530" data-height="452" src="https://cdn-images-1.medium.com/max/800/1*4nmeWqoQeOswqeiLqSd1ug.png"></figure><p name="64c4" id="64c4" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(4) Cycle 4</strong></p><p name="3258" id="3258" class="graf graf--p graf-after--p">In cycle 4, the <code class="markup--code markup--p-code">SUB.D F8, F2, F6</code> is issued to the reservation station. Similarly, we can have (if we do not consider the dispatching and broadcasting now),</p><figure name="b5e8" id="b5e8" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*CoeZtrpmonbh2pldzGbiAg.png" data-width="1530" data-height="606" src="https://cdn-images-1.medium.com/max/800/1*CoeZtrpmonbh2pldzGbiAg.png"></figure><p name="8b10" id="8b10" class="graf graf--p graf-after--figure">Also, we should rename <code class="markup--code markup--p-code">F8</code> to <code class="markup--code markup--p-code">AD1</code> by RAT,</p><figure name="42be" id="42be" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*PgFq3sw_W_chj1YVcu4ARQ.png" data-width="1530" data-height="452" src="https://cdn-images-1.medium.com/max/800/1*PgFq3sw_W_chj1YVcu4ARQ.png"></figure><p name="243c" id="243c" class="graf graf--p graf-after--figure">Because it is already 2 cycles since we execute the first instruction. So the <code class="markup--code markup--p-code">LD1</code> is finished and <code class="markup--code markup--p-code">LD2</code> can be dispatched to the execution unit. <code class="markup--code markup--p-code">ML1</code> can not be dispatched because it is still waiting for the result of <code class="markup--code markup--p-code">LD2</code> in the register station. For the broadcasted result, let’s say the result of <code class="markup--code markup--p-code">LD1</code> is <code class="markup--code markup--p-code">7.1</code>. Because the result of <code class="markup--code markup--p-code">LD1</code> is being broadcasted, of course, it will not be busy in the reservation station. Then,</p><figure name="dd59" id="dd59" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*DeRjoYKDeA8sWfMx0X2ZoA.png" data-width="1530" data-height="604" src="https://cdn-images-1.medium.com/max/800/1*DeRjoYKDeA8sWfMx0X2ZoA.png"></figure><p name="3f95" id="3f95" class="graf graf--p graf-after--figure">So after broadcasting, the register file is now,</p><figure name="064e" id="064e" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*9bT1vWXQ8Zn3LCWYUARrAw.png" data-width="1530" data-height="224" src="https://cdn-images-1.medium.com/max/800/1*9bT1vWXQ8Zn3LCWYUARrAw.png"></figure><p name="42fa" id="42fa" class="graf graf--p graf-after--figure">And the RAT should be,</p><figure name="343b" id="343b" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*dwr5q8kKooeXF3DMt5aJ7A.png" data-width="1530" data-height="448" src="https://cdn-images-1.medium.com/max/800/1*dwr5q8kKooeXF3DMt5aJ7A.png"></figure><p name="bade" id="bade" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(5) Cycle 5</strong></p><p name="fe01" id="fe01" class="graf graf--p graf-after--p">In cycle 5, the <code class="markup--code markup--p-code">DIV.D F10, F0, F6</code> is issued to the reservation station. Similarly, we can have (if we do not consider the dispatching and broadcasting now),</p><figure name="f2cc" id="f2cc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*oFLqz1V3zUigphYVT3GrsQ.png" data-width="1530" data-height="604" src="https://cdn-images-1.medium.com/max/800/1*oFLqz1V3zUigphYVT3GrsQ.png"></figure><p name="d769" id="d769" class="graf graf--p graf-after--figure">Also, we should rename <code class="markup--code markup--p-code">F10</code> to <code class="markup--code markup--p-code">ML2</code> by RAT,</p><figure name="d106" id="d106" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*H-HiLdxFB4lNA8mgvLbXYw.png" data-width="1530" data-height="450" src="https://cdn-images-1.medium.com/max/800/1*H-HiLdxFB4lNA8mgvLbXYw.png"></figure><p name="9a63" id="9a63" class="graf graf--p graf-after--figure">If the dispatching and broadcasting are concerned, we can find out that because we are still executing the LD2, we can not dispatch or broadcast anything because all the instructions in the reservation stations are waiting for some results.</p><p name="fb3d" id="fb3d" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(6) Cycle 6</strong></p><p name="c795" id="c795" class="graf graf--p graf-after--p">In cycle 6, the <code class="markup--code markup--p-code">ADD.D F6, F8, F2</code> is issued to the reservation station. Similarly, we can have (if we do not consider the dispatching and broadcasting now),</p><figure name="9633" id="9633" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3ADixrtFjrbaVqhkBARRXg.png" data-width="1530" data-height="604" src="https://cdn-images-1.medium.com/max/800/1*3ADixrtFjrbaVqhkBARRXg.png"></figure><p name="773f" id="773f" class="graf graf--p graf-after--figure">Also, we should rename <code class="markup--code markup--p-code">F6</code> to <code class="markup--code markup--p-code">AD2</code> by RAT,</p><figure name="4be9" id="4be9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*c2Zw_BwNm9e4aELIck_6rQ.png" data-width="1530" data-height="452" src="https://cdn-images-1.medium.com/max/800/1*c2Zw_BwNm9e4aELIck_6rQ.png"></figure><p name="723a" id="723a" class="graf graf--p graf-after--figure">Now, let’s consider dispatching and broadcasting. First of all, the result of <code class="markup--code markup--p-code">LD2</code> (let’s say <code class="markup--code markup--p-code">-2.5</code>) will be broadcasted so the operands waiting for <code class="markup--code markup--p-code">LD2</code> in the register station will be replaced by this result. Also, because the <code class="markup--code markup--p-code">LD2</code> register station is no longer busy, we can release the occupation of <code class="markup--code markup--p-code">LD2</code>.</p><figure name="98e6" id="98e6" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*yt0P_bs08ji5ZDus3az9Jg.png" data-width="1530" data-height="588" src="https://cdn-images-1.medium.com/max/800/1*yt0P_bs08ji5ZDus3az9Jg.png"></figure><p name="fb8f" id="fb8f" class="graf graf--p graf-after--figure">After broadcasting, the register file is now,</p><figure name="68b3" id="68b3" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*dxomLeV22kvXQzwbR85KDg.png" data-width="1530" data-height="220" src="https://cdn-images-1.medium.com/max/800/1*dxomLeV22kvXQzwbR85KDg.png"></figure><p name="fa1a" id="fa1a" class="graf graf--p graf-after--figure">And the RAT should be,</p><figure name="0f57" id="0f57" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*8jhBuLEs2WIKDcvYX1thYg.png" data-width="1530" data-height="456" src="https://cdn-images-1.medium.com/max/800/1*8jhBuLEs2WIKDcvYX1thYg.png"></figure><p name="6603" id="6603" class="graf graf--p graf-after--figure">Under the condition that we can not capture a result and then dispatch the instruction in the same cycle, so we have to wait for the next cycle to dispatch <code class="markup--code markup--p-code">AD1</code> and <code class="markup--code markup--p-code">ML1</code>.</p><p name="9dbb" id="9dbb" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(7) Cycle 7</strong></p><p name="6507" id="6507" class="graf graf--p graf-after--p">Because there are no instructions in the instruction queue, we are not going to issue any new instructions since the present cycle. However, both <code class="markup--code markup--p-code">AD1</code> and <code class="markup--code markup--p-code">ML1</code> can be dispatched. We need 2 cycles for <code class="markup--code markup--p-code">AD1</code> to complete and 10 cycles for <code class="markup--code markup--p-code">ML1</code> to complete.</p><figure name="8f74" id="8f74" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*tWUGTInUBUhv5TOdkw6bBg.png" data-width="1530" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*tWUGTInUBUhv5TOdkw6bBg.png"></figure><p name="9492" id="9492" class="graf graf--p graf-after--figure">Because there’s no broadcasting, we don’t have to change the RF and RAT.</p><p name="8b93" id="8b93" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">(8) Cycle 9</strong></p><p name="4eb8" id="4eb8" class="graf graf--p graf-after--p">There is nothing specific for cycle 8, but for cycle 9, the execution of <code class="markup--code markup--p-code">AD1</code> finishes and the result should be broadcast. The <code class="markup--code markup--p-code">AD1</code> reservation station will be released, and the result of <code class="markup--code markup--p-code">AD1</code>, which is <code class="markup--code markup--p-code">-9.6</code> would be broadcasted to both the reservation station and the RAT &amp; RF. For the reservation station, <code class="markup--code markup--p-code">AD2</code> is waiting for the result of <code class="markup--code markup--p-code">AD1</code>, so its operand will be updated.</p><figure name="37bb" id="37bb" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*-ouB6BjpFV3znBCa0SMbfA.png" data-width="1530" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*-ouB6BjpFV3znBCa0SMbfA.png"></figure><p name="79b1" id="79b1" class="graf graf--p graf-after--figure">According to RAT, the result of <code class="markup--code markup--p-code">AD1</code> should be set to <code class="markup--code markup--p-code">F8</code>. So we should update the <code class="markup--code markup--p-code">F8</code> register in the RF and then empty the <code class="markup--code markup--p-code">F8</code> entry of RAT. The register file should be,</p><figure name="95a0" id="95a0" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*EVqTqNoQa9x2NOaq75UJcw.png" data-width="1530" data-height="214" src="https://cdn-images-1.medium.com/max/800/1*EVqTqNoQa9x2NOaq75UJcw.png"></figure><p name="1c1c" id="1c1c" class="graf graf--p graf-after--figure">The RAT should be,</p><figure name="5ca1" id="5ca1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3y17XVGbcDYxDHZHwvtJOA.png" data-width="1530" data-height="452" src="https://cdn-images-1.medium.com/max/800/1*3y17XVGbcDYxDHZHwvtJOA.png"></figure><p name="5d44" id="5d44" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(9) Cycle 10</strong></p><p name="d223" id="d223" class="graf graf--p graf-after--p">In cycle 10, the <code class="markup--code markup--p-code">AD2</code> instruction will be dispatched and its execution will be finished in cycle 12.</p><figure name="1119" id="1119" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*DXlfMHYpDTaBBi4ZueAQtw.png" data-width="1530" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*DXlfMHYpDTaBBi4ZueAQtw.png"></figure><p name="20c8" id="20c8" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(10) Cycle 12</strong></p><p name="0a45" id="0a45" class="graf graf--p graf-after--p">In cycle 12, the execution of <code class="markup--code markup--p-code">AD2</code> will be finished. So the result will be broadcasted. Then the reservation station will be,</p><figure name="190f" id="190f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*mGawB8UdffqaSeDqVMejrg.png" data-width="1530" data-height="600" src="https://cdn-images-1.medium.com/max/800/1*mGawB8UdffqaSeDqVMejrg.png"></figure><p name="ab6a" id="ab6a" class="graf graf--p graf-after--figure">The register file would be,</p><figure name="1d75" id="1d75" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*Sx7hM9X_6dee3KIxBl4UAA.png" data-width="1530" data-height="214" src="https://cdn-images-1.medium.com/max/800/1*Sx7hM9X_6dee3KIxBl4UAA.png"></figure><p name="9869" id="9869" class="graf graf--p graf-after--figure">And the RAT would be,</p><figure name="ce29" id="ce29" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*t1SNRcCD-K8OepEndmiABA.png" data-width="1530" data-height="454" src="https://cdn-images-1.medium.com/max/800/1*t1SNRcCD-K8OepEndmiABA.png"></figure><p name="1a99" id="1a99" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(11) Cycle 17</strong></p><p name="c813" id="c813" class="graf graf--p graf-after--p">In cycle 17, the instruction <code class="markup--code markup--p-code">ML1</code> will be finished and its result <code class="markup--code markup--p-code">-6.3</code> will be broadcasted. So the reservation station will be,</p><figure name="2fdc" id="2fdc" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*FJXRRMPEjHW1umEN_-KwwA.png" data-width="1530" data-height="588" src="https://cdn-images-1.medium.com/max/800/1*FJXRRMPEjHW1umEN_-KwwA.png"></figure><p name="4be6" id="4be6" class="graf graf--p graf-after--figure">The register file would be,</p><figure name="5d29" id="5d29" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*a93OyBsQkQDdcvp-RzMk_Q.png" data-width="1530" data-height="218" src="https://cdn-images-1.medium.com/max/800/1*a93OyBsQkQDdcvp-RzMk_Q.png"></figure><p name="85f1" id="85f1" class="graf graf--p graf-after--figure">And the RAT would be,</p><figure name="91fa" id="91fa" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*fy-K1Du2cVuTi906-Lt4UA.png" data-width="1530" data-height="448" src="https://cdn-images-1.medium.com/max/800/1*fy-K1Du2cVuTi906-Lt4UA.png"></figure><p name="9dd3" id="9dd3" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(12) Cycle 18</strong></p><p name="35bf" id="35bf" class="graf graf--p graf-after--p">In cycle 18, the <code class="markup--code markup--p-code">ML2</code> instruction will be dispatched and the execution will be finished in cycle 58 (18 + 40).</p><figure name="1ee2" id="1ee2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*o3XsR_q4nIlECMbJ8_g6FA.png" data-width="1530" data-height="588" src="https://cdn-images-1.medium.com/max/800/1*o3XsR_q4nIlECMbJ8_g6FA.png"></figure><p name="07de" id="07de" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">(13) Cycle 58</strong></p><p name="ed47" id="ed47" class="graf graf--p graf-after--p">In cycle 58, the result <code class="markup--code markup--p-code">-0.2</code> of the instruction <code class="markup--code markup--p-code">ML2</code> will be broadcasted. So, the reservation station will be empty. The register file would be,</p><figure name="fee2" id="fee2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ojmUvSRbHkCaeclTpzmPMA.png" data-width="1530" data-height="210" src="https://cdn-images-1.medium.com/max/800/1*ojmUvSRbHkCaeclTpzmPMA.png"></figure><p name="318c" id="318c" class="graf graf--p graf-after--figure">And RAT will also be empty.</p><p name="1577" id="1577" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">3. Timing Shortcut</strong></p><p name="94fb" id="94fb" class="graf graf--p graf-after--p">Sometimes we don’t want to write down the whole example because it can be quite complex. Commonly, we just want to get the time (number of cycles) that we are going to have for issuing, executing, or writing result for an instruction. Actually, we can have a shortcut to calculate the timing.</p><pre name="2818" id="2818" class="graf graf--pre graf-after--p">ISSUING       EXECUTION      WRITING-RESULT</pre><p name="80b9" id="80b9" class="graf graf--p graf-after--pre">The issue can be written in the first place because we can issue as much as possible until all the reservation stations we need (for our instruction type) are filled. We can simply enumerate all the instructions from 1 to the filled count.</p><pre name="8152" id="8152" class="graf graf--pre graf-after--p">ISSUING       EXECUTION      WRITING-RESULT<br>1<br>2<br>3<br>4<br>5<br>6<br>WAIT</pre><p name="51f0" id="51f0" class="graf graf--p graf-after--pre">Then let’s find out the data dependencies. For our previous program,</p><pre name="5d52" id="5d52" class="graf graf--pre graf-after--p">L.D F6, 34(R2)<br>L.D F2, 45(R3)<br>MUL.D F0, F2, F4<br>SUB.D F8, F2, F6<br>DIV.D F10, F0, F6<br>ADD.D F6, F8, F2</pre><p name="a585" id="a585" class="graf graf--p graf-after--pre">So we have, <code class="markup--code markup--p-code">I3</code> depends on <code class="markup--code markup--p-code">I2</code>; <code class="markup--code markup--p-code">I4</code> depends on <code class="markup--code markup--p-code">I1</code> and <code class="markup--code markup--p-code">I2</code>; <code class="markup--code markup--p-code">I5</code> depends on <code class="markup--code markup--p-code">I1</code> and <code class="markup--code markup--p-code">I3</code> ; <code class="markup--code markup--p-code">I6</code> depends on <code class="markup--code markup--p-code">I2</code> and <code class="markup--code markup--p-code">I4</code>.</p><p name="1882" id="1882" class="graf graf--p graf-after--p">Thus, we must run the code with the sequence of,</p><pre name="b92f" id="b92f" class="graf graf--pre graf-after--p">I2 -&gt; I3<br>I1 / I2 -&gt; I3 -&gt; I5<br>I1 / I2 -&gt; I4 -&gt; I6</pre><p name="33e1" id="33e1" class="graf graf--p graf-after--pre">Then we can find out that <code class="markup--code markup--p-code">I1</code> and <code class="markup--code markup--p-code">I2</code> should be executed first if we want to execute the other instructions. We have known that they are both <code class="markup--code markup--p-code">L.D</code> instructions and they will take 2 cycles for execution. So the difference between writing and execution is 2.</p><pre name="1024" id="1024" class="graf graf--pre graf-after--p">ISSUING       EXECUTION      WRITING-RESULT<br>1             2              4<br>2             4              6<br>3            <br>4            <br>5<br>6</pre><p name="7539" id="7539" class="graf graf--p graf-after--pre">After we finish <code class="markup--code markup--p-code">I1</code> and <code class="markup--code markup--p-code">I2</code>, we can now dispatch both <code class="markup--code markup--p-code">I3</code> and <code class="markup--code markup--p-code">I4</code> (because they require different ALUs) in the next cycle. <code class="markup--code markup--p-code">I3</code> needs 10 cycles to finish and I4 needs 2 cycles to finish. So,</p><pre name="48dc" id="48dc" class="graf graf--pre graf-after--p">ISSUING       EXECUTION      WRITING-RESULT<br>1             2               4<br>2             4               6<br>3             7              17<br>4             7               9<br>5<br>6</pre><p name="b764" id="b764" class="graf graf--p graf-after--pre">After <code class="markup--code markup--p-code">I4</code> is finished, <code class="markup--code markup--p-code">I6</code> can be dispatched in the next cycle (10) and it tasks 2 cycles to finish. So,</p><pre name="94ed" id="94ed" class="graf graf--pre graf-after--p">ISSUING       EXECUTION      WRITING-RESULT<br>1              2              4<br>2              4              6<br>3              7             17<br>4              7              9<br>5<br>6             10             12</pre><p name="d061" id="d061" class="graf graf--p graf-after--pre">After <code class="markup--code markup--p-code">I3</code> is finished, <code class="markup--code markup--p-code">I5</code> can be dispatched in the next cycle (18) and it tasks 40 cycles to finish. So,</p><pre name="a3d9" id="a3d9" class="graf graf--pre graf-after--p graf--trailing">ISSUING       EXECUTION      WRITING-RESULT<br>1              2              4<br>2              4              6<br>3              7             17<br>4              7              9<br>5             18             58<br>6             10             12</pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/96c38d0473e3"><time class="dt-published" datetime="2021-01-28T13:59:49.679Z">January 28, 2021</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/high-performance-computer-architecture-14-tomasulos-algorithm-part-2-96c38d0473e3" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>