<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>High-Performance Computer Architecture 11 | Experiment for Control Dependencies</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">High-Performance Computer Architecture 11 | Experiment for Control Dependencies</h1>
</header>
<section data-field="subtitle" class="p-summary">
Series: High-Performance Computer Architecture
</section>
<section data-field="body" class="e-content">
<section name="fc8c" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="0458" id="0458" class="graf graf--h3 graf--leading graf--title">High-Performance Computer Architecture 11 | Experiment for Control Dependencies</h3><figure name="3a26" id="3a26" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*QMh7E68rtbNOwneE.png" data-width="1446" data-height="864" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*QMh7E68rtbNOwneE.png"></figure><blockquote name="531b" id="531b" class="graf graf--blockquote graf-after--figure"><strong class="markup--strong markup--blockquote-strong">NOTE:</strong> The present article does <strong class="markup--strong markup--blockquote-strong">NOT</strong> include anything related to the final submission (<strong class="markup--strong markup--blockquote-strong">no answers, no specific values, no results</strong>) for the course <a href="https://omscs.gatech.edu/cs-6290-high-performance-computer-architecture" data-href="https://omscs.gatech.edu/cs-6290-high-performance-computer-architecture" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank">CS6290 HPCA</a> because of the honor code. Most of the contents in this article is repeating the basic instructions and the directions of the Project 0. More Linux commands are provided as complements to the project’s guidelines.</blockquote><blockquote name="198a" id="198a" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong">Please feel free to contact me if this article violates the rules of Georgia Tech and I will immediately delete this article with no doubt.</strong></blockquote><ol class="postList"><li name="7577" id="7577" class="graf graf--li graf-after--blockquote"><strong class="markup--strong markup--li-strong">A Possible Bug</strong></li></ol><p name="f2eb" id="f2eb" class="graf graf--p graf-after--li">Let’s log in to our virtual machine now. Note you may have the following error while logging in,</p><pre name="734f" id="734f" class="graf graf--pre graf-after--p">[ 3.330168] intel8x0:measure - unreliable DMA position..</pre><p name="4200" id="4200" class="graf graf--p graf-after--pre">This error is because of the shared folder, and if you meet this problem, you can reboot and redo the settings for the shared folder. You may need to try several times until you can work on your machine.</p><p name="f241" id="f241" class="graf graf--p graf-after--p">If you don’t meet this error, you are free to continue.</p><p name="92ed" id="92ed" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">2. Experiment 1: LU Decomposition for </strong><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">64</strong></code><strong class="markup--strong markup--p-strong">, </strong><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">128</strong></code><strong class="markup--strong markup--p-strong">, </strong><code class="markup--code markup--p-code"><strong class="markup--strong markup--p-strong">256</strong></code><strong class="markup--strong markup--p-strong"> -Dimension Matrix</strong></p><p name="0658" id="0658" class="graf graf--p graf-after--p">Before we start, we have to make sure that there will be no other <code class="markup--code markup--p-code">.rpt</code> files to avoid any conflicts or overwrites.</p><pre name="1c4e" id="1c4e" class="graf graf--pre graf-after--p">$ cd ~/sesc/apps/Splash2/lu<br>$ rm -rf *.rpt</pre><p name="e192" id="e192" class="graf graf--p graf-after--pre">Then we run the following code to generate the report for decompositions. Note that we have to check <code class="markup--code markup--p-code">lu.err</code> and <code class="markup--code markup--p-code">lu.out</code> to make sure that the simulated run has completed correctly.</p><pre name="ec4d" id="ec4d" class="graf graf--pre graf-after--p">$ ~/sesc/sesc.opt -fn64.rpt -c ~/sesc/confs/cmp4-noc.conf -olu.out     -elu.err lu.mipseb -n64 -p1<br>$ cat lu.err<br>$ cat lu.out</pre><pre name="6797" id="6797" class="graf graf--pre graf-after--pre">$ ~/sesc/sesc.opt -fn128.rpt -c ~/sesc/confs/cmp4-noc.conf -olu.out     -elu.err lu.mipseb -n128 -p1<br>$ cat lu.err<br>$ cat lu.out</pre><pre name="708d" id="708d" class="graf graf--pre graf-after--pre">$ ~/sesc/sesc.opt -fn256.rpt -c ~/sesc/confs/cmp4-noc.conf -olu.out     -elu.err lu.mipseb -n256 -p1<br>$ cat lu.err<br>$ cat lu.out</pre><p name="f743" id="f743" class="graf graf--p graf-after--pre">After that, we can check whether we have already generated these reports by,</p><pre name="0213" id="0213" class="graf graf--pre graf-after--p">$ ls *.rpt</pre><p name="b56f" id="b56f" class="graf graf--p graf-after--pre">The output should be,</p><pre name="4152" id="4152" class="graf graf--pre graf-after--p">sesc_lu.mipseb.n128.rpt  sesc_lu.mipseb.n256.rpt  sesc_lu.mipseb.n64.rpt</pre><p name="fa17" id="fa17" class="graf graf--p graf-after--pre">Now we can view these reports by,</p><pre name="79b4" id="79b4" class="graf graf--pre graf-after--p">$ clear<br>$ ~/sesc/scripts/report.pl sesc_lu.mipseb.n64.rpt<br>$ ~/sesc/scripts/report.pl sesc_lu.mipseb.n128.rpt<br>$ ~/sesc/scripts/report.pl sesc_lu.mipseb.n256.rpt</pre><p name="7c28" id="7c28" class="graf graf--p graf-after--pre">It is quite interesting to see the improvement for these three files.</p><p name="92b6" id="92b6" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">3. Experiment 2: Compiling and simulating a small application</strong></p><p name="9c92" id="9c92" class="graf graf--p graf-after--p">Let’s now go to the <code class="markup--code markup--p-code">~/sesc/tests/</code> directory and find the <code class="markup--code markup--p-code">hello.c</code> file here,</p><pre name="9d70" id="9d70" class="graf graf--pre graf-after--p">$ cd ~/sesc/tests/<br>$ ls</pre><p name="b520" id="b520" class="graf graf--p graf-after--pre">Use any editor (<code class="markup--code markup--p-code">gedit</code> is a good choice) to edit this file so that the string in this program would be (remember to replace the name with your own name),</p><pre name="b5d0" id="b5d0" class="graf graf--pre graf-after--p">&quot;Hi there! My name is <strong class="markup--strong markup--pre-strong"><em class="markup--em markup--pre-em">Adam Edelweiss</em></strong>\n&quot;</pre><p name="e972" id="e972" class="graf graf--p graf-after--pre">Use <code class="markup--code markup--p-code">cat</code> to check out the content,</p><pre name="f267" id="f267" class="graf graf--pre graf-after--p">$ cat hello.c</pre><p name="7074" id="7074" class="graf graf--p graf-after--pre">Now we should <code class="markup--code markup--p-code">gcc</code> try to compile and run our code natively,</p><pre name="cf36" id="cf36" class="graf graf--pre graf-after--p">$ gcc -o hello hello.c<br>$ ./hello</pre><p name="ec8a" id="ec8a" class="graf graf--p graf-after--pre">This should result in printing out the “Hi there! My name is ….” message and then a newline.</p><p name="f929" id="f929" class="graf graf--p graf-after--p">Because the simulator uses the <code class="markup--code markup--p-code">MIPS ISA</code>, we cannot use the native compiler. Instead, we use a <strong class="markup--strong markup--p-strong">cross-compiler</strong> — it is a compiler that runs on one machine (the native machine) but produces code for a different machine (the target machine, i.e. <code class="markup--code markup--p-code">MIPS</code>). Installing and setting up the cross-compiler is a time-consuming and tricky process, so we have already installed one and made it ready for you to use.</p><p name="fdb0" id="fdb0" class="graf graf--p graf-after--p">The cross-compiler can be found in <code class="markup--code markup--p-code">/mipsroot/cross-tools/bin</code> with a name <br><code class="markup--code markup--p-code">mips-unknown-linux-gnu-gcc</code>. We can check it by,</p><pre name="202e" id="202e" class="graf graf--pre graf-after--p">$ ls /mipsroot/cross-tools/bin | grep mips-unknown-linux-gnu-gcc</pre><p name="6253" id="6253" class="graf graf--p graf-after--pre">The output should be,</p><pre name="b293" id="b293" class="graf graf--pre graf-after--p">mips-unknown-linux-gnu-gcc<br>mips-unknown-linux-gnu-gcc-4.6.3</pre><p name="2b33" id="2b33" class="graf graf--p graf-after--pre">and the one we need is the <code class="markup--code markup--p-code">mips-unknown-linux-gnu-gcc</code> one.</p><p name="6afa" id="6afa" class="graf graf--p graf-after--p">Notice that there are many other cross-compilation tools for us. We can print the name of them by,</p><pre name="5a6c" id="5a6c" class="graf graf--pre graf-after--p">$ ls /mipsroot/cross-tools/bin | grep mips-unknown-linux-gnu-*</pre><p name="25e2" id="25e2" class="graf graf--p graf-after--pre">The output should be,</p><pre name="f26b" id="f26b" class="graf graf--pre graf-after--p">mips-unknown-linux-gnu-addr2line<br>mips-unknown-linux-gnu-ar<br>mips-unknown-linux-gnu-as<br>mips-unknown-linux-gnu-c++<br>mips-unknown-linux-gnu-c++filt<br>mips-unknown-linux-gnu-cpp<br>mips-unknown-linux-gnu-elfedit<br>mips-unknown-linux-gnu-g++<br>mips-unknown-linux-gnu-gcc<br>mips-unknown-linux-gnu-gcc-4.6.3<br>mips-unknown-linux-gnu-gcov<br>mips-unknown-linux-gnu-gfortran<br>mips-unknown-linux-gnu-gprof<br>mips-unknown-linux-gnu-ld<br>mips-unknown-linux-gnu-ld.bfd<br>mips-unknown-linux-gnu-nm<br>mips-unknown-linux-gnu-objcopy<br>mips-unknown-linux-gnu-objdump<br>mips-unknown-linux-gnu-ranlib<br>mips-unknown-linux-gnu-readelf<br>mips-unknown-linux-gnu-size<br>mips-unknown-linux-gnu-strings<br>mips-unknown-linux-gnu-strip</pre><p name="ee97" id="ee97" class="graf graf--p graf-after--pre">Now, let’s simulate our <code class="markup--code markup--p-code">hello.c</code> . Firstly, let’s compile our <code class="markup--code markup--p-code">hello.c</code> by <code class="markup--code markup--p-code">mips-unknown-linux-gnu-gcc</code>,</p><pre name="1138" id="1138" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-gcc -O0 -g -static -mabi=32 -fno-delayed-branch -fno-optimize-sibling-calls -msplit-addresses -march=mips4 -o hello.mipseb hello.c</pre><p name="58d5" id="58d5" class="graf graf--p graf-after--pre">After the compiler generates the MIPS executable file <code class="markup--code markup--p-code">hello.mipseb</code> for us. We can check this by,</p><pre name="8751" id="8751" class="graf graf--pre graf-after--p">$ ls *.mipseb</pre><p name="6612" id="6612" class="graf graf--p graf-after--pre">Now, let’s generate the report <code class="markup--code markup--p-code">.rpt</code> file for us and then read into this report by the <code class="markup--code markup--p-code">report.pl</code> file,</p><pre name="dcb5" id="dcb5" class="graf graf--pre graf-after--p">$ ~/sesc/sesc.opt -fhello0.rpt -c ~/sesc/confs/cmp4-noc.conf -ohello.out hello.mipseb<br>$ ~/sesc/scripts/report.pl sesc_hello.mipseb.hello0.rpt</pre><p name="77f2" id="77f2" class="graf graf--p graf-after--pre">To understand why we have so many instructions for this simple script, we can have a look at the result produced by the disassembler <code class="markup--code markup--p-code">mips-unknown-linux-gnu-objdump</code>.</p><pre name="ded4" id="ded4" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-objdump -d hello.mipseb | more</pre><p name="b53f" id="b53f" class="graf graf--p graf-after--pre">To find where we actually execute the <code class="markup--code markup--p-code">main</code> function, we can search for <code class="markup--code markup--p-code">&lt;main&gt;</code> in this result,</p><pre name="5ae8" id="5ae8" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-objdump -d hello.mipseb | grep &quot;&lt;main&gt;&quot;</pre><p name="c463" id="c463" class="graf graf--p graf-after--pre">Note that we can find many instructions executed before the <code class="markup--code markup--p-code">main</code> function. How come? Let’s run the following code to see the first ten lines. You may see something about the <code class="markup--code markup--p-code">_init</code> . To know more about this, we have to look up the documentation for the <code class="markup--code markup--p-code">__libc_start_main</code> function which is part of the <code class="markup--code markup--p-code">GNU standard C library (GLIBC)</code> from <a href="https://refspecs.linuxbase.org/LSB_3.1.0/LSB-generic/LSB-generic/baselib---libc-start-main-.html" data-href="https://refspecs.linuxbase.org/LSB_3.1.0/LSB-generic/LSB-generic/baselib---libc-start-main-.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>,</p><pre name="4d76" id="4d76" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-objdump -d hello.mipseb | head -10</pre><p name="357c" id="357c" class="graf graf--p graf-after--pre">The tool <code class="markup--code markup--p-code">mips-unknown-linux-gnu-strip</code> will discard symbols from object files to reduce its code size without breaking it.</p><pre name="1031" id="1031" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-strip hello.mipseb</pre><p name="24af" id="24af" class="graf graf--p graf-after--pre">Now, let’s add an exclamation mark <code class="markup--code markup--p-code">!</code> to the string that is printed,</p><pre name="96e3" id="96e3" class="graf graf--pre graf-after--p">&quot;Hi there! My name is <strong class="markup--strong markup--pre-strong"><em class="markup--em markup--pre-em">Adam Edelweiss</em></strong>!\n&quot;</pre><p name="0f89" id="0f89" class="graf graf--p graf-after--pre">Then we redo the <code class="markup--code markup--p-code">MIPS ISA</code> compiling by <code class="markup--code markup--p-code">mips-unknown-linux-gnu-gcc</code>,</p><pre name="2fa6" id="2fa6" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-gcc -O0 -g -static -mabi=32 -fno-delayed-branch -fno-optimize-sibling-calls -msplit-addresses -march=mips4 -o hello.mipseb hello.c</pre><p name="a345" id="a345" class="graf graf--p graf-after--pre">Then we use the simulator to generate a new report named <code class="markup--code markup--p-code">sesc_hello.mipseb.hello1.rpt</code> and then read its content,</p><pre name="2f7b" id="2f7b" class="graf graf--pre graf-after--p">$ ~/sesc/sesc.opt -fhello1.rpt -c ~/sesc/confs/cmp4-noc.conf -ohello.out hello.mipseb<br>$ ~/sesc/scripts/report.pl sesc_hello.mipseb.hello1.rpt</pre><p name="64fa" id="64fa" class="graf graf--p graf-after--pre">Look at the result of this report, we can find the number of executed instructions for this program. What do you find and how can you explain that? If we continue adding more exclamation marks <code class="markup--code markup--p-code">!</code> , and redo the report for <code class="markup--code markup--p-code">hello2.rpt</code> , <code class="markup--code markup--p-code">hello3.rpt</code> , <code class="markup--code markup--p-code">hello4.rpt</code>…</p><pre name="eb45" id="eb45" class="graf graf--pre graf-after--p">&quot;Hi there! My name is <strong class="markup--strong markup--pre-strong"><em class="markup--em markup--pre-em">Adam Edelweiss</em></strong>!!\n&quot;<br>&quot;Hi there! My name is <strong class="markup--strong markup--pre-strong"><em class="markup--em markup--pre-em">Adam Edelweiss</em></strong>!!!\n&quot;<br>&quot;Hi there! My name is <strong class="markup--strong markup--pre-strong"><em class="markup--em markup--pre-em">Adam Edelweiss</em></strong>!!!!\n&quot;</pre><p name="f6d0" id="f6d0" class="graf graf--p graf-after--pre">Then,</p><pre name="5b03" id="5b03" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-gcc -O0 -g -static -mabi=32 -fno-delayed-branch -fno-optimize-sibling-calls -msplit-addresses -march=mips4 -o hello.mipseb hello.c<br>$ ~/sesc/sesc.opt -fhello2.rpt -c ~/sesc/confs/cmp4-noc.conf -ohello.out hello.mipseb<br>$ ~/sesc/scripts/report.pl sesc_hello.mipseb.hello2.rpt</pre><pre name="6f87" id="6f87" class="graf graf--pre graf-after--pre">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-gcc -O0 -g -static -mabi=32 -fno-delayed-branch -fno-optimize-sibling-calls -msplit-addresses -march=mips4 -o hello.mipseb hello.c<br>$ ~/sesc/sesc.opt -fhello3.rpt -c ~/sesc/confs/cmp4-noc.conf -ohello.out hello.mipseb<br>$ ~/sesc/scripts/report.pl sesc_hello.mipseb.hello3.rpt</pre><pre name="e4b3" id="e4b3" class="graf graf--pre graf-after--pre">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-gcc -O0 -g -static -mabi=32 -fno-delayed-branch -fno-optimize-sibling-calls -msplit-addresses -march=mips4 -o hello.mipseb hello.c<br>$ ~/sesc/sesc.opt -fhello4.rpt -c ~/sesc/confs/cmp4-noc.conf -ohello.out hello.mipseb<br>$ ~/sesc/scripts/report.pl sesc_hello.mipseb.hello4.rpt</pre><pre name="2338" id="2338" class="graf graf--pre graf-after--pre">...</pre><p name="37ce" id="37ce" class="graf graf--p graf-after--pre">What else can you find and how can you explain this?</p><p name="ea72" id="ea72" class="graf graf--p graf-after--p">Note that we can also use <code class="markup--code markup--p-code">objdump</code> to see what <code class="markup--code markup--p-code">main</code> is doing (it is actually not calling <code class="markup--code markup--p-code">printf</code>),</p><pre name="be1c" id="be1c" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-objdump -d hello.mipseb &gt; desc.txt</pre><p name="e5f4" id="e5f4" class="graf graf--p graf-after--pre">Here is a hint, in order to show the functions we call in <code class="markup--code markup--p-code">&lt;main&gt;</code> , we can run</p><pre name="e0c5" id="e0c5" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-objdump -d hello.mipseb | grep -A 5000 &quot;&lt;main&gt;&quot; | grep -e &quot;&lt;.*&gt;:&quot;</pre><p name="7180" id="7180" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">4. Final Delivery</strong></p><p name="2ab0" id="2ab0" class="graf graf--p graf-after--p">Check the existence of the following files before submission,</p><pre name="5802" id="5802" class="graf graf--pre graf-after--p graf--trailing">PRJ0.docx<br>sesc_lu.mipseb.n64.rpt<br>sesc_lu.mipseb.n128.rpt<br>sesc_lu.mipseb.n256.rpt<br>hello.c // with exclamation marks for fewer instructions<br>sesc_hello.mipseb.hello0.rpt<br>sesc_hello.mipseb.hello?.rpt // last simulation, ? must be replaced</pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/a98f393674c"><time class="dt-published" datetime="2021-01-22T11:08:23.228Z">January 22, 2021</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/high-performance-computer-architecture-11-experiment-for-control-dependencies-a98f393674c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>