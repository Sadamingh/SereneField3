<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>High-Performance Computer Architecture 17 | Experiment for Branch Prediction</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">High-Performance Computer Architecture 17 | Experiment for Branch Prediction</h1>
</header>
<section data-field="subtitle" class="p-summary">
Series: High-Performance Computer Architecture
</section>
<section data-field="body" class="e-content">
<section name="28b5" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f93a" id="f93a" class="graf graf--h3 graf--leading graf--title">High-Performance Computer Architecture 17 | Experiment for Branch Prediction</h3><figure name="4199" id="4199" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*42asgYYYWUAzQMxe.png" data-width="1446" data-height="864" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*42asgYYYWUAzQMxe.png"></figure><blockquote name="9b71" id="9b71" class="graf graf--blockquote graf-after--figure"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">NOTE:</em></strong><em class="markup--em markup--blockquote-em"> The present article does </em><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">NOT</em></strong><em class="markup--em markup--blockquote-em"> include anything related to the final submission (</em><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">no answers, no specific values, no results</em></strong><em class="markup--em markup--blockquote-em">) for the course </em><a href="https://omscs.gatech.edu/cs-6290-high-performance-computer-architecture" data-href="https://omscs.gatech.edu/cs-6290-high-performance-computer-architecture" class="markup--anchor markup--blockquote-anchor" rel="noopener nofollow noopener" target="_blank"><em class="markup--em markup--blockquote-em">CS6290 HPCA</em></a><em class="markup--em markup--blockquote-em"> because of the honor code. Most of the contents in this article is repeating the basic instructions and the directions of the Project 1. More Linux commands are provided as complements to the project’s guidelines.</em></blockquote><blockquote name="bd67" id="bd67" class="graf graf--blockquote graf-after--blockquote"><strong class="markup--strong markup--blockquote-strong"><em class="markup--em markup--blockquote-em">Please feel free to contact me if this article violates the rules of Georgia Tech and I will immediately delete this article with no doubt.</em></strong></blockquote><ol class="postList"><li name="41d8" id="41d8" class="graf graf--li graf-after--blockquote"><strong class="markup--strong markup--li-strong">Review</strong></li></ol><p name="3f6f" id="3f6f" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">(1) Recall Simulation</strong></p><p name="0e98" id="0e98" class="graf graf--p graf-after--p">It has been a long time since we have done the experiment last time, so we may assume that you have forgotten some of the essential things that should be carried from the last experiment. Let’s see a refresher now.</p><ul class="postList"><li name="90dd" id="90dd" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">sesc.opt</code> is an executable file for us to generate a simulation report. This file can be found from,</li></ul><pre name="795b" id="795b" class="graf graf--pre graf-after--li">~/sesc/sesc.opt</pre><ul class="postList"><li name="fba9" id="fba9" class="graf graf--li graf-after--pre"><code class="markup--code markup--li-code">cmp4-noc.conf</code> is a readable file for the simulation configurations. This file can be found from,</li></ul><pre name="b48b" id="b48b" class="graf graf--pre graf-after--li">~/sesc/confs/cmp4-noc.conf</pre><ul class="postList"><li name="b4ed" id="b4ed" class="graf graf--li graf-after--pre"><code class="markup--code markup--li-code">report.pl</code> is an executable for us to view the report. This file can be found from,</li></ul><pre name="6c46" id="6c46" class="graf graf--pre graf-after--li">~/sesc/scripts/report.pl</pre><p name="fdf7" id="fdf7" class="graf graf--p graf-after--pre">In order to simulate a script (i.e. <code class="markup--code markup--p-code">xxx.mipseb</code>), we can use,</p><pre name="9b31" id="9b31" class="graf graf--pre graf-after--p">$ ~/sesc/sesc.opt -fxxx0.rpt -c ~/sesc/confs/cmp4-noc.conf -oxxx.out -exxx.err xxx.mipseb</pre><p name="c222" id="c222" class="graf graf--p graf-after--pre">where,</p><ul class="postList"><li name="426b" id="426b" class="graf graf--li graf-after--p">The <code class="markup--code markup--li-code">-f</code> option is used to specify the suffix for the file name</li><li name="9088" id="9088" class="graf graf--li graf-after--li">The <code class="markup--code markup--li-code">-c</code> option is used to specify the configuration file</li><li name="c913" id="c913" class="graf graf--li graf-after--li">The <code class="markup--code markup--li-code">-o</code> option is used to print the standard output to a file</li><li name="2e3b" id="2e3b" class="graf graf--li graf-after--li">The <code class="markup--code markup--li-code">-e</code> option is used to print the standard error to a file</li></ul><p name="88ea" id="88ea" class="graf graf--p graf-after--li">When we want to read the simulation report, we can use,</p><pre name="e989" id="e989" class="graf graf--pre graf-after--p">$ ~/sesc/scripts/report.pl xxx.mipseb.xxx0.rpt</pre><p name="57ec" id="57ec" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">(2) Recall Compilation</strong></p><p name="c90f" id="c90f" class="graf graf--p graf-after--p">Suppose we are given a C script <code class="markup--code markup--p-code">foo.c</code> , how can we compile this script into a MIPS-executable file? You should consider the following files,</p><ul class="postList"><li name="34c2" id="34c2" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">mips-unknown-linux-gnu-gcc</code> can be used to compile the <code class="markup--code markup--li-code">foo.c</code> script file. This file is located at,</li></ul><pre name="52a0" id="52a0" class="graf graf--pre graf-after--li">/mipsroot/cross-tools/bin/mips-unknown-linux-gnu-gcc</pre><p name="1a3e" id="1a3e" class="graf graf--p graf-after--pre">And it can be used by,</p><pre name="77e6" id="77e6" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-gcc -O0 -g -static -mabi=32 -fno-delayed-branch -fno-optimize-sibling-calls -msplit-addresses -march=mips4 -o foo.mipseb foo.c</pre><ul class="postList"><li name="2462" id="2462" class="graf graf--li graf-after--pre"><code class="markup--code markup--li-code">mips-unknown-linux-gnu-objdump</code> can be used to view the assembly code of the current MIPS file for a C program <code class="markup--code markup--li-code">foo.c</code>. This file is located at,</li></ul><pre name="32b2" id="32b2" class="graf graf--pre graf-after--li">/mipsroot/cross-tools/bin/mips-unknown-linux-gnu-objdump</pre><p name="8f9a" id="8f9a" class="graf graf--p graf-after--pre">And it can be used by,</p><pre name="ec43" id="ec43" class="graf graf--pre graf-after--p">$ /mipsroot/cross-tools/bin/mips-unknown-linux-gnu-objdump -d foo.mipseb</pre><p name="5219" id="5219" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">2. Configuration File</strong></p><p name="d81a" id="d81a" class="graf graf--p graf-after--p">Now, let’s look into the configuration file. We should use the following command to view this file,</p><pre name="9572" id="9572" class="graf graf--pre graf-after--p">$ cd ~/sesc/confs<br>$ cat cmp4-noc.conf | more</pre><p name="fff1" id="fff1" class="graf graf--p graf-after--pre">The output would be,</p><pre name="5036" id="5036" class="graf graf--pre graf-after--p"># By Ching-Kai Liang</pre><pre name="2ad3" id="2ad3" class="graf graf--pre graf-after--pre">procsPerNode  = 4<br>cacheLineSize = 64<br>NOCdim = 2 # Assume a $(NOCdim) x $(NOCdim) NOC architecture</pre><pre name="1c9f" id="1c9f" class="graf graf--pre graf-after--pre">issue         = 2 <br>cpucore[0:$(procsPerNode)-1] = &#39;issueX&#39;<br>...</pre><p name="45ea" id="45ea" class="graf graf--p graf-after--pre">From this content, we can find out that the <code class="markup--code markup--p-code">procsPerNode</code> is specified to <code class="markup--code markup--p-code">4</code> and these processors (cores) are specified to number <code class="markup--code markup--p-code">0</code> through <code class="markup--code markup--p-code">3</code> by,</p><pre name="4bcf" id="4bcf" class="graf graf--pre graf-after--p">cpucore[0:$(procsPerNode)-1] = &#39;issueX&#39;</pre><p name="243c" id="243c" class="graf graf--p graf-after--pre">The parameter <code class="markup--code markup--p-code">issue</code> is specified to <code class="markup--code markup--p-code">2</code> and this means that the processor can fetch or issue up to 2 instructions per cycle,</p><pre name="feee" id="feee" class="graf graf--pre graf-after--p">issue         = 2</pre><p name="df9c" id="df9c" class="graf graf--p graf-after--pre">In addition, each of the processors is described in section <code class="markup--code markup--p-code">issueX</code>. We can then click on the enter key to move down a little bit until we see the <code class="markup--code markup--p-code">[issueX]</code> section, where we can see a lot of parameters defined for this core. From these parameters, we can find out that,</p><ul class="postList"><li name="2be9" id="2be9" class="graf graf--li graf-after--p">The clock <strong class="markup--strong markup--li-strong">frequency is 1GHz</strong> because,</li></ul><pre name="6380" id="6380" class="graf graf--pre graf-after--li">frequency       = 1e9</pre><ul class="postList"><li name="502d" id="502d" class="graf graf--li graf-after--pre">The processor has an <strong class="markup--strong markup--li-strong">out-of-order execution</strong> feature because,</li></ul><pre name="7c5c" id="7c5c" class="graf graf--pre graf-after--li">inorder         = false</pre><p name="426f" id="426f" class="graf graf--p graf-after--pre">Moreover, there are also many other sections that define various things, such as,</p><ul class="postList"><li name="e624" id="e624" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">[BPredIssueX]</code> describes the branch predictor for the current processor</li><li name="4fe6" id="4fe6" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">[IMemory]</code> describes the fetch instructions from a structure called <code class="markup--code markup--li-code">IL1</code> (which is specified by the <code class="markup--code markup--li-code">instrSource</code> parameter)</li><li name="64cc" id="64cc" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">[DMemory]</code> describes reads/writes data from a structure called <code class="markup--code markup--li-code">DL1</code></li></ul><p name="95d5" id="95d5" class="graf graf--p graf-after--li">In these experiments, we will be modifying the <code class="markup--code markup--p-code">BPRedIssueX</code> section, so let’s take a closer look at it. The <code class="markup--code markup--p-code">type</code> parameter of this branch predictor is <code class="markup--code markup--p-code">hybird</code> because</p><pre name="029f" id="029f" class="graf graf--pre graf-after--p">type          = &quot;hybrid&quot;</pre><p name="948c" id="948c" class="graf graf--p graf-after--pre">However, this doesn’t tell us much because we still don’t know what kind of predictor we have specified for this processor. Recall the different predictors we have talked about in the previous sections,</p><ul class="postList"><li name="ad85" id="ad85" class="graf graf--li graf-after--p">Not-Taken Predictor: simplest, always predict not taken</li><li name="f87e" id="f87e" class="graf graf--li graf-after--li">BTB: Branch Target Buffer, to show where to branch</li><li name="ea70" id="ea70" class="graf graf--li graf-after--li">1BP(BC) BHT: 1-Bit Branch History Table, to show whether a branch should branch or not with 1-bit history, not work for the duplicated pattern</li><li name="b224" id="b224" class="graf graf--li graf-after--li">2BP BHT: 2-Bit Branch History Table, to show whether a branch should branch or not 2-bit history, not work for the duplicated pattern</li><li name="f3fd" id="f3fd" class="graf graf--li graf-after--li">1H 2BP BHT: 1-Bit History With 2-Bit Count Predictor Table, to show whether a branch should branch or not, work for the 2-bit duplicated pattern</li><li name="74a1" id="74a1" class="graf graf--li graf-after--li">2H 2BP BHT: 2-Bit History With 2-Bit Count Predictor Table, to show whether a branch should branch or not, work for the 3-bit duplicated pattern</li><li name="faee" id="faee" class="graf graf--li graf-after--li">NH 2BP BHT: N-Bit History With 2-Bit Count Predictor Table, to show whether a branch should branch or not, work for the (N+1)-bit duplicated pattern</li><li name="8662" id="8662" class="graf graf--li graf-after--li">RAS: the predictor for function return address</li></ul><p name="3c55" id="3c55" class="graf graf--p graf-after--li">Note that we can also split the history bits in the BHT table. If we split a pattern history table (PHT) for each entry in the BHT, it is called a <strong class="markup--strong markup--p-strong">PShare</strong>. However, if the PHT is split as a global table for all the entries in BHT, then it is called a <strong class="markup--strong markup--p-strong">GShare</strong>. In order to choose between different predictors, we have to use,</p><ul class="postList"><li name="4692" id="4692" class="graf graf--li graf-after--p">Tournament Predictor: used to choose between two good predictors (i.e. PShare and GShare)</li><li name="5a32" id="5a32" class="graf graf--li graf-after--li">Hierarchical Predictor: used to choose between a good predictor and an Okay predictor (i.e. the result of PShare and 2BC)</li></ul><p name="2ecf" id="2ecf" class="graf graf--p graf-after--li">Well, in our experiment, the type of <code class="markup--code markup--p-code">hybrid</code> actually means a tournament predictor. We can check the source code for more details about this code. The source code should be located in <code class="markup--code markup--p-code">~/sesc/src/libcore/</code> and we can view these source files by,</p><pre name="53c1" id="53c1" class="graf graf--pre graf-after--p">$ ~/sesc/src/libcore/BPred.h<br>$ ~/sesc/src/libcore/BPRed.cpp</pre><p name="23b0" id="23b0" class="graf graf--p graf-after--pre">The output could be viewed <a href="https://gist.github.com/Sadamingh/938ef8ce9c9cde563b1bbc0ef712a970" data-href="https://gist.github.com/Sadamingh/938ef8ce9c9cde563b1bbc0ef712a970" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><p name="8262" id="8262" class="graf graf--p graf-after--p">From the source code, we can discover that from the line 1191 to 1192, the <code class="markup--code markup--p-code">Hybrid</code> type will be mapped to a class <code class="markup--code markup--p-code">BPHybrid</code> and the <code class="markup--code markup--p-code">BPHybrid::BPHybrid</code> function defines the <code class="markup--code markup--p-code">globalTable</code>, the <code class="markup--code markup--p-code">localTable</code>, and the <code class="markup--code markup--p-code">metaTable</code>.</p><p name="1201" id="1201" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">3. Experiment 1: Comparing Different Predictors</strong></p><p name="323f" id="323f" class="graf graf--p graf-after--p">Now we will compare some branch predictors. The <code class="markup--code markup--p-code">LU</code> benchmark we used in <a href="https://medium.com/adamedelwiess/high-performance-computer-architecture-11-experiment-for-control-dependencies-a98f393674c" data-href="https://medium.com/adamedelwiess/high-performance-computer-architecture-11-experiment-for-control-dependencies-a98f393674c" class="markup--anchor markup--p-anchor" target="_blank">the last experiment</a> does not really stress the branch predictor, so we will use the <code class="markup--code markup--p-code">raytrace</code> benchmark instead. In order to use this branch mark, we have to compile it by,</p><pre name="fa67" id="fa67" class="graf graf--pre graf-after--p">$ cd ~/sesc/apps/Splash2/raytrace<br>$ make</pre><p name="fd43" id="fd43" class="graf graf--p graf-after--pre">Now, let’s do some simulations. In this case, we are going to simulate the predictors with the type <code class="markup--code markup--p-code">Hybrid</code> (as we have talked above), <code class="markup--code markup--p-code">Oracle</code> (with a perfect direction predictor and a BTB target address predictor), and <code class="markup--code markup--p-code">NotTaken</code> (a simple not-taken predictor). You have to modify the <code class="markup--code markup--p-code">type</code> parameter in the <code class="markup--code markup--p-code">cmp4-noc.conf</code> file before the simulation.</p><p name="437c" id="437c" class="graf graf--p graf-after--p">In order to do so, we can make three copies of the file <code class="markup--code markup--p-code">cmp4-noc.conf</code> with names of <code class="markup--code markup--p-code">cmp4-noc-HyA.conf</code> , <code class="markup--code markup--p-code">cmp4-noc-OrA.conf</code> , and <code class="markup--code markup--p-code">cmp4-noc-NtA.conf</code>. In our case, we are going to create these files in the shared folder and then copy these files to the <code class="markup--code markup--p-code">~/sesc/confs</code> directory,</p><pre name="c970" id="c970" class="graf graf--pre graf-after--p">$ cd <code class="markup--code markup--pre-code">~/sesc/confs<br></code>$ cp /media/sf_CS6290/PRJ\ 1/Confs/cmp4-noc-* ./</pre><p name="cede" id="cede" class="graf graf--p graf-after--pre">We can check these files by,</p><pre name="e0cf" id="e0cf" class="graf graf--pre graf-after--p">$ ls | grep &quot;cmp4-noc&quot;</pre><p name="e7f6" id="e7f6" class="graf graf--p graf-after--pre">The output should be,</p><pre name="bfc5" id="bfc5" class="graf graf--pre graf-after--p">cmp4-noc.conf<br>cmp4-noc-HyA.conf<br>cmp4-noc-NtA.conf<br>cmp4-noc-OrA.conf</pre><p name="b155" id="b155" class="graf graf--p graf-after--pre">Then we go to the <code class="markup--code markup--p-code">~/sesc/apps/Splash2/raytrace</code> directory and generate the report with these configuration files,</p><pre name="434a" id="434a" class="graf graf--pre graf-after--p">$ cd ~/sesc/apps/Splash2/raytrace<br>$ ~/sesc/sesc.opt -fHyA -c ~/sesc/confs/cmp4-noc-HyA.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env<br>$ ~/sesc/sesc.opt -f OrA -c ~/sesc/confs/cmp4-noc-OrA.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env<br>$ ~/sesc/sesc.opt -f NTA -c ~/sesc/confs/cmp4-noc-NtA.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env</pre><p name="94cc" id="94cc" class="graf graf--p graf-after--pre">When you run these commands, you can immediately see,</p><pre name="ab6e" id="ab6e" class="graf graf--pre graf-after--p">[0]   Thread 0 (0) Create<br>Begin skipping: requested 0 instructions</pre><pre name="aafd" id="aafd" class="graf graf--pre graf-after--pre">End skipping: requested 0 skipped 0<br>...</pre><p name="b733" id="b733" class="graf graf--p graf-after--pre">You can not rush to finish these commands because they are quite slow for our virtual machine and they are likely to take 10–15 minutes for each of them before completion. Also, you can not run these commands in different terminals simultaneously because the previous process can be killed because of that. So just take the time to drink a cup of coffee or do something else until you see something like,</p><pre name="9496" id="9496" class="graf graf--pre graf-after--p">...<br>MultipleDestInvalidation : 0<br>TotDestInvalidation : 0</pre><p name="df13" id="df13" class="graf graf--p graf-after--pre">for each of them. Then we can continue our experiment. After the simulations, we can use the following command to check the reports,</p><pre name="2630" id="2630" class="graf graf--pre graf-after--p">$ ls | grep sesc_raytrace.mipseb</pre><p name="364f" id="364f" class="graf graf--p graf-after--pre">The output should be,</p><pre name="ec07" id="ec07" class="graf graf--pre graf-after--p">sesc_raytrace.mipseb.HyA<br>sesc_raytrace.mipseb.NTA<br>sesc_raytrace.mipseb.OrA</pre><p name="507f" id="507f" class="graf graf--p graf-after--pre">Then we can view these reports by,</p><pre name="c019" id="c019" class="graf graf--pre graf-after--p">$ ~/sesc/scripts/report.pl sesc_raytrace.mipseb.NTA<br>$ ~/sesc/scripts/report.pl sesc_raytrace.mipseb.HyA<br>$ ~/sesc/scripts/report.pl sesc_raytrace.mipseb.OrA</pre><p name="32ba" id="32ba" class="graf graf--p graf-after--pre">Then you can compare the simulation time, the cycles, and the branch prediction accuracy of these three predictors.</p><p name="3a4a" id="3a4a" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">4. Experiment 2: Comparing Different Predictors</strong></p><p name="b572" id="b572" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Typo 1</strong>: (Part 2 Section D) Note that the instructions say “when the pipeline is 6 stages deeper”, but they should say “when the pipeline is 7 stages deeper” to be consistent with how renameDelay has been modified.</p><p name="b3bb" id="b3bb" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Typo 2</strong>: (Part 2 Section E) Section E says “The results in Part E) lead us to conclude that better branch prediction”, but it should say “The results in Part D) lead us to conclude that better branch prediction”.</p><p name="87de" id="87de" class="graf graf--p graf-after--p">Now, let’s make the pipeline deeper. The <code class="markup--code markup--p-code">renameDelay</code> parameter in the configuration file <code class="markup--code markup--p-code">~/sesc/confs/cmp4-noc.conf</code> in the <code class="markup--code markup--p-code">[issueX]</code> section is set to value <code class="markup--code markup--p-code">1</code> by,</p><pre name="677b" id="677b" class="graf graf--pre graf-after--p">renameDelay     = 1</pre><p name="3416" id="3416" class="graf graf--p graf-after--pre">In this experiment, we would like to change this value to 8 to make the pipeline 7 stages longer/deeper for our processor. We would like to modify this parameter among all of the three configuration files <code class="markup--code markup--p-code">cmp4-noc-HyA.conf</code> , <code class="markup--code markup--p-code">cmp4-noc-OrA.conf</code> , and <code class="markup--code markup--p-code">cmp4-noc-NtA.conf</code> , and then generate three new configuration files <code class="markup--code markup--p-code">cmp4-noc-HyC.conf</code> , <code class="markup--code markup--p-code">cmp4-noc-OrC.conf</code> , and <code class="markup--code markup--p-code">cmp4-noc-NtC.conf</code> .</p><p name="7fb2" id="7fb2" class="graf graf--p graf-after--p">We should then copy these files to the <code class="markup--code markup--p-code">~/sesc/confs</code> directory,</p><pre name="ea07" id="ea07" class="graf graf--pre graf-after--p">$ cd <code class="markup--code markup--pre-code">~/sesc/confs<br></code>$ cp /media/sf_CS6290/PRJ\ 1/Confs/cmp4-noc-* ./</pre><p name="1a55" id="1a55" class="graf graf--p graf-after--pre">We can check these files again by,</p><pre name="713c" id="713c" class="graf graf--pre graf-after--p">$ ls | grep &quot;cmp4-noc&quot;</pre><p name="243e" id="243e" class="graf graf--p graf-after--pre">Then the output should be,</p><pre name="4098" id="4098" class="graf graf--pre graf-after--p">cmp4-noc.conf<br>cmp4-noc-HyA.conf<br>cmp4-noc-HyC.conf<br>cmp4-noc-NtA.conf<br>cmp4-noc-NtC.conf<br>cmp4-noc-OrA.conf<br>cmp4-noc-OrC.conf</pre><p name="1dca" id="1dca" class="graf graf--p graf-after--pre">Again, let’s simulate under the condition of these new configurations by,</p><pre name="a009" id="a009" class="graf graf--pre graf-after--p">$ cd ~/sesc/apps/Splash2/raytrace<br>$ ~/sesc/sesc.opt -fHyC -c ~/sesc/confs/cmp4-noc-HyC.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env<br>$ ~/sesc/sesc.opt -f OrC -c ~/sesc/confs/cmp4-noc-OrC.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env<br>$ ~/sesc/sesc.opt -f NTC -c ~/sesc/confs/cmp4-noc-NtC.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env</pre><p name="4c93" id="4c93" class="graf graf--p graf-after--pre">Then we can view these reports by,</p><pre name="1046" id="1046" class="graf graf--pre graf-after--p">$ ~/sesc/scripts/report.pl sesc_raytrace.mipseb.NTC<br>$ ~/sesc/scripts/report.pl sesc_raytrace.mipseb.HyC<br>$ ~/sesc/scripts/report.pl sesc_raytrace.mipseb.OrC</pre><p name="5b81" id="5b81" class="graf graf--p graf-after--pre">From these reports, we can draw a conclusion about the pipeline depth and the importance of prediction accuracy. Theoretically, we have discussed that we have to abort more instructions when we have a deeper pipeline, so the misprediction penalty for a deeper pipeline can be higher. Thus, a predictor with a better prediction accuracy should be more important for a deeper pipeline. You can check this theory based on the result of the reports above.</p><p name="b20e" id="b20e" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">5. Experiment 3: Find out which branch tends to be mispredicted</strong></p><p name="ea26" id="ea26" class="graf graf--p graf-after--p">In this part, we are going to use the original configuration file <code class="markup--code markup--p-code">cmp4-noc.conf</code> and our goal in this experiment is to determine: for each instruction in the program, how many times the direction predictor correctly predicts? And how many times it mispredicts that branch?</p><p name="f59c" id="f59c" class="graf graf--p graf-after--p">In this case, we have to modify the code <code class="markup--code markup--p-code">BPred.h</code> and <code class="markup--code markup--p-code">BPred.cpp</code> . And we would like to print the following information,</p><ul class="postList"><li name="8f44" id="8f44" class="graf graf--li graf-after--p">the # of static branch instructions that are completed 1~19 times</li><li name="04c2" id="04c2" class="graf graf--li graf-after--li">the # of static branch instructions that are completed 20~199 times</li><li name="55be" id="55be" class="graf graf--li graf-after--li">the # of static branch instructions that are completed 200~1999 times</li><li name="f26d" id="f26d" class="graf graf--li graf-after--li">the # of static branch instructions that are completed 2000+ times</li></ul><p name="e8b9" id="e8b9" class="graf graf--p graf-after--li">Because you may want to figure out something like the <code class="markup--code markup--p-code">GStatsCntr</code> class, so the <a href="https://github.com/dilawar/sesc" data-href="https://github.com/dilawar/sesc" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">library</a> of SESC can be helpful.</p><p name="b605" id="b605" class="graf graf--p graf-after--p">After configuration, we have to copy the modified files to the <code class="markup--code markup--p-code">sesc</code> directory,</p><pre name="61ec" id="61ec" class="graf graf--pre graf-after--p">$ cd /media/sf_CS6290/sesc/src/libcore<br>$ cp BPred.* ~/sesc/src/libcore</pre><p name="d4ac" id="d4ac" class="graf graf--p graf-after--pre">Then we have to rebuild the <code class="markup--code markup--p-code">sesc</code> simulator by,</p><pre name="f7f4" id="f7f4" class="graf graf--pre graf-after--p">$ cd ~/sesc<br>$ make</pre><p name="c2c3" id="c2c3" class="graf graf--p graf-after--pre">Finally, we should put the output in the file <code class="markup--code markup--p-code">rt.out.Hybrid</code> and <code class="markup--code markup--p-code">rt.out.NT</code>,</p><pre name="4591" id="4591" class="graf graf--pre graf-after--p graf--trailing">$ ~/sesc/sesc.opt -f HyG -c ~/sesc/confs/cmp4-noc-HyA.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env &gt; rt.out.Hybrid<br>$ ~/sesc/sesc.opt -f NTG -c ~/sesc/confs/cmp4-noc-NTA.conf -ort.out -ert.err raytrace.mipseb -p1 -m128 -a2 Input/reduced.env &gt; rt.out.NT</pre></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/a375fb718536"><time class="dt-published" datetime="2021-02-17T15:23:15.361Z">February 17, 2021</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/high-performance-computer-architecture-16-experiment-for-branch-prediction-a375fb718536" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>