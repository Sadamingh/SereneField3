<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Computer Systems Experiments 7 | Button Controlled Blinking LED and Pull-up Resistor</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Computer Systems Experiments 7 | Button Controlled Blinking LED and Pull-up Resistor</h1>
</header>
<section data-field="subtitle" class="p-summary">
series: Computer Systems Experiments
</section>
<section data-field="body" class="e-content">
<section name="53c0" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="e8b6" id="e8b6" class="graf graf--h3 graf--leading graf--title">Computer Systems Experiments 7 | Button Controlled Blinking LED and Pull-up Resistor</h3><figure name="7fce" id="7fce" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="0*emBCxyp-3aXLJi34.png" data-width="1530" data-height="1104" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*emBCxyp-3aXLJi34.png"></figure><p name="a0ff" id="a0ff" class="graf graf--p graf-after--figure">This task can be easy to some extent because we can directly add a button in the circuit and also a parallel resistor to avoid the open circuit.</p><figure name="f7be" id="f7be" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5HO755qe-F8qF-kvOFgEGA.png" data-width="1146" data-height="514" src="https://cdn-images-1.medium.com/max/800/1*5HO755qe-F8qF-kvOFgEGA.png"></figure><p name="2c5f" id="2c5f" class="graf graf--p graf-after--figure">However, we would like to try something new because we want to try the GPIO input. In this case, we are going to use the GPIO10 for the input signal because GPIO10 is from GPFSEL1 and we only have to change the last bit (actually we don’t have to change it because the last bit is zero by default).</p><p name="1d0c" id="1d0c" class="graf graf--p graf-after--p">According to the instructions of <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2835/BCM2835-ARM-Peripherals.pdf" data-href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bcm2835/BCM2835-ARM-Peripherals.pdf" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">BCM2835</a> and the <a href="https://elinux.org/BCM2835_datasheet_errata#p96" data-href="https://elinux.org/BCM2835_datasheet_errata#p96" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">errata</a>,</p><figure name="00f5" id="00f5" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*3vvn_m5XcEjYOihyUEOi-A.png" data-width="1238" data-height="592" src="https://cdn-images-1.medium.com/max/800/1*3vvn_m5XcEjYOihyUEOi-A.png"></figure><figure name="3666" id="3666" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*fyWW9G6jrL4AqHAZUnMskw.png" data-width="2384" data-height="254" src="https://cdn-images-1.medium.com/max/800/1*fyWW9G6jrL4AqHAZUnMskw.png"></figure><p name="a349" id="a349" class="graf graf--p graf-after--figure">It can be aware that the LEV0 registers can be used to read the status of a specific pin. Now, let’s code the assembly file for our purpose. Our purpose is that when we press the button, the LED will be set to on and it will be blinking. When we release the button, the LED will be set to off. We will continue with our <code class="markup--code markup--p-code">blink.s</code> file.</p><pre name="8cdd" id="8cdd" class="graf graf--pre graf-after--p">.equ DELAY, 0x3F0000</pre><pre name="3f71" id="3f71" class="graf graf--pre graf-after--pre">// configure GPIO 21 for output<br>ldr r0, FSEL2<br>mov r1, #8<br>str r1, [r0]</pre><pre name="fcce" id="fcce" class="graf graf--pre graf-after--pre">mov r1, #(1&lt;&lt;21)</pre><pre name="8684" id="8684" class="graf graf--pre graf-after--pre">loop:</pre><pre name="aeba" id="aeba" class="graf graf--pre graf-after--pre">// set GPIO 21 high<br> ldr r0, SET0<br> str r1, [r0]</pre><pre name="e323" id="e323" class="graf graf--pre graf-after--pre">// delay a certain time<br> mov r2, #DELAY<br> wait1:<br>     subs r2, r2, #1<br>     bne wait1</pre><pre name="ea45" id="ea45" class="graf graf--pre graf-after--pre">// clear GPIO 21 status<br> ldr r0, CLR0<br> str r1, [r0]</pre><pre name="25c8" id="25c8" class="graf graf--pre graf-after--pre">// delay a certain time<br> mov r2, #DELAY<br> wait2:<br>     subs r2, r2, #1<br>     bne wait2<br>     <br>b loop</pre><pre name="c9a9" id="c9a9" class="graf graf--pre graf-after--pre">FSEL1: .word 0x20200004<br>FSEL2: .word 0x20200008<br>SET0: .word 0x2020001C<br>CLR0: .word 0x20200028</pre><ol class="postList"><li name="bed7" id="bed7" class="graf graf--li graf-after--pre"><strong class="markup--strong markup--li-strong">Configure GPIO 10 for input</strong></li></ol><pre name="3619" id="3619" class="graf graf--pre graf-after--li">.equ DELAY, 0x3F0000</pre><pre name="2fd6" id="2fd6" class="graf graf--pre graf-after--pre">// configure GPIO 10 for input<br>ldr r0, FSEL1<br>mov r1, #0<br>str r1, [r0]</pre><pre name="703d" id="703d" class="graf graf--pre graf-after--pre">// configure GPIO 21 for output<br>ldr r0, FSEL2<br>mov r1, #8<br>str r1, [r0]</pre><pre name="0d1e" id="0d1e" class="graf graf--pre graf-after--pre">mov r1, #(1&lt;&lt;21)</pre><pre name="e6bb" id="e6bb" class="graf graf--pre graf-after--pre">loop:</pre><pre name="2a88" id="2a88" class="graf graf--pre graf-after--pre">// set GPIO 21 high<br> ldr r0, SET0<br> str r1, [r0]</pre><pre name="bd3e" id="bd3e" class="graf graf--pre graf-after--pre">// delay a certain time<br> mov r2, #DELAY<br> wait1:<br>     subs r2, r2, #1<br>     bne wait1</pre><pre name="2576" id="2576" class="graf graf--pre graf-after--pre">// clear GPIO 21 status<br> ldr r0, CLR0<br> str r1, [r0]</pre><pre name="72cf" id="72cf" class="graf graf--pre graf-after--pre">// delay a certain time<br> mov r2, #DELAY<br> wait2:<br>     subs r2, r2, #1<br>     bne wait2<br>     <br>b loop</pre><pre name="a6d4" id="a6d4" class="graf graf--pre graf-after--pre">FSEL1: .word 0x20200004<br>FSEL2: .word 0x20200008<br>SET0: .word 0x2020001C<br>CLR0: .word 0x20200028</pre><p name="832b" id="832b" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">2. Assign bit 10 and bit 21 to r2 and r3</strong></p><pre name="4866" id="4866" class="graf graf--pre graf-after--p">.equ DELAY, 0x3F0000</pre><pre name="fe71" id="fe71" class="graf graf--pre graf-after--pre">// configure GPIO 10 for input<br>ldr r0, FSEL1<br>mov r1, #0<br>str r1, [r0]</pre><pre name="4a25" id="4a25" class="graf graf--pre graf-after--pre">// configure GPIO 21 for output<br>ldr r0, FSEL2<br>mov r1, #8<br>str r1, [r0]</pre><pre name="dee9" id="dee9" class="graf graf--pre graf-after--pre">// bit 10 and bit 21<br>mov r2, #(1&lt;&lt;10)<br>mov r3, #(1&lt;&lt;21)</pre><pre name="bc58" id="bc58" class="graf graf--pre graf-after--pre">loop:</pre><pre name="8527" id="8527" class="graf graf--pre graf-after--pre">// set GPIO 21 high<br> ldr r0, SET0<br> str r1, [r0]</pre><pre name="c118" id="c118" class="graf graf--pre graf-after--pre">// delay a certain time<br> mov r2, #DELAY<br> wait1:<br>     subs r2, r2, #1<br>     bne wait1</pre><pre name="381c" id="381c" class="graf graf--pre graf-after--pre">// clear GPIO 21 status<br> ldr r0, CLR0<br> str r1, [r0]</pre><pre name="2354" id="2354" class="graf graf--pre graf-after--pre">// delay a certain time<br> mov r2, #DELAY<br> wait2:<br>     subs r2, r2, #1<br>     bne wait2<br>     <br>b loop</pre><pre name="7a74" id="7a74" class="graf graf--pre graf-after--pre">FSEL1: .word 0x20200004<br>FSEL2: .word 0x20200008<br>SET0: .word 0x2020001C<br>CLR0: .word 0x20200028</pre><p name="661d" id="661d" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">3. Add reading GPIO10 at the beginning of every loop</strong></p><p name="eff5" id="eff5" class="graf graf--p graf-after--p">Note that we have used <code class="markup--code markup--p-code">tst</code> in this part and <code class="markup--code markup--p-code">tst r1, r2</code> computes the bitwise AND of <code class="markup--code markup--p-code">r1</code> and <code class="markup--code markup--p-code">r2</code> and then discards the result while <code class="markup--code markup--p-code">cmp r1, r2</code> subtracts the two. For example, when</p><pre name="138b" id="138b" class="graf graf--pre graf-after--p">r1 = 0110<br>r2 = 0010</pre><p name="d9d1" id="d9d1" class="graf graf--p graf-after--pre">The AND result of <code class="markup--code markup--p-code">r1</code> and <code class="markup--code markup--p-code">r2</code> is,</p><pre name="fffb" id="fffb" class="graf graf--pre graf-after--p">0010</pre><p name="7765" id="7765" class="graf graf--p graf-after--pre">We are going to use <code class="markup--code markup--p-code">tst</code> in our case,</p><pre name="56de" id="56de" class="graf graf--pre graf-after--p">.equ DELAY, 0x3F0000</pre><pre name="7e7d" id="7e7d" class="graf graf--pre graf-after--pre">// configure GPIO 10 for input<br>ldr r0, FSEL1<br>mov r1, #0<br>str r1, [r0]</pre><pre name="5a9e" id="5a9e" class="graf graf--pre graf-after--pre">// configure GPIO 21 for output<br>ldr r0, FSEL2<br>mov r1, #8<br>str r1, [r0]</pre><pre name="19b3" id="19b3" class="graf graf--pre graf-after--pre">// bit 10 and bit 21<br>mov r2, #(1&lt;&lt;10)<br>mov r3, #(1&lt;&lt;21)</pre><pre name="795d" id="795d" class="graf graf--pre graf-after--pre">loop:</pre><pre name="fa79" id="fa79" class="graf graf--pre graf-after--pre"> // read GPIO10<br> ldr r0, LEV0<br> ldr r1, [r0]<br> tst r1, r2<br> beq on // when the button is pressed (goes LOW), turn on LED</pre><pre name="d71e" id="d71e" class="graf graf--pre graf-after--pre"> // set GPIO 21 high<br> ldr r0, SET0<br> str r1, [r0]</pre><pre name="8d6a" id="8d6a" class="graf graf--pre graf-after--pre"> // delay a certain time<br> mov r2, #DELAY<br> wait1:<br>     subs r2, r2, #1<br>     bne wait1</pre><pre name="85e5" id="85e5" class="graf graf--pre graf-after--pre"> // clear GPIO 21 status<br> ldr r0, CLR0<br> str r1, [r0]</pre><pre name="5e46" id="5e46" class="graf graf--pre graf-after--pre"> // delay a certain time<br> mov r2, #DELAY<br> wait2:<br>     subs r2, r2, #1<br>     bne wait2<br>     <br>b loop</pre><pre name="dc00" id="dc00" class="graf graf--pre graf-after--pre">FSEL1: .word 0x20200004<br>FSEL2: .word 0x20200008<br>SET0: .word 0x2020001C<br>CLR0: .word 0x20200028<br>LEV0:  .word 0x20200034</pre><p name="9106" id="9106" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">4. Differ on and off status</strong></p><pre name="6889" id="6889" class="graf graf--pre graf-after--p">.equ DELAY, 0x3F0000</pre><pre name="d33e" id="d33e" class="graf graf--pre graf-after--pre">// configure GPIO 10 for input<br>ldr r0, FSEL1<br>mov r1, #0<br>str r1, [r0]</pre><pre name="362d" id="362d" class="graf graf--pre graf-after--pre">// configure GPIO 21 for output<br>ldr r0, FSEL2<br>mov r1, #8<br>str r1, [r0]</pre><pre name="22ab" id="22ab" class="graf graf--pre graf-after--pre">// bit 10 and 21<br>mov r2, #(1&lt;&lt;10)<br>mov r3, #(1&lt;&lt;21)</pre><pre name="f5ec" id="f5ec" class="graf graf--pre graf-after--pre">loop: <br>    // read GPIO 10 <br>    ldr r0, LEV0<br>    ldr r1, [r0] <br>    tst r1, r2<br>    beq on // when the button is pressed (goes LOW), turn on LED<br>    <br>    off:<br>        ldr r0, CLR0<br>        str r3, [r0]<br>        b loop</pre><pre name="265c" id="265c" class="graf graf--pre graf-after--pre">    on:<br>        // set GPIO 21 high<br>        ldr r0, SET0<br>        str r3, [r0]</pre><pre name="d7f6" id="d7f6" class="graf graf--pre graf-after--pre">        // delay a certain time<br>        mov r4, #DELAY<br>        wait1:<br>            subs r4, r4, #1<br>            bne wait1</pre><pre name="9a0d" id="9a0d" class="graf graf--pre graf-after--pre">        // clear GPIO 21 status<br>        ldr r0, CLR0<br>        str r3, [r0]</pre><pre name="b660" id="b660" class="graf graf--pre graf-after--pre">        // delay a certain time<br>        mov r4, #DELAY<br>        wait2:<br>            subs r4, r4, #1<br>            bne wait2</pre><pre name="3e28" id="3e28" class="graf graf--pre graf-after--pre">        b loop</pre><pre name="8c16" id="8c16" class="graf graf--pre graf-after--pre">FSEL1: .word 0x20200004<br>FSEL2: .word 0x20200008<br>SET0: .word 0x2020001C<br>CLR0: .word 0x20200028<br>LEV0:  .word 0x20200034</pre><p name="41b7" id="41b7" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">5. The design of the pull-up resistor</strong></p><p name="7972" id="7972" class="graf graf--p graf-after--p">A pull-up resistor connects unused input pins to the dc supply voltage to keep the given input HIGH. When the button is pressed, the given input will then be LOW. We have to add this resistor because we don’t want a short circuit when the button is pushed. That’s why we must add this resistor.</p><p name="3e70" id="3e70" class="graf graf--p graf-after--p">A similar concept is a pull-down resistor which connects unused input pins to the dc supply voltage to keep the given input LOW. When the button is pressed, the given input will then be HIGH. Actually, the pull-up resistor is more commonly used than the pull-down resistor, so we are going to use the pull-up resistor in this case.</p><p name="8c27" id="8c27" class="graf graf--p graf-after--p">In our case, when the button is pressed, the GPIO 10 pin will be connected to GND and thus the input of this pin will be given as LOW. Instead, when the button is not released, then the GPIO 10 pin will be connected to the 5V power and the input of this pin will be given as HIGH.</p><p name="5d0f" id="5d0f" class="graf graf--p graf-after--p">In our code, when the GPIO 10 pin is given HIGH (no pressed button), the result of <code class="markup--code markup--p-code">tst r1, r2</code> is <code class="markup--code markup--p-code">not equal</code> because</p><pre name="6e32" id="6e32" class="graf graf--pre graf-after--p">r1 = 0000 0000 0000 0000 0000 0100 0000 0000<br>r2 = 0000 0000 0000 0000 0000 0000 0000 0000</pre><p name="3744" id="3744" class="graf graf--p graf-after--pre">And the result of <code class="markup--code markup--p-code">tst</code> is (AND calculation),</p><pre name="eebe" id="eebe" class="graf graf--pre graf-after--p">0000 0000 0000 0000 0000 0000 0000 0000</pre><p name="1d4e" id="1d4e" class="graf graf--p graf-after--pre">That means the Z flag is zero.</p><p name="5144" id="5144" class="graf graf--p graf-after--p">when the GPIO 10 pin is given LOW (with pressed button), the result of <code class="markup--code markup--p-code">tst r1, r2</code> is <code class="markup--code markup--p-code">equal</code> because</p><pre name="688b" id="688b" class="graf graf--pre graf-after--p">r1 = 0000 0000 0000 0000 0000 0100 0000 0000<br>r2 = 0000 0000 0000 0000 0000 0100 0000 0000</pre><p name="560d" id="560d" class="graf graf--p graf-after--pre">And the result of <code class="markup--code markup--p-code">tst</code> is (AND calculation),</p><pre name="c1c3" id="c1c3" class="graf graf--pre graf-after--p">0000 0000 0000 0000 0000 0100 0000 0000</pre><p name="18a6" id="18a6" class="graf graf--p graf-after--pre">That means the Z flag is not zero.</p><p name="a9f0" id="a9f0" class="graf graf--p graf-after--p">The circuit of this experiment is,</p><figure name="ba62" id="ba62" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*enU-1bew5TmrGQptnYEV4g.png" data-width="1110" data-height="540" src="https://cdn-images-1.medium.com/max/800/1*enU-1bew5TmrGQptnYEV4g.png"></figure><figure name="3a63" id="3a63" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*pLOcE4-JgUaBbd7mO-j7sg.png" data-width="1156" data-height="558" src="https://cdn-images-1.medium.com/max/800/1*pLOcE4-JgUaBbd7mO-j7sg.png"></figure><p name="24f2" id="24f2" class="graf graf--p graf-after--figure">and you can find the code from my <a href="https://github.com/Sadamingh/ComputerSysE/tree/main/button%20LED" data-href="https://github.com/Sadamingh/ComputerSysE/tree/main/button%20LED" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">repo</a>.</p><p name="ba7f" id="ba7f" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Common mistakes:</strong></p><ul class="postList"><li name="b000" id="b000" class="graf graf--li graf-after--p">The 10k resistor should be connected to the 5V power pin. Don’t connect it with the GPIO 21 pin.</li><li name="9137" id="9137" class="graf graf--li graf-after--li">The pull-up resistor should be connected between the 5C power pin and the GPIO 10 pin.</li><li name="7888" id="7888" class="graf graf--li graf-after--li graf--trailing">The control button (switch) should be connected between the GND and the 10k pull-up resistor.</li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/510a08e29308"><time class="dt-published" datetime="2021-01-01T04:50:34.276Z">January 1, 2021</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/computer-systems-experiments-7-button-controlled-blinking-led-and-pull-up-resistor-510a08e29308" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>