<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Linux操作系统实践5 设置Raspberry Pi</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Linux操作系统实践5 设置Raspberry Pi</h1>
</header>
<section data-field="subtitle" class="p-summary">
系列：Linux操作系统实践
</section>
<section data-field="body" class="e-content">
<section name="723b" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="1a90" id="1a90" class="graf graf--h3 graf--leading graf--title">Linux操作系统实践5 设置Raspberry Pi</h3><figure name="7b5a" id="7b5a" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*beSHA3cQNnPOOKl4ypDgfw.jpeg" data-width="2689" data-height="1513" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*beSHA3cQNnPOOKl4ypDgfw.jpeg"></figure><p name="de0a" id="de0a" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">一、在本实验中，您将：</strong></p><ul class="postList"><li name="ec73" id="ec73" class="graf graf--li graf-after--p">了解如何在计算机上针对Raspberry Pi的ARM处理器进行交叉开发。</li><li name="bb97" id="bb97" class="graf graf--li graf-after--li">了解如何使用带有LED和按钮的面包板。</li><li name="5975" id="5975" class="graf graf--li graf-after--li">了解如何在Raspberry Pi上下载和运行裸机程序。</li><li name="490a" id="490a" class="graf graf--li graf-after--li">重新查看Blink程序的汇编代码并稍作播放。</li></ul><p name="0f90" id="0f90" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">二、实验前准备</strong></p><ul class="postList"><li name="0ad5" id="0ad5" class="graf graf--li graf-after--p">确保你已经阅读并配置了1～4中的内容</li><li name="861d" id="861d" class="graf graf--li graf-after--li">确保你已经准备好了硬件</li><li name="78a2" id="78a2" class="graf graf--li graf-after--li">确保你的电脑上有USB-A接口，如果没有，确保你有适配器</li><li name="7940" id="7940" class="graf graf--li graf-after--li">确保你的文件是最新的：</li></ul><pre name="a806" id="a806" class="graf graf--pre graf-after--li"><code class="markup--code markup--pre-code">$ cd ~/cs107e_home/cs107e.github.io<br>$ git pull</code></pre><ul class="postList"><li name="9df2" id="9df2" class="graf graf--li graf-after--pre">由于lab文件是单独储存的，因此在实验开始之前，我们需要clone本次实验所需的文件</li></ul><pre name="4c38" id="4c38" class="graf graf--pre graf-after--li"><code class="markup--code markup--pre-code">$ cd ~/cs107e_home/<br>$ git clone https://github.com/cs107e/lab1</code></pre><ul class="postList"><li name="bcd4" id="bcd4" class="graf graf--li graf-after--pre">编译二进制Blink文件，我们在lab1的code目录中提供的blink.s是汇编语言程序，我们需要将其转换为二进制程序。我们通过<code class="markup--code markup--li-code">arm-none-eabi</code>工具链中的工具来实现这一功能。</li></ul><pre name="5d97" id="5d97" class="graf graf--pre graf-after--li"><code class="markup--code markup--pre-code">$ cd lab1/code/blink<br>$ arm-none-eabi-as blink.s -o blink.o<br>$ arm-none-eabi-objcopy blink.o -O binary blink.bin</code></pre><p name="a7f3" id="a7f3" class="graf graf--p graf-after--pre">最后，我们得到二进制文件<code class="markup--code markup--p-code">blink.bin</code>。</p><ul class="postList"><li name="d441" id="d441" class="graf graf--li graf-after--p">盘点你的装备：在这个实验中，我们需要一个LED，一个1k和一个10k电阻，四条杜邦线（2M-F，2F-F），Raspberry Pi A+，CP2102串口，SD卡。</li><li name="d38a" id="d38a" class="graf graf--li graf-after--li">熟悉下面这张pinout图：</li></ul><figure name="5953" id="5953" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*3fwDgrnqhJbnaqZWOQhlxw.png" data-width="1692" data-height="1488" src="https://cdn-images-1.medium.com/max/800/1*3fwDgrnqhJbnaqZWOQhlxw.png"><figcaption class="imageCaption"><a href="http://cs107e.github.io/guides/images/pinout.pdf" data-href="http://cs107e.github.io/guides/images/pinout.pdf" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">http://cs107e.github.io/guides/images/pinout.pdf</a></figcaption></figure><p name="0054" id="0054" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">三、通过Raspberry Pi给面包板供电</strong></p><p name="3e83" id="3e83" class="graf graf--p graf-after--p">我们不再赘述面包板和LED的使用，如果你不了解，请使用搜索引擎查询即可。请注意，LED是定向的。较长的铅是阳极，较短的铅是阴极。从阳极到阴极的电压应为正。如果切换了电压的极性，则LED不会点亮。LED还需要一个1K的限流电阻，否则它可能会<a href="https://www.youtube.com/watch?v=WLctUO1DGtw" data-href="https://www.youtube.com/watch?v=WLctUO1DGtw" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">在燃烧，冒烟的情况下爆炸</a>！</p><p name="4dd9" id="4dd9" class="graf graf--p graf-after--p">通常来说在进行布线时，具有电子学经验的人员会使用彩色电线来指示该电线承载的信号类型。这使得调试接线和可视化正在发生的事情变得容易得多。通常，我们将使用以下约定。</p><ul class="postList"><li name="37d3" id="37d3" class="graf graf--li graf-after--p">黑色（GND）</li><li name="9254" id="9254" class="graf graf--li graf-after--li">红色（5V）</li><li name="c3a6" id="c3a6" class="graf graf--li graf-after--li">橙色（3.3V）</li><li name="f644" id="f644" class="graf graf--li graf-after--li">蓝色（主机输出）</li><li name="9fd5" id="9fd5" class="graf graf--li graf-after--li">绿色（主机输入）</li></ul><p name="706d" id="706d" class="graf graf--p graf-after--li">在这一步，我们并不需要用Raspberry Pi进行编程，这里Raspberry Pi只是起到供电的作用。</p><figure name="2bb1" id="2bb1" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*XM7xmlmAcCX5O-xA0_aB3g.png" data-width="882" data-height="770" src="https://cdn-images-1.medium.com/max/800/1*XM7xmlmAcCX5O-xA0_aB3g.png"><figcaption class="imageCaption">通过Raspberry Pi供电</figcaption></figure><figure name="dffc" id="dffc" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*kmh65jJz7Qcpevibw5O59g.png" data-width="1588" data-height="762" src="https://cdn-images-1.medium.com/max/800/1*kmh65jJz7Qcpevibw5O59g.png"><figcaption class="imageCaption">原理图</figcaption></figure><p name="4e17" id="4e17" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">四、让ACT灯闪烁</strong></p><p name="170f" id="170f" class="graf graf--p graf-after--p">在这一部分中，我们将要配置的是SD卡。通过更改SD卡中的内容，我们希望Raspberry Pi上的ACT（绿色）灯闪烁。</p><p name="5cab" id="5cab" class="graf graf--p graf-after--p">我们拿出我们的microSDHC卡，将它通过读卡器连在电脑上（如果电脑本身有卡槽，直接插入即可）。我们先来确认SD卡是否已经被电脑读取：</p><pre name="2f9b" id="2f9b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ ls /Volumes</code></pre><p name="6796" id="6796" class="graf graf--p graf-after--pre">输出的NO NAME目录实际上就是我们的SD卡：</p><pre name="3727" id="3727" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">Macintosh HD    NO NAME</code></pre><p name="93fe" id="93fe" class="graf graf--p graf-after--pre">Raspberry Pi固件文件存储在课件存储库的固件子目录中。转到该目录并确认您具有以下4个文件：</p><pre name="240e" id="240e" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ cd ~/cs107e_home/cs107e.github.io/firmware<br>$ ls<br>blink-actled.bin   bootloader.bin  <br>bootcode.bin       start.elf</code></pre><p name="0c28" id="0c28" class="graf graf--p graf-after--pre">在<code class="markup--code markup--p-code">bootcode.bin</code>和<code class="markup--code markup--p-code">start.elf</code>文件需要启动的树莓派。另外两个文件 <code class="markup--code markup--p-code">blink-actled.bin</code>和<code class="markup--code markup--p-code">bootloader.bin</code>是程序。</p><p name="09d1" id="09d1" class="graf graf--p graf-after--p">SD卡需要一个名为的附加文件<code class="markup--code markup--p-code">kernel.img</code>。通常，<code class="markup--code markup--p-code">kernel.img</code>是您要在Pi上运行的操作系统内核，例如Linux或Windows。但是请注意，我们没有给您<code class="markup--code markup--p-code">kernel.img</code>！后续的章节中我们将编写自己的程序来代替内核，并将程序命名为<code class="markup--code markup--p-code">kernel.img</code>。</p><p name="1e96" id="1e96" class="graf graf--p graf-after--p">我们选择先运行<code class="markup--code markup--p-code">blink-actled.bin</code>。该程序使Raspberry Pi板角附近的绿色活动（ACT）LED闪烁。我们按照下面的步骤操作：</p><ol class="postList"><li name="fb6c" id="fb6c" class="graf graf--li graf-after--p">将固件文件夹中的四个文件复制到SD卡上：</li></ol><pre name="cbce" id="cbce" class="graf graf--pre graf-after--li">$ cp ~/cs107e_home/cs107e.github.io/firmware/* /Volumes/NO\ NAME</pre><p name="8211" id="8211" class="graf graf--p graf-after--pre">2. 在SD卡上，复制<code class="markup--code markup--p-code">blink-actled.bin</code>名为 的副本<code class="markup--code markup--p-code">kernel.img</code>。</p><pre name="4b82" id="4b82" class="graf graf--pre graf-after--p">$ cd /Volumes/NO\ NAME/<br>$ cp blink-actled.bin kernel.img</pre><p name="5e99" id="5e99" class="graf graf--p graf-after--pre">3. 确认SD卡上有如下文件</p><pre name="be6b" id="be6b" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ ls<br>blink-actled.bin    bootloader.bin        start.elf<br>bootcode.bin        kernel.img</code></pre><p name="3a21" id="3a21" class="graf graf--p graf-after--pre">Raspberry Pi启动顺序的三个关键文件是：</p><ul class="postList"><li name="8d8b" id="8d8b" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code">bootcode.bin</code>启动GPU</li><li name="3a43" id="3a43" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">start.elf</code> 启动CPU</li><li name="1271" id="1271" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code">kernel.img</code> Pi执行的程序</li></ul><p name="2172" id="2172" class="graf graf--p graf-after--li">4. 弹出SD卡。如果终端阻止您退出，请键入<code class="markup--code markup--p-code">cd ..</code>以移至父文件夹，然后再次尝试退出。</p><p name="855a" id="855a" class="graf graf--p graf-after--p">5. 将Micro SD卡插入Raspberry Pi板底部的插槽中。</p><p name="e82b" id="e82b" class="graf graf--p graf-after--p">6. 给Pi供电。Pi板上的绿色ACT LED应该开始闪烁。</p><p name="338b" id="338b" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">五、让LED闪烁</strong></p><p name="dcc2" id="dcc2" class="graf graf--p graf-after--p">刚刚我们成功让ACT灯进行闪烁，下面我们希望让LED灯不断闪烁，这要求我们对某一个引脚输出间歇脉冲。lab1目录中提供了blink.s程序（我们已经在准备工作中将它转化为二进制文件），它的目的是在引脚GPIO20发出间歇脉冲，我们可以用它来实现我们的目的。我们用blink.bin替换<code class="markup--code markup--p-code">blink-actled.bin</code>。</p><p name="6451" id="6451" class="graf graf--p graf-after--p">我们弹出SD卡，将其插入读卡器。进入NO NAME目录后，我们先删除<code class="markup--code markup--p-code">blink-actled.bin</code>和<code class="markup--code markup--p-code">kernel.img</code>两个程序，因为我们要用blink.bin这个程序。</p><pre name="77d9" id="77d9" class="graf graf--pre graf-after--p">$ rm <code class="markup--code markup--pre-code">blink-actled.bin kernel.img</code></pre><p name="399a" id="399a" class="graf graf--p graf-after--pre">之后我们将blink.bin文件复制到当前目录：</p><pre name="4b18" id="4b18" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ cp ~/cs107e_home/lab1/code/blink/blink.bin . </code></pre><p name="a2c5" id="a2c5" class="graf graf--p graf-after--pre">同样地，我们复制blink.bin文件到当前目录，并将其命名为<code class="markup--code markup--p-code">kernel.img</code>。</p><pre name="dffa" id="dffa" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ cp blink.bin kernel.img</code></pre><p name="de1d" id="de1d" class="graf graf--p graf-after--pre">通过ls命令我们检查SD卡的配置情况：</p><pre name="d92b" id="d92b" class="graf graf--pre graf-after--p">$ ls<br>blink.bin bootcode.bin bootloader.bin kernel.img start.elf</pre><p name="f54c" id="f54c" class="graf graf--p graf-after--pre">配置完SD卡之后，我们就可以将SD卡轻轻插回Raspberry Pi上。之后我们需要调整一下我们的布线。原理图如下：</p><figure name="d9a9" id="d9a9" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*22spNRQT34hE8I-Nt1IT9w.png" data-width="1600" data-height="764" src="https://cdn-images-1.medium.com/max/800/1*22spNRQT34hE8I-Nt1IT9w.png"></figure><p name="3ad3" id="3ad3" class="graf graf--p graf-after--figure">实际布线如下图（实际上LED确实是在闪烁的）所示：</p><figure name="83b4" id="83b4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*MXUYYrQsiEur5_L6Anz3ZA.png" data-width="976" data-height="764" src="https://cdn-images-1.medium.com/max/800/1*MXUYYrQsiEur5_L6Anz3ZA.png"></figure><p name="a70d" id="a70d" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">六、引导加载程序</strong></p><p name="c7ce" id="c7ce" class="graf graf--p graf-after--p">迄今为止，每一次我们想要更改程序的时候，我们都需要插拔SD卡——这非常不好，不仅仅SD卡会被磨损，树莓派的SD卡接口也是有寿命的。相反，我们可以在笔记本电脑和Pi之间建立串行连接，并使用<strong class="markup--strong markup--p-strong">引导加载程序bootloader</strong>来传输程序。引导程序在您的Pi上运行，并侦听串行连接。在笔记本电脑上，您运行脚本以通过串行连接将程序发送到等待的引导程序。引导加载程序接收程序并将其写入Pi的内存，此过程称为“加载”程序。加载程序后，引导程序会跳到程序的起始地址，然后程序开始运行。</p><p name="124d" id="124d" class="graf graf--p graf-after--p">为了完成上面的目标，我们需要按照以下步骤配置：</p><ol class="postList"><li name="a538" id="a538" class="graf graf--li graf-after--p">将SD卡连接到电脑上，将<code class="markup--code markup--li-code">kernel.img</code>替换为引导程序bootloader.bin</li></ol><pre name="0bd6" id="0bd6" class="graf graf--pre graf-after--li">$ rm kernel.img<br>$ cp bootloader.bin kernel.img</pre><p name="2b71" id="2b71" class="graf graf--p graf-after--pre">2. 弹出SD卡并安装在Pi上</p><p name="bd50" id="bd50" class="graf graf--p graf-after--p">3. 连接RX和TX接口，原理图如下。我们将TX口（主机输出）用蓝导线，RX口（主机输入）用绿导线。在图中，绿色线将USB串行上的RX插头引脚连接到Pi的TX引脚（GPIO 14）。蓝线将USB串行端口上的TX接头引脚连接到Pi的RX引脚（GPIO 15）。</p><figure name="c2ad" id="c2ad" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5EIN5-MGyYLXW6CPNNmBtg.png" data-width="856" data-height="522" src="https://cdn-images-1.medium.com/max/800/1*5EIN5-MGyYLXW6CPNNmBtg.png"></figure><figure name="2609" id="2609" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*Fa3sL_Rv27g64W6POea7_A.png" data-width="1442" data-height="796" src="https://cdn-images-1.medium.com/max/800/1*Fa3sL_Rv27g64W6POea7_A.png"></figure><p name="0a47" id="0a47" class="graf graf--p graf-after--figure">4. 插入USB串口以重置Pi。</p><p name="999e" id="999e" class="graf graf--p graf-after--p">引导加载程序应在重置时运行。bootloader运行时，它会通过在Pi板上反复闪烁两次绿色ACT LED来发出信号，表示它正在等待接收程序。此“ da-dum”是心跳，告诉您引导加载程序已准备就绪且正在监听。现在看看您的Pi，并观察这个节奏。</p><p name="3842" id="3842" class="graf graf--p graf-after--p">这个时候LED灯是不闪烁的，这是因为blink.bin程序并没有被执行。</p><p name="3a07" id="3a07" class="graf graf--p graf-after--p">5. 再次检查<code class="markup--code markup--p-code">rpi-install.py</code>脚本的版本：</p><pre name="a468" id="a468" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ rpi-install.py -h</code></pre><p name="aca7" id="aca7" class="graf graf--p graf-after--pre">我们之前已经重复了很多次这个步骤，这里再做一次，确认版本号为1.1。</p><p name="aee1" id="aee1" class="graf graf--p graf-after--p">6. 传输数据。我们通过下面的语句来给Pi传输数据：</p><pre name="9b93" id="9b93" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">$ </code>cd ~/cs107e_home/lab1/code/blink/blink.bin<code class="markup--code markup--pre-code"><br>$ rpi-install.py blink.bin</code></pre><p name="be45" id="be45" class="graf graf--p graf-after--pre">7. 引导程序在接收程序时会打开ACT LED并保持稳定，直到传输完成。引导加载程序然后关闭ACT LED并将执行转移到接收到的程序。该<code class="markup--code markup--p-code">blink.bin</code>程序现在应该闪烁在你的面包板的LED。</p><p name="e62f" id="e62f" class="graf graf--p graf-after--p">8. 如果您更改程序并希望将其重新加载到Pi上，则必须首先重置Pi。如果<code class="markup--code markup--p-code">rpi-install.py</code>在引导加载程序已经加载程序之后第二次尝试运行，该怎么办？重置Pi的一种方法是通过从笔记本电脑上拔下USB串行端口来暂时切断电源，然后再次将其插入。Pi将重新启动进入引导程序，准备接收新程序。</p><p name="6e34" id="6e34" class="graf graf--p graf-after--p graf--trailing">备注：我们这里不去仔细阅读blink.s文件的内容，我们会用接下来的几章讲解ARM结构及其汇编，直到我们能够较为独立地阅读代码。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/f32e7845d3a7"><time class="dt-published" datetime="2020-05-01T20:41:01.950Z">May 1, 2020</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E8%B7%B55-%E8%AE%BE%E7%BD%AEraspberry-pi-f32e7845d3a7" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>