<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>密码导论4 散列和签名</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">密码导论4 散列和签名</h1>
</header>
<section data-field="subtitle" class="p-summary">
系列：密码导论
</section>
<section data-field="body" class="e-content">
<section name="ae28" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d09d" id="d09d" class="graf graf--h3 graf--leading graf--title">密码导论4 散列和签名</h3><figure name="f1c6" id="f1c6" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*EMMJWRwbE-Ua0JxrAZskPA.jpeg" data-width="2250" data-height="1500" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*EMMJWRwbE-Ua0JxrAZskPA.jpeg"></figure><p name="55ba" id="55ba" class="graf graf--p graf-after--figure">一、哈希函数 Hash Function</p><p name="b026" id="b026" class="graf graf--p graf-after--p">哈希函数是把消息或数据压缩成摘要，从而使数据量变小。哈希函数有如下所示的基本特征：</p><ul class="postList"><li name="59f0" id="59f0" class="graf graf--li graf-after--p">输入长度可变，输入长度可以是任意长度</li><li name="cf45" id="cf45" class="graf graf--li graf-after--li">输出长度固定，不论是什么输入都输出固定的长度</li><li name="c5a8" id="c5a8" class="graf graf--li graf-after--li">效率高：对于任意消息 <em class="markup--em markup--li-em">x</em>，计算 <em class="markup--em markup--li-em">H</em>(<em class="markup--em markup--li-em">x</em>) 非常容易</li><li name="c07d" id="c07d" class="graf graf--li graf-after--li">单向性：对于任意哈希值 <em class="markup--em markup--li-em">h</em>，想要找到满足 <em class="markup--em markup--li-em">H</em>(<em class="markup--em markup--li-em">x</em>) = <em class="markup--em markup--li-em">h</em> 的 <em class="markup--em markup--li-em">x</em> 在计算上不可行</li><li name="ae60" id="ae60" class="graf graf--li graf-after--li">抗弱碰撞性：对于任意消息 <em class="markup--em markup--li-em">x</em>，想要找到消息 y，使得 <em class="markup--em markup--li-em">H</em>(<em class="markup--em markup--li-em">x</em>) = <em class="markup--em markup--li-em">H</em>(<em class="markup--em markup--li-em">y</em>) 在计算上不可行</li><li name="3eeb" id="3eeb" class="graf graf--li graf-after--li">抗强碰撞性：找到任意一对满足 <em class="markup--em markup--li-em">H</em>(<em class="markup--em markup--li-em">x</em>) = <em class="markup--em markup--li-em">H</em>(<em class="markup--em markup--li-em">y</em>) 的消息 <em class="markup--em markup--li-em">x</em> 和 <em class="markup--em markup--li-em">y</em> 在计算上不可行</li><li name="a2e8" id="a2e8" class="graf graf--li graf-after--li">伪随机性：哈希函数的输出结果能够通过随机性测试标准</li></ul><p name="06d0" id="06d0" class="graf graf--p graf-after--li">（1）哈希函数的功能</p><ul class="postList"><li name="d329" id="d329" class="graf graf--li graf-after--p">确保消息的完整性，验证收到的数据和发出的数据是相同的</li><li name="edc2" id="edc2" class="graf graf--li graf-after--li">用于单向口令文件，例如Linux的密码</li><li name="ec9a" id="ec9a" class="graf graf--li graf-after--li">入侵检测和病毒检测中根据特征码检验</li></ul><p name="b224" id="b224" class="graf graf--p graf-after--li">（2）常用的哈希函数</p><ul class="postList"><li name="c6d4" id="c6d4" class="graf graf--li graf-after--p">md5：有128bit和256bit的输出，128bit的md5更加常用。由于md5的碰撞已经被提取，所以现在安全性要求比较高的业务一般不会选择md5进行加密（验证性的就没什么问题）。</li><li name="975b" id="975b" class="graf graf--li graf-after--li">sha1：是160bit的输出</li><li name="cc22" id="cc22" class="graf graf--li graf-after--li">sha256：是256bit的输出</li><li name="4c4d" id="4c4d" class="graf graf--li graf-after--li">sha512：是512bit的输出</li></ul><p name="8d2e" id="8d2e" class="graf graf--p graf-after--li">（3）md5的识别：四个初始向量IV</p><ul class="postList"><li name="1535" id="1535" class="graf graf--li graf-after--p">0x67452301</li><li name="964d" id="964d" class="graf graf--li graf-after--li">0xEFCDAB89</li><li name="ac94" id="ac94" class="graf graf--li graf-after--li">0x98BADCFE</li><li name="f337" id="f337" class="graf graf--li graf-after--li">0x10325476</li></ul><p name="207d" id="207d" class="graf graf--p graf-after--li">（4）md5的破解</p><ul class="postList"><li name="1a7e" id="1a7e" class="graf graf--li graf-after--p"><a href="https://www.cmd5.com/" data-href="https://www.cmd5.com/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">cmd5</a></li><li name="48c4" id="48c4" class="graf graf--li graf-after--li"><a href="http://www.ttmd5.com/" data-href="http://www.ttmd5.com/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">ttmd5</a></li><li name="00c9" id="00c9" class="graf graf--li graf-after--li"><a href="https://pmd5.com/" data-href="https://pmd5.com/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">pmd5</a></li></ul><p name="e1c7" id="e1c7" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">二、数字签名</strong></p><p name="3f53" id="3f53" class="graf graf--p graf-after--p">数字签名的基础是非对称密码，目的是确保信息的认证性和不可否认性。由于数字签名的目的是为了证明信息是某对象发出的，所以数字签名中公钥和私钥的逻辑实际上和RSA算法中公钥和私钥的逻辑有所不同。RSA算法本质上是为了保证私密性，所以给出的公钥是加密过程中的 Key，只有可以解密的对象才能够获得用于解密的 Key，称为私钥。数字签名则恰恰相反，为了让所有人都能验证信息是不是由某个特定的对象发出的，所以公钥实际上是用于解密的 Key，而私钥是加密过程中产生的 Key。</p><p name="0d76" id="0d76" class="graf graf--p graf-after--p">由于某个服务器的公钥一般是固定的，公钥如果在短时间内多次更改将会被列入不信任的服务器。所以，如果想要伪造信息进行通信的话，首先要得到私钥。如果没有私钥的话，加密的信息很难被公钥无法解密或者解密后的内容和证书上的散列值不同，那么就可以认为得到的信息是无效的。</p><p name="8cb2" id="8cb2" class="graf graf--p graf-after--p">数字签名的生成和验证过程如下：</p><figure name="b7d4" id="b7d4" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*5VusV6AjC1a9rIeFqHMalA.png" data-width="1290" data-height="750" src="https://cdn-images-1.medium.com/max/800/1*5VusV6AjC1a9rIeFqHMalA.png"></figure><p name="f647" id="f647" class="graf graf--p graf-after--figure">（1）数字签名的特征</p><ul class="postList"><li name="5ca2" id="5ca2" class="graf graf--li graf-after--p">签名是可信的：任何人都可以验证签名的有效性</li><li name="16b7" id="16b7" class="graf graf--li graf-after--li">签名是不可伪造的：除了合法的签名者之外，任何人想要伪造签名都是非常困难的</li><li name="b32a" id="b32a" class="graf graf--li graf-after--li">签名是不可复制的：对一个消息的签名不能通过复制变为另一个消息的签名。</li><li name="c575" id="c575" class="graf graf--li graf-after--li">签名的不可改变性：一旦签名被篡改了，任何人都可以发现签名和消息之间的不一致性，从而拒绝通信。</li><li name="9547" id="9547" class="graf graf--li graf-after--li">签名的不可抵赖性：签名者事后不能否认自己的签名，因为签名是不可伪造的</li></ul><p name="d791" id="d791" class="graf graf--p graf-after--li">（2）常见的数字签名</p><ul class="postList"><li name="f3c8" id="f3c8" class="graf graf--li graf-after--p">RSA数字签名</li><li name="7765" id="7765" class="graf graf--li graf-after--li">DSA数字签名</li></ul><p name="5394" id="5394" class="graf graf--p graf-after--li">（3）RSA数字签名：原理类似于RSA加密，但是使用私钥进行加密，加密的结果进行签名</p><pre name="b5d5" id="b5d5" class="graf graf--pre graf-after--p">signature = pow(h(m), d, n)</pre><p name="2a8b" id="2a8b" class="graf graf--p graf-after--pre">（4）DSA数字签名：用途广泛，英文全称为 Digital Signature Algorithm，只能用于数字签名的生成，不能够用于加密。</p><p name="b107" id="b107" class="graf graf--p graf-after--p">（5）DSA算法生成数字签名的过程</p><ul class="postList"><li name="23ba" id="23ba" class="graf graf--li graf-after--p">第一步：选择合适的哈希函数，由于md5不安全，所以一般选用sha1及更高级别的hash函数</li><li name="9df4" id="9df4" class="graf graf--li graf-after--li">第二步：选择密钥的长度 L 和 N 。L 和 N 直接决定了签名的安全程度。最初 Digital Signature Standard（DSS） 中建议 L 必须为 64 的倍数，并且建议 521 &lt; L &lt;1024，当然也可以更大。此外 DSS 还建议 N 的大小必须不大于第一步中哈希函数输出的长度。FIPS 186–3 给出了一些具体的取值建议，例如 ( 1024 , 160 )，( 2048 , 224 )， ( 2048 , 256 )，( 3072 , 256 )</li><li name="64e3" id="64e3" class="graf graf--li graf-after--li">第三步：选择 N 比特的素数<em class="markup--em markup--li-em"> q</em></li><li name="54e8" id="54e8" class="graf graf--li graf-after--li">第四步：选择 L 比特的素数 <em class="markup--em markup--li-em">p</em>，使得 <em class="markup--em markup--li-em">p - 1</em> 是 <em class="markup--em markup--li-em">q </em>的倍数</li><li name="94f2" id="94f2" class="graf graf--li graf-after--li">第五步：选择 <em class="markup--em markup--li-em">g</em> 满足：</li></ul><figure name="8db9" id="8db9" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*bCWTkQKr7Ufv-xwkDz5A6Q.png" data-width="1232" data-height="60" src="https://cdn-images-1.medium.com/max/800/1*bCWTkQKr7Ufv-xwkDz5A6Q.png"></figure><p name="b12e" id="b12e" class="graf graf--p graf-after--figure">此 <em class="markup--em markup--p-em">g</em> 可以通过下面的算式计算（不需要掌握）：</p><figure name="8a79" id="8a79" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*pLOUSJRKrmzg3J0MbGP8LQ.png" data-width="1232" data-height="82" src="https://cdn-images-1.medium.com/max/800/1*pLOUSJRKrmzg3J0MbGP8LQ.png"></figure><ul class="postList"><li name="f177" id="f177" class="graf graf--li graf-after--figure">第六步：选择私钥 0 &lt; <em class="markup--em markup--li-em">x</em> &lt; <em class="markup--em markup--li-em">q</em>，计算：</li></ul><figure name="8e8d" id="8e8d" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*37WeFs-C1pHkO3Ccp_uU1g.png" data-width="1232" data-height="60" src="https://cdn-images-1.medium.com/max/800/1*37WeFs-C1pHkO3Ccp_uU1g.png"></figure><ul class="postList"><li name="6e34" id="6e34" class="graf graf--li graf-after--figure">第七步：设置公钥为 ( <em class="markup--em markup--li-em">p , q , g , y</em> )，私钥为 ( <em class="markup--em markup--li-em">x</em> )</li></ul><p name="2b0f" id="2b0f" class="graf graf--p graf-after--li">（6）对信息 <em class="markup--em markup--p-em">m</em> 进行DSA签名的过程</p><ul class="postList"><li name="59b7" id="59b7" class="graf graf--li graf-after--p">第一步：选择随机整数 <em class="markup--em markup--li-em">k</em> 作为临时密钥，0 <em class="markup--em markup--li-em">&lt; k &lt; q</em></li><li name="4e53" id="4e53" class="graf graf--li graf-after--li">第二步：通过下面的算式计算 <em class="markup--em markup--li-em">r</em></li></ul><figure name="949f" id="949f" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*auJEZzBar4g4nCNLWK51Ww.png" data-width="1232" data-height="74" src="https://cdn-images-1.medium.com/max/800/1*auJEZzBar4g4nCNLWK51Ww.png"></figure><ul class="postList"><li name="02d6" id="02d6" class="graf graf--li graf-after--figure">第三步：通过下面的算式计算 <em class="markup--em markup--li-em">s</em>（k^-1指的是k关于q的逆元）</li></ul><figure name="0acd" id="0acd" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*O0grCnSFB2nLcSF3ECvUtg.png" data-width="1232" data-height="74" src="https://cdn-images-1.medium.com/max/800/1*O0grCnSFB2nLcSF3ECvUtg.png"></figure><p name="5a5d" id="5a5d" class="graf graf--p graf-after--figure">（7）对信息 <em class="markup--em markup--p-em">m </em>验证DSA签名的过程（验证不需要 <em class="markup--em markup--p-em">x</em> 和 <em class="markup--em markup--p-em">k</em>）</p><ul class="postList"><li name="57ad" id="57ad" class="graf graf--li graf-after--p">第一步：计算辅助值 <em class="markup--em markup--li-em">w</em></li></ul><figure name="febe" id="febe" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*oCGY0vSS-LjOamsEY6j6oA.png" data-width="1232" data-height="62" src="https://cdn-images-1.medium.com/max/800/1*oCGY0vSS-LjOamsEY6j6oA.png"></figure><ul class="postList"><li name="9cbb" id="9cbb" class="graf graf--li graf-after--figure">第二步：计算辅助值 <em class="markup--em markup--li-em">u1</em></li></ul><figure name="b451" id="b451" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*ymuOefZMuxYu_65DYtlHpg.png" data-width="1232" data-height="62" src="https://cdn-images-1.medium.com/max/800/1*ymuOefZMuxYu_65DYtlHpg.png"></figure><ul class="postList"><li name="cbab" id="cbab" class="graf graf--li graf-after--figure">第三步：计算辅助值 <em class="markup--em markup--li-em">u2</em></li></ul><figure name="83a9" id="83a9" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*w7zLId5TASHlmbK1R5RPWQ.png" data-width="1232" data-height="64" src="https://cdn-images-1.medium.com/max/800/1*w7zLId5TASHlmbK1R5RPWQ.png"></figure><ul class="postList"><li name="e2f6" id="e2f6" class="graf graf--li graf-after--figure">第四步：计算校验值 <em class="markup--em markup--li-em">v</em></li></ul><figure name="19b0" id="19b0" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*UWP-vM6jJgpqmAtpx9KH8Q.png" data-width="1232" data-height="64" src="https://cdn-images-1.medium.com/max/800/1*UWP-vM6jJgpqmAtpx9KH8Q.png"></figure><ul class="postList"><li name="09ea" id="09ea" class="graf graf--li graf-after--figure">第五步：如果 <em class="markup--em markup--li-em">v = r</em>，则校验成功</li></ul><p name="2840" id="2840" class="graf graf--p graf-after--li">三、密钥交换</p><p name="2106" id="2106" class="graf graf--p graf-after--p">密钥交换就是密钥协商的过程，指的是通信双方通过某种不被其他人知道的方式约定一个密钥，同时不被他人获取。</p><p name="28ef" id="28ef" class="graf graf--p graf-after--p">（1）DH (Diffie-Hellman)密钥交换</p><p name="b176" id="b176" class="graf graf--p graf-after--p">第一步：通信双方甲和乙约定好一个大素数 <em class="markup--em markup--p-em">p</em>，以及一个数<em class="markup--em markup--p-em"> g</em> &lt; <em class="markup--em markup--p-em">p。</em>在此步骤中<em class="markup--em markup--p-em"> p</em> 和 <em class="markup--em markup--p-em">g</em> 可以公开</p><p name="3a7d" id="3a7d" class="graf graf--p graf-after--p">第二步：甲随机产生一个数 <em class="markup--em markup--p-em">a</em>，并计算 <em class="markup--em markup--p-em">A ≡ g^a mod p</em>，之后甲将 <em class="markup--em markup--p-em">A</em> 发送给乙。在此步骤中<em class="markup--em markup--p-em"> A</em> 可以公开，但是 <em class="markup--em markup--p-em">a</em> 不能公开。</p><p name="f5b5" id="f5b5" class="graf graf--p graf-after--p">第三步：甲随机产生一个数 <em class="markup--em markup--p-em">b</em>，并计算 <em class="markup--em markup--p-em">B ≡ g^b mod p</em>，之后乙将 <em class="markup--em markup--p-em">B</em> 发送给乙。在此步骤中<em class="markup--em markup--p-em"> B </em>可以公开，但是 <em class="markup--em markup--p-em">b</em> 不能公开。</p><p name="0138" id="0138" class="graf graf--p graf-after--p">第四步：甲计算 <em class="markup--em markup--p-em">k1 = B^a mod p</em></p><p name="cf6a" id="cf6a" class="graf graf--p graf-after--p">第五步：乙计算 <em class="markup--em markup--p-em">k2 = A^b mod p</em></p><p name="af91" id="af91" class="graf graf--p graf-after--p graf--trailing">由于 <em class="markup--em markup--p-em">k1</em> <em class="markup--em markup--p-em">≡ k2 = k</em>，所以此时甲和乙都得到了一个约定好的密钥 <em class="markup--em markup--p-em">k</em>。DH密钥交换最大的问题是可能会存在中间人攻击的问题，在这里不再赘述。</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/f906d81188e9"><time class="dt-published" datetime="2020-08-05T16:09:10.783Z">August 5, 2020</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/%E5%AF%86%E7%A0%81%E5%AF%BC%E8%AE%BA4-%E6%95%A3%E5%88%97%E5%92%8C%E7%AD%BE%E5%90%8D-f906d81188e9" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>