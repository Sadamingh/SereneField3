<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>计算机网络3 网络层协议</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">计算机网络3 网络层协议</h1>
</header>
<section data-field="subtitle" class="p-summary">
系列：计算机网络
</section>
<section data-field="body" class="e-content">
<section name="d5a4" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="1b31" id="1b31" class="graf graf--h3 graf--leading graf--title">计算机网络3 网络层协议</h3><figure name="5865" id="5865" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*cjJgSgroJtgtXMVPTmt2WA.jpeg" data-width="2689" data-height="1513" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*cjJgSgroJtgtXMVPTmt2WA.jpeg"></figure><p name="1e7f" id="1e7f" class="graf graf--p graf-after--figure"><strong class="markup--strong markup--p-strong">一、IP协议的规定</strong></p><ol class="postList"><li name="720c" id="720c" class="graf graf--li graf-after--p">IP协议的含义</li></ol><ul class="postList"><li name="ee4f" id="ee4f" class="graf graf--li graf-after--li">ip地址将随机的，无规律的物理MAC地址统一为分段的ip地址</li><li name="fc96" id="fc96" class="graf graf--li graf-after--li">ip地址 (32位，4字节)</li></ul><p name="4a69" id="4a69" class="graf graf--p graf-after--li">2. ABCDE类ip地址</p><ul class="postList"><li name="b3e1" id="b3e1" class="graf graf--li graf-after--p">图示</li></ul><figure name="2f22" id="2f22" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="0*vxaHutkoYyiHMile.gif" data-width="512" data-height="288" src="https://cdn-images-1.medium.com/max/800/0*vxaHutkoYyiHMile.gif"></figure><ul class="postList"><li name="362a" id="362a" class="graf graf--li graf-after--figure">A类地址：32位中第一位为零，故十进制分段表示范围为：0.0.0.0（0000 0000 0000 0000 0000 0000 0000 0000）～127.255.255.255（0111 1111 1111 1111 1111 1111 1111 1111）</li><li name="a130" id="a130" class="graf graf--li graf-after--li">B类地址：32位中前两位为10，故十进制分段表示范围为：128.0.0.0（1000 0000 0000 0000 0000 0000 0000 0000）～191.255.255.255（1011 1111 1111 1111 1111 1111 1111 1111）</li><li name="b3b9" id="b3b9" class="graf graf--li graf-after--li">C类地址：32位中前三位为110，故十进制分段表示范围为：192.0.0.0（1100 0000 0000 0000 0000 0000 0000 0000）～223.255.255.255（1101 1111 1111 1111 1111 1111 1111 1111）</li><li name="f69c" id="f69c" class="graf graf--li graf-after--li">D类地址，32位中前四位为1110，故十进制分段表示范围为：224.0.0.0（1110 0000 0000 0000 0000 0000 0000 0000）～239.255.255.255（1110 1111 1111 1111 1111 1111 1111 1111）</li><li name="e6f0" id="e6f0" class="graf graf--li graf-after--li">E类地址，32位中前五位为11110，故十进制分段表示范围为：240.0.0.0（1111 0000 0000 0000 0000 0000 0000 0000）～247.255.255.255（1111 0111 1111 1111 1111 1111 1111 1111）</li></ul><p name="3f48" id="3f48" class="graf graf--p graf-after--li">3. 网络前缀：</p><ul class="postList"><li name="115e" id="115e" class="graf graf--li graf-after--p">网络前缀指的是子网掩码在第一个0前面有多少个1，也就是主机所在的网络的网络地址有多少位。</li><li name="2701" id="2701" class="graf graf--li graf-after--li">通常来说，A类地址的网络前缀为8，B类地址的网络前缀为16，C类地址的网络前缀为24。但是在给定ip地址和网络前缀的情况下，情况要另行讨论。</li></ul><p name="b8eb" id="b8eb" class="graf graf--p graf-after--li">4. 常见的保留ip地址：</p><figure name="ed26" id="ed26" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*ZQgXSfIZorNYm1QQXVRGGg.png" data-width="800" data-height="284" src="https://cdn-images-1.medium.com/max/800/1*ZQgXSfIZorNYm1QQXVRGGg.png"></figure><p name="db21" id="db21" class="graf graf--p graf-after--figure">5. 子网掩码</p><ul class="postList"><li name="800e" id="800e" class="graf graf--li graf-after--p">32位，等同于ip地址的长度。子网掩码是用来标识一个ip地址的哪些位指的是主机所在的子网。</li><li name="1604" id="1604" class="graf graf--li graf-after--li">一般来说，A类ip地址的子网掩码是255.0.0.0，B类ip地址的子网掩码为255.255.0.0，C类ip地址的子网掩码为255.255.255.0</li><li name="ef7d" id="ef7d" class="graf graf--li graf-after--li">子网掩码的作用：</li><li name="0ccf" id="0ccf" class="graf graf--li graf-after--li">a. 子网掩码最主要的作用就是将一个ip地址划分为两个部分，一个部分是网络地址，另一部分是主机地址。</li><li name="34bb" id="34bb" class="graf graf--li graf-after--li">b. 子网掩码的另一个作用是区别两个ip地址是否在同一个局域网的内部</li></ul><p name="606e" id="606e" class="graf graf--p graf-after--li">6. 网关和路由器</p><ul class="postList"><li name="c907" id="c907" class="graf graf--li graf-after--p">给定子网掩码，如果两个网络的ip地址范围不同，但是子网掩码计算所得的网络地址相同，那么这两个网络可以通过交换机或者集线器通讯</li><li name="4471" id="4471" class="graf graf--li graf-after--li">给定子网掩码，如果两个网络的ip地址范围不同，子网掩码计算所得的网络地址也不同，那么这两个网络不可以通过交换机或者集线器通讯，只能通过网关进行通讯。因此需要指定网关的ip地址。</li><li name="b5bb" id="b5bb" class="graf graf--li graf-after--li">网关既可以用于广域网的互连，又可以用于局域网的互联</li><li name="962a" id="962a" class="graf graf--li graf-after--li">网关的ip地址：网关的ip地址实际上也就是具有路由功能设备的ip地址</li><li name="8c08" id="8c08" class="graf graf--li graf-after--li">具有路由功能的设备</li><li name="43b1" id="43b1" class="graf graf--li graf-after--li">a. 路由器</li><li name="ef78" id="ef78" class="graf graf--li graf-after--li">b. 启用了路由协议的服务器（相当于一台路由器）</li><li name="559e" id="559e" class="graf graf--li graf-after--li">c. 代理服务器（也相当于一台路由器）</li></ul><p name="f59c" id="f59c" class="graf graf--p graf-after--li">7. 广播地址</p><ul class="postList"><li name="4742" id="4742" class="graf graf--li graf-after--p">广播地址指的是用于向同一个网络中所有工作站进行发送的一个地址</li><li name="288b" id="288b" class="graf graf--li graf-after--li">广播地址要求，除了网络地址之外的所有位都需要为1</li></ul><p name="2710" id="2710" class="graf graf--p graf-after--li">8. 根据子网掩码求网络地址位数和主机地址位数</p><ul class="postList"><li name="6793" id="6793" class="graf graf--li graf-after--p">将子网掩码换为二进制</li><li name="a63d" id="a63d" class="graf graf--li graf-after--li">网络地址位数 = 所有1的数量</li><li name="7254" id="7254" class="graf graf--li graf-after--li">主机地址位数 = 所有0的数量</li></ul><p name="3285" id="3285" class="graf graf--p graf-after--li">9. 根据子网掩码求主机数</p><ul class="postList"><li name="44cb" id="44cb" class="graf graf--li graf-after--p">主机数 = 2^（主机地址位数）- 2</li><li name="e681" id="e681" class="graf graf--li graf-after--li">-2的原因：</li><li name="91a1" id="91a1" class="graf graf--li graf-after--li">a. 主机地址全为0时是网络地址</li><li name="fe06" id="fe06" class="graf graf--li graf-after--li">b. 主机地址全为1时是广播地址</li></ul><p name="8e33" id="8e33" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">二、IP报文</strong></p><ol class="postList"><li name="2571" id="2571" class="graf graf--li graf-after--p">IP报文格式图</li></ol><figure name="8ecd" id="8ecd" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="0*bpad7VWLQiRaiiIc.png" data-width="750" data-height="573" src="https://cdn-images-1.medium.com/max/800/0*bpad7VWLQiRaiiIc.png"></figure><p name="e86e" id="e86e" class="graf graf--p graf-after--figure">2. IP报文首部</p><ul class="postList"><li name="eaf3" id="eaf3" class="graf graf--li graf-after--p">一般来说，在没有可选option字段的条件下，IP报文的首部最小为20字节，最大可为60字节</li></ul><p name="6ddd" id="6ddd" class="graf graf--p graf-after--li">3. 版本号Version字段：</p><ul class="postList"><li name="2b00" id="2b00" class="graf graf--li graf-after--p">4字节</li><li name="08e8" id="08e8" class="graf graf--li graf-after--li">表示ip协议版本</li><li name="d736" id="d736" class="graf graf--li graf-after--li">值4表示ipv4</li><li name="83be" id="83be" class="graf graf--li graf-after--li">值6表示ipv6</li></ul><p name="ddb5" id="ddb5" class="graf graf--p graf-after--li">4. 首部长度IHL字段</p><ul class="postList"><li name="493b" id="493b" class="graf graf--li graf-after--p">4字节</li><li name="55e1" id="55e1" class="graf graf--li graf-after--li">最小值为5（0101），最大值为15（1111）</li><li name="6de0" id="6de0" class="graf graf--li graf-after--li">单位为4字节32位</li><li name="2bca" id="2bca" class="graf graf--li graf-after--li">首部最小为20字节，最大为60字节</li></ul><p name="8dec" id="8dec" class="graf graf--p graf-after--li">5. 服务类型Type of Service字段：</p><ul class="postList"><li name="88d8" id="88d8" class="graf graf--li graf-after--p">不常用，大部分路由器会直接填充0000 0000</li><li name="db05" id="db05" class="graf graf--li graf-after--li">目前只在QoS（服务质量）技术上存在应用。</li></ul><p name="e313" id="e313" class="graf graf--p graf-after--li">6. 总长度Total Length字段</p><ul class="postList"><li name="9285" id="9285" class="graf graf--li graf-after--p">16字节，单位是字节</li><li name="30e9" id="30e9" class="graf graf--li graf-after--li">最多可以传送65535</li></ul><p name="9590" id="9590" class="graf graf--p graf-after--li">7. 序列号Identification（16位分片标志）字段</p><ul class="postList"><li name="111e" id="111e" class="graf graf--li graf-after--p">16字节，储存数值用于在ip分片时进行排序标识，接收端利用这些数值重组为原始消息。</li></ul><p name="e570" id="e570" class="graf graf--p graf-after--li">8. 标志Flags字段</p><ul class="postList"><li name="7f89" id="7f89" class="graf graf--li graf-after--p">3位，表示的是分段的可能性。</li><li name="16eb" id="16eb" class="graf graf--li graf-after--li">第一位无意义，总是为0（目的是为了占位）。</li><li name="327d" id="327d" class="graf graf--li graf-after--li">第二位为不允许分片位DF（DF不分片标志），0表示允许，1表示不允许</li><li name="afba" id="afba" class="graf graf--li graf-after--li">第三位为更多分片位MF（MF更多分片标志），1表示有更多分片发送或者传输，0表示没有更多分片在发送或者传输或者数据字段根本没有进行分片</li></ul><p name="4fa6" id="4fa6" class="graf graf--p graf-after--li">9. 段偏移Fragment Offset（13位片偏移）字段</p><ul class="postList"><li name="7744" id="7744" class="graf graf--li graf-after--p">13位字段，表示一个数值，该数值被赋予每个连续的分段</li><li name="39ba" id="39ba" class="graf graf--li graf-after--li">目的设备的 IP 利用这个值以正确的次序重组分段。</li></ul><p name="0e46" id="0e46" class="graf graf--p graf-after--li">10. 生存时间TTL（8位生存时间TTL）字段</p><ul class="postList"><li name="42c7" id="42c7" class="graf graf--li graf-after--p">8位</li><li name="7978" id="7978" class="graf graf--li graf-after--li">分为保留时间和路由器跳数两种</li><li name="773e" id="773e" class="graf graf--li graf-after--li">目的：为了防止数据报文在网络中无休止的流动</li><li name="166f" id="166f" class="graf graf--li graf-after--li">保留时间：表示这个IP报文在被抛弃之前能被保留的时间（以秒作为单位），每个路由器都会检查这一字段，然后将这个字段减去在路由器中滞留的时间（以秒为单位）。当这一字段归0时抛弃，并且发送ICMP报文通知主机。</li><li name="f6ed" id="f6ed" class="graf graf--li graf-after--li">路由器跳数：表示这个IP报文在被抛弃之前能够被保留的路由器跳数，每个路由器都会检查这一字段，每次经过一个路由器，该字段减1。当这一字段归0时抛弃，并且发送ICMP报文通知主机。</li></ul><p name="6e69" id="6e69" class="graf graf--p graf-after--li">11. 协议Protocol字段</p><ul class="postList"><li name="e0e3" id="e0e3" class="graf graf--li graf-after--p">8位字段</li><li name="b7e4" id="b7e4" class="graf graf--li graf-after--li">表示接受字段的数据载荷（上层）协议</li><li name="c09b" id="c09b" class="graf graf--li graf-after--li">值1 = ICMP协议</li><li name="0bf4" id="0bf4" class="graf graf--li graf-after--li">值6 = TCP协议</li><li name="7d06" id="7d06" class="graf graf--li graf-after--li">值17 = UDP协议</li></ul><p name="8ff2" id="8ff2" class="graf graf--p graf-after--li">12. 首部校验和Header Checksum（16位首部检验和）字段</p><ul class="postList"><li name="df9c" id="df9c" class="graf graf--li graf-after--p">16位字段</li><li name="d815" id="d815" class="graf graf--li graf-after--li">用于检查IP首部的信息是否有效</li><li name="91cd" id="91cd" class="graf graf--li graf-after--li">数据报文经过每个路由器时这个字段都会被重新计算，因为TTL字段的数值是在不断变化的。</li></ul><p name="2203" id="2203" class="graf graf--p graf-after--li">13. 发送者IP地址Source IP Address字段：</p><ul class="postList"><li name="1141" id="1141" class="graf graf--li graf-after--p">32位字段包括了当前IP报文的发送者IP地址</li></ul><p name="9447" id="9447" class="graf graf--p graf-after--li">14. 接收者IP地址Destination IP Address字段：</p><ul class="postList"><li name="fe69" id="fe69" class="graf graf--li graf-after--p">32位字段包括了当前IP报文的发送者IP地址</li></ul><p name="ca7d" id="ca7d" class="graf graf--p graf-after--li">15. 可选参数IP Options字段：</p><ul class="postList"><li name="684e" id="684e" class="graf graf--li graf-after--p">主要用于安全和测试的目的</li><li name="57ff" id="57ff" class="graf graf--li graf-after--li">填充Padding：由于可选参数的数量不是固定的，因此可能需要填充一些0</li></ul><p name="c063" id="c063" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">三、IP分片规则</strong></p><ol class="postList"><li name="b54b" id="b54b" class="graf graf--li graf-after--p">IP分片条件：</li></ol><ul class="postList"><li name="df27" id="df27" class="graf graf--li graf-after--li">IP数据报总长度&gt;MTU值 =&gt; IP分片</li></ul><p name="ac74" id="ac74" class="graf graf--p graf-after--li">2. IP分片发生的位置：</p><ul class="postList"><li name="d478" id="d478" class="graf graf--li graf-after--p">IP分片的发生可能发生在源主机上，也可能发生在路由器上。</li><li name="2686" id="2686" class="graf graf--li graf-after--li">后者主要是因为在不同网络间发送信息的时候，可能会遇到非以太网协议，也就是MTU的值可能小于1500字节，因此需要对已经发送的报文再进行分片</li><li name="9328" id="9328" class="graf graf--li graf-after--li">IP片的重组只发生在目的主机上</li></ul><p name="d8e6" id="d8e6" class="graf graf--p graf-after--li">3. IP分片的过程举例</p><ul class="postList"><li name="36c8" id="36c8" class="graf graf--li graf-after--p">由于以太网帧的数据字段最大长度MTU为1500字节，因此通过以太网传输的ip报文总长度不能超过1500字节</li><li name="dc82" id="dc82" class="graf graf--li graf-after--li">假设发送的ip协议不包括可选参数，那么ip协议头部包括了从版本号到32位目的地址的全部内容，总计长度为160位，20字节</li><li name="d31f" id="d31f" class="graf graf--li graf-after--li">因此，通过ip协议发送的数据报的实际有效大小为1500–20=1480字节</li><li name="fe50" id="fe50" class="graf graf--li graf-after--li">如果使用以太网协议发送一个长度为1501字节的数据报，已知数据报的长度&gt;MTU=1500，因此需要对这一数据报进行分片</li><li name="584f" id="584f" class="graf graf--li graf-after--li">假设这里采用的是ICMP协议，那么在第一个数据报里，1480字节的最大长度中，ICMP协议头部占据8字节，剩余大小为1472字节，剩余数据量为1473字节，因此对数据进行分片</li><li name="28a1" id="28a1" class="graf graf--li graf-after--li">a. 第一个IP分片：一个以太网帧，以太网帧数据部分（最大1500字节）包括20字节的ip报头和ip帧数据部分共1480字节，其中8字节为ICMP协议报头，DF=0，MF=1</li><li name="ae3d" id="ae3d" class="graf graf--li graf-after--li">b. 第二个IP分片：一个以太网帧，以太网帧数据部分（最大1500字节）包括20字节的ip报头和ip帧数据部分共1字节，无ICMP协议报头，DF=0，MF=0</li></ul><figure name="ac97" id="ac97" class="graf graf--figure graf-after--li"><img class="graf-image" data-image-id="1*gGF8qXT2Wpf4UXc0aBcUvA.png" data-width="1230" data-height="488" src="https://cdn-images-1.medium.com/max/800/1*gGF8qXT2Wpf4UXc0aBcUvA.png"></figure><p name="8cae" id="8cae" class="graf graf--p graf-after--figure">4. 避免IP分片</p><ul class="postList"><li name="b5ce" id="b5ce" class="graf graf--li graf-after--p">避免ip分片的原因：ip层面不设有超时重传机制，因此当ip报文的某个分片被丢弃时，只能依赖于传输层进行重传，结果是所有的ip分片都会被重新传递一次，浪费效率</li><li name="6e23" id="6e23" class="graf graf--li graf-after--li">应用层限制：对于UDP包，我们需要在应用层强行限制每个包的大小不要超过1472字节（UDP协议的首部也是8字节）</li><li name="845d" id="845d" class="graf graf--li graf-after--li">传输层限制：对于TCP包，我们在传输层已经对包的大小进行了限制，在建立三次握手的过程中，连接双方会通报最大报文段长度MSS。双方每次发送的TCP数据都不会超过双方最小的MSS值。MSS的值一般被设计为1460（TCP协议的首部是20字节）</li></ul><p name="0acd" id="0acd" class="graf graf--p graf-after--li">5. 确定IP分片的顺序</p><ul class="postList"><li name="20ad" id="20ad" class="graf graf--li graf-after--p">首先，根据ip协议的内容，各个ip分片的到达是乱序的</li><li name="5b8c" id="5b8c" class="graf graf--li graf-after--li">​如何判断一个ip报文是否是一个分片？如果观察到DF标志位的值为1，则该ip报文未发生分片。如果DF标志位的值为0，则发生分片。</li><li name="946c" id="946c" class="graf graf--li graf-after--li">如何判断一个DF=0的ip报文是最后一个分片？如果观察到MF标志位的值为1，则不是最后一个分片，如果MF标志位的值为0，则是最后一个分片。</li><li name="2878" id="2878" class="graf graf--li graf-after--li">如何确定两个分片来源于同一个数据报？如果接收方收到两个ip报文，这两个报文具有相同的序列号字段，那么可以认为这两个ip报文是同一个数据报的两个分片。</li><li name="1648" id="1648" class="graf graf--li graf-after--li">如何判断分片的重组顺序？段偏移（片偏移）字段表示的是ip报文的某个分片数据部分的第一位相对于数据报开始处的偏移量。</li></ul><p name="57df" id="57df" class="graf graf--p graf-after--li">6. 数据接收端如何确认所有分片都到达</p><ul class="postList"><li name="8132" id="8132" class="graf graf--li graf-after--p">数据接收端会检查片偏移</li><li name="8d74" id="8d74" class="graf graf--li graf-after--li">如果片偏移的数值除去最后一个ip片之外，总存在两个ip片相差1480字节（ip协议下），那么即确认所有分片到达</li></ul><p name="71f2" id="71f2" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">四、IP选路规则</strong></p><ol class="postList"><li name="195d" id="195d" class="graf graf--li graf-after--p">主机查询路由表</li></ol><ul class="postList"><li name="39ce" id="39ce" class="graf graf--li graf-after--li">route print 指令用于在window系统下用来打印ip路径</li><li name="49eb" id="49eb" class="graf graf--li graf-after--li">netstat -rn 指令用于在MacOS系统下用来打印ip路径</li><li name="60c6" id="60c6" class="graf graf--li graf-after--li">route 指令用于在Linux系统下用来打印ip路径</li></ul><p name="13f8" id="13f8" class="graf graf--p graf-after--li">2. 路由表内各字段含义</p><ul class="postList"><li name="aa8d" id="aa8d" class="graf graf--li graf-after--p">网络终端地址字段：本地计算机可以访问的ip地址</li><li name="ff3d" id="ff3d" class="graf graf--li graf-after--li">网络掩码字段：等同于子网掩码的作用</li><li name="4aa0" id="4aa0" class="graf graf--li graf-after--li">网关字段：又叫下一跳字段，由于在一般的网络环境中，跨网通讯要经过网关，因此下一跳也就是网关</li></ul><p name="21e1" id="21e1" class="graf graf--p graf-after--li">3. IP 路由选择的过程是怎么样的?</p><ul class="postList"><li name="0f26" id="0f26" class="graf graf--li graf-after--p">根据最长匹配原则，找到条目，发送到指定的路由器。如果不能找到，返回一个“主机不可 达”或“网络不可达”的错误。</li></ul><p name="0ff7" id="0ff7" class="graf graf--p graf-after--li">4. IP 路由选择的特性有什么?</p><ul class="postList"><li name="0658" id="0658" class="graf graf--li graf-after--p">IP 路由选择是逐跳进行的。IP 并不知道到达任何目的的完整路径，只提供下一跳地址。</li><li name="16e1" id="16e1" class="graf graf--li graf-after--li">为一个网络指定一个路由器，而不是为每个主机指定一个路由器。 这样可以缩小路由表规模。</li></ul><p name="56ff" id="56ff" class="graf graf--p graf-after--li">5. IP 搜索路由表的步骤</p><ul class="postList"><li name="54fc" id="54fc" class="graf graf--li graf-after--p">Step 1: 搜索匹配的主机地址</li><li name="300f" id="300f" class="graf graf--li graf-after--li">Step 2: 搜索匹配的网络地址</li><li name="3ee4" id="3ee4" class="graf graf--li graf-after--li">Step 3: 搜索默认选项</li><li name="20c3" id="20c3" class="graf graf--li graf-after--li">IP 层进行的选路实际上是一种选路机制，它搜索路由表并决定向哪个网络接口发送分组。</li></ul><p name="3a12" id="3a12" class="graf graf--p graf-after--li">6. 如果路由表中没有默认项，而又没有找到匹配项，这时如何处理?</p><ul class="postList"><li name="247f" id="247f" class="graf graf--li graf-after--p">结果取决于该 IP 数据报是由主机产生的还是被转发的。</li><li name="17c7" id="17c7" class="graf graf--li graf-after--li">如果数据报是由本机产生的，那么就给发送该数据报的应用程序返回一个差错，或者是“主 机不可达差错”或者是“网络不可达差错”。</li><li name="55c7" id="55c7" class="graf graf--li graf-after--li">如果是被转发的数据报，就给原始发送一份 ICMP 主机不可达的差错报文。</li></ul><p name="28ba" id="28ba" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">五、其他关于IP协议的内容</strong></p><ol class="postList"><li name="83ad" id="83ad" class="graf graf--li graf-after--p">​如何理解 IP 的不可靠和无连接。</li></ol><ul class="postList"><li name="f78a" id="f78a" class="graf graf--li graf-after--li">不可靠:指的是不能保证数据报能成功地到达目的地。 发生错误时候，丢弃该数据包，发送 ICMP 消息给信源端。 可靠性由上层提供。</li><li name="f48a" id="f48a" class="graf graf--li graf-after--li">无连接:IP 不维护关于后续数据报的状态信息。体现在，IP 数据可以不按顺序发送和接收。A 发送连续的数据报，到达 B 不一定是连续的， 来回路由选择可能不一样，路线也不一样，到达先后顺序也不一样。</li></ul><p name="aa73" id="aa73" class="graf graf--p graf-after--li">2. 为什么 IP 首部中要有总长度字段?</p><ul class="postList"><li name="6f59" id="6f59" class="graf graf--li graf-after--p">因为一些数据链路(以太网)需要填充一些数据以达到最小长度。因为以太网帧的最小长度 是 46 个字节，但是 IP 长度可能更短，所以需要总长度来确定 IP 数据部分的内容。</li></ul><p name="7af0" id="7af0" class="graf graf--p graf-after--li">3. IP 首部校验和怎么计算的?</p><ul class="postList"><li name="4c7c" id="4c7c" class="graf graf--li graf-after--p">Step 1: 先把校验和字段置 0。</li><li name="2aa9" id="2aa9" class="graf graf--li graf-after--li">Step 2:对首部中每个 16 位比特进行二进制反码求和。</li><li name="dff7" id="dff7" class="graf graf--li graf-after--li">Step 3:结果存在检验和字段中。</li><li name="ffd2" id="ffd2" class="graf graf--li graf-after--li">Step 4:收到一份 IP 数据包后，同样对首部中每个 16bit 二进制反码求和。</li><li name="63be" id="63be" class="graf graf--li graf-after--li">Step 5:最后结果全为 1，表示正确，否则表示错误。</li><li name="39d9" id="39d9" class="graf graf--li graf-after--li">Step 6:如果是错误的，IP 就丢弃该数据报，但是不生成差错报文，由上层去处理。</li></ul><p name="edb5" id="edb5" class="graf graf--p graf-after--li">4. IP首部校验和与 ICMP，IGMP，TCP，UDP 的首部校验和有什么区别与共同点？</p><ul class="postList"><li name="732f" id="732f" class="graf graf--li graf-after--p">共同点:用到的算法都是一样的。</li><li name="5218" id="5218" class="graf graf--li graf-after--li">区别: IP 计算的时候没有将数据包括在内。 ICMP，IGMP，TCP，UDP同时覆盖首部和数据检验码。</li></ul><p name="0a81" id="0a81" class="graf graf--p graf-after--li">5. 主机和路由器本质区别是?</p><ul class="postList"><li name="5d38" id="5d38" class="graf graf--li graf-after--p">主机从不把数据报从一个接口转发到另一个接口</li><li name="0c3b" id="0c3b" class="graf graf--li graf-after--li">路由器则要转发数据报</li></ul><p name="c199" id="c199" class="graf graf--p graf-after--li"><strong class="markup--strong markup--p-strong">六、因特网控制报文ICMP协议</strong></p><ol class="postList"><li name="b604" id="b604" class="graf graf--li graf-after--p">特征</li></ol><ul class="postList"><li name="83e7" id="83e7" class="graf graf--li graf-after--li">是一个辅助协议</li><li name="8e66" id="8e66" class="graf graf--li graf-after--li">是网络层和传输层之间的一个协议</li></ul><p name="ac54" id="ac54" class="graf graf--p graf-after--li">2. ICMP协议的报文格式</p><figure name="99d2" id="99d2" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*wNceG_gD0kVtZg_QP630Hg.png" data-width="1230" data-height="366" src="https://cdn-images-1.medium.com/max/800/1*wNceG_gD0kVtZg_QP630Hg.png"></figure><p name="6dc6" id="6dc6" class="graf graf--p graf-after--figure">3. ICMP报文首部</p><ul class="postList"><li name="862c" id="862c" class="graf graf--li graf-after--p">类型字段：8位，表示该ICMP报文的类型，在后面的分类中会仔细讨论</li><li name="86ce" id="86ce" class="graf graf--li graf-after--li">代码字段：8位，提供针对该报文的进一步信息，一般情况下均为0，不同的code表示的报错类型相同，但是错误方式不同</li><li name="b480" id="b480" class="graf graf--li graf-after--li">校验和字段：16位，同ip校验和字段，将数据包括在内</li></ul><p name="99da" id="99da" class="graf graf--p graf-after--li">4. ICMP首部剩余部分字段：随着ICMP报文的类型不同而不同</p><ul class="postList"><li name="d115" id="d115" class="graf graf--li graf-after--p">标识符字段：用于标识本ICMP进程</li><li name="733c" id="733c" class="graf graf--li graf-after--li">序列号：用于判断回射应答的数据包</li></ul><p name="62f4" id="62f4" class="graf graf--p graf-after--li">5. ICMP报文最常见的类型：</p><ul class="postList"><li name="2ba2" id="2ba2" class="graf graf--li graf-after--p">类型8，代码0：回显请求（ping请求）</li><li name="c220" id="c220" class="graf graf--li graf-after--li">类型0，代码0：回显应答（ping应答）</li><li name="f19d" id="f19d" class="graf graf--li graf-after--li">类型11，代码0：超时</li></ul><p name="8964" id="8964" class="graf graf--p graf-after--li">6. 2种ICMP查询报文</p><ul class="postList"><li name="bea7" id="bea7" class="graf graf--li graf-after--p">类型8或0：回显请求或回显应答</li><li name="eeec" id="eeec" class="graf graf--li graf-after--li">类型13或14：时间戳请求或时间戳应答</li></ul><p name="3939" id="3939" class="graf graf--p graf-after--li">7. 5种ICMP差错报文</p><ul class="postList"><li name="ecd5" id="ecd5" class="graf graf--li graf-after--p">类型3：终点不可达</li><li name="e853" id="e853" class="graf graf--li graf-after--li">类型4：源点抑制</li><li name="6480" id="6480" class="graf graf--li graf-after--li">类型11：超时</li><li name="98dc" id="98dc" class="graf graf--li graf-after--li">类型12：参数问题</li><li name="f935" id="f935" class="graf graf--li graf-after--li">类型5：改变路由</li></ul><p name="3283" id="3283" class="graf graf--p graf-after--li">8. 具体的ICMP报文分类表</p><figure name="8c42" id="8c42" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*YPU7_N5eh8JVbfBBSw-FiA.png" data-width="1026" data-height="1006" src="https://cdn-images-1.medium.com/max/800/1*YPU7_N5eh8JVbfBBSw-FiA.png"></figure><figure name="e8d0" id="e8d0" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*ZOqbyA8QkVp-J1OkRG33XA.png" data-width="1026" data-height="602" src="https://cdn-images-1.medium.com/max/800/1*ZOqbyA8QkVp-J1OkRG33XA.png"></figure><p name="c7cf" id="c7cf" class="graf graf--p graf-after--figure">9. ICMP 的主机不可达报文是在什么情况下发出的?</p><ul class="postList"><li name="5902" id="5902" class="graf graf--li graf-after--p">三层设备(路由器)给该主机寻路时，没有找到相应路径</li><li name="d41c" id="d41c" class="graf graf--li graf-after--li">向源 IP 发回 ICMP 主机不可达</li></ul><p name="c809" id="c809" class="graf graf--p graf-after--li">10. 什么情况不会导致产生 ICMP 差错报文?</p><ul class="postList"><li name="a1d1" id="a1d1" class="graf graf--li graf-after--p">ICMP 差错报文</li><li name="fec5" id="fec5" class="graf graf--li graf-after--li">目的地址是广播地址或者多播地址的 IP 数据报</li><li name="7e21" id="7e21" class="graf graf--li graf-after--li">链路层广播的数据报</li><li name="7e3b" id="7e3b" class="graf graf--li graf-after--li">不是 IP 分片的第一片</li><li name="bd62" id="bd62" class="graf graf--li graf-after--li">源地址不是单个主机的数据包</li></ul><p name="bc30" id="bc30" class="graf graf--p graf-after--li">11. ICMP重定向差错报文是什么？如何出现？</p><ul class="postList"><li name="acf8" id="acf8" class="graf graf--li graf-after--p">主机发送 IP 数据报给 R1，因为主机的默认路由指向的下一跳是 R1。</li><li name="62e7" id="62e7" class="graf graf--li graf-after--li">R1 收到数据报并且检查它的路由表，发现 R2 是发送该数据报的下一跳。当他将数据报发送给 R2 的时候，发现发送的接口与接受的端口是一样的，因此同时发送一 个 ICMP 重定向报文给主机。</li><li name="2e54" id="2e54" class="graf graf--li graf-after--li">R1 接受到 ICMP 重定向报文后，接下来的数据报就发送给 R2，而不再发送给 R1。</li></ul><p name="ea31" id="ea31" class="graf graf--p graf-after--li">12. 重定向报文有什么规则？</p><ul class="postList"><li name="4549" id="4549" class="graf graf--li graf-after--p">重定向报文只有路由器能生成</li><li name="aabf" id="aabf" class="graf graf--li graf-after--li graf--trailing">重定向报文是为主机而不是为路由器使用的</li></ul></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@adamedelweiss" class="p-author h-card">Adam Edelweiss</a> on <a href="https://medium.com/p/37473cc694df"><time class="dt-published" datetime="2020-04-24T19:36:54.911Z">April 24, 2020</time></a>.</p><p><a href="https://medium.com/@adamedelweiss/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C3-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE-37473cc694df" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on December 15, 2021.</p></footer></article></body></html>