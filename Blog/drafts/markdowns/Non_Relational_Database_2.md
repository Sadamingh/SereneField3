### Non-Relational Database 2 | Basic MongoDB Concepts and CRUD Operations

![mongodb](../../image/mongodb.png)

#### 1. Basics of MongoDB

**(1) The Definition of Documents**

A record in a MongoDB collection and the basic unit of data in MongoDB. Documents are analogous to JSON objects but exist in the database in a more type-rich format known as BSON.

**(2) The Definition of Collections**

A grouping of MongoDB documents. A collection is the equivalent of an RDBMS table.

**(3) The Definition of Fields**

A name-value pair in a document. A document has zero or more fields. Fields are analogous to columns in relational databases. For example, a certain MongoDB document will be seen as follows, 

```JSON
{
   field1: value1,
   field2: value2,
   field3: value3,
   ...
   fieldN: valueN
}
```

**(4) Reasons for MongoDB**

* Ease of use: schemaless
* Ease of scaling: can be used for distributed computing
* Supports many features:
  * CRUD
  * Indexing
  * Aggregration Pipeline
  * File storage
  * Etc.
* Suports many languages/drivers

**(5) Data Type of MongoDB**

* NULL
* Boolean
* Number: 8-byte double-precision float `Number()`, 4-byte integer `NumberInt()`, 8-byte integer`NumberLong()`
* String
* Date: new `Date()`
* Array: can have different types of elements with **atomic updates**
* Embedded Documents
* Object ID: 12-byte autogenerated ID with field `_id`, every document must have this field
* Binary data
* JavaScript Code

#### 2. Mongo DB Operations

**(0) External Operations**

* Start service

```bash
$ mongod --dbpath=<path>
```

* Import  JSON data file

```
$ mongoimport --db <DBname> --collection <collectionname> --file <filepath>
```

Note that this command requires `mongo-tools`,

```
$ conda install mongo-tools
```

We can also select the mode by option `--mode` between `insert` (means to allow duplicate) or `upsert` (means to update duplicate).

**(1) Creation**

* Create/Choose `database_name`

```js
use database_name
```

* Create `collection_name`

```
db.createCollection(collection_name)
```

* Create a document `doc_name` in collection `collection_name`

```
db.collection_name.insertOne(doc_name)
```

* Create a documents `doc_name_1` and `doc_name_2` in collection `collection_name`

```
db.collection_name.insertMany([doc_name_1, doc_name_2])
```

* Check the current database

```
db
```

**(2) Read**

* Return all documents match the rule `{"field" : value}`

```
db.collection_name.find({"field" : value})
```

* Return all documents match the rule `{"field_1" : value}` without returning `field_2`

```
db.collection_name.find({"field_1" : value}, {"field_2" : false})
```

* Return one document match the rule `{"field" : value}`

```
db.collection_name.findOne({"field" : value})
```

* Return all documents match the rule `{"field_1" : value}` without returning `field_2`

```
db.collection_name.findOne({"field_1" : value}, {"field_2" : false})
```

* Count the number of documents under `collection_name`

```
db.collection_name.count()
```

**(3) Update**

* Note if we need to create a new document if no current document match the matching rule, we have to set the third argument of method `updateOne` or `updateMany` to `{upsert : true}`

* Set/Create the value of `field_new` as `value_new` in one document matching rule `{"field" : value}`

```
db.collection_name.updateOne({"field" : value}, {$set : {"field_new" : value_new}})
```

* Set/Create the value of `field_new` as `value_new` in all documents matching rule `{"field" : value}`

```
db.collection_name.updateMany({"field" : value}, {$set : {"field_new" : value_new}})
```

* Delete field `field_del` in one document matching rule `{"field" : value}`

```
db.collection_name.updateOne({"field" : value}, {$unset : {"field_del" : ""}})
```

* Delete field `field_del` in all documents matching rule `{"field" : value}`

```
db.collection_name.updateMany({"field" : value}, {$unset : {"field_del" : ""}})
```

* Increase field `field_inc` by 5 in all document matching rule `{"field" : value}`

```
db.collection_name.updateMany({"field" : value}, {$inc : {"field_inc" : 5}})
```

* Rename a field `field_1` to `field_2` in all documents

```
db.collection_name.updateMany({}, {$rename : {"field_1" : "field_2"}})
```

* Make a field `field_min` **no more than** 5 in all documents

```
db.collection_name.updateMany({}, {$min : {"field_min" : 5}})
// 6 -> 5
// 4 -> 4
```

* Make a field `field_max` **no less than** 5 in all documents

```
db.collection_name.updateMany({}, {$max : {"field_max" : 5}})
// 6 -> 6
// 4 -> 5
```

* Add `element` to the end of the array value of field `field_array` in all documents

```
db.collection_name.updateMany({}, {$push : {"field_array" : element}})
```

* Remove the first element in the array value of field `field_array` in all documents

```
db.collection_name.updateMany({}, {$pop : {"field_array" : -1}})
```

* Remove the last element in the array value of field `field_array` in all documents

```
db.collection_name.updateMany({}, {$pop : {"field_array" : 1}})
```

* Remove a certain element `element` in the array value of field `field_array` in all documents

```
db.collection_name.updateMany({}, {$pull : {"field_array" : element}})
```

* Update the first element to `10` in the array value of field `field_array` in all documents

```
db.collection_name.updateMany({}, {$set : {"field_array.$" : 10}})
```

* Update all the elements to `10` in the array value of field `field_array` in all documents

```
db.collection_name.updateMany({}, {$set : {"field_array.$[]" : 10}})
```

* Update all the document elements  with `element.score = 5` to `10` in the array value of field `field_array` in all documents

```
db.collection_name.updateMany({},
															{$set : {"field_array.$[element].score" : 10}},
															{arrayFilters : [ {"element.score" : 5} ]})
```

**(4) Delete**

* Remove one document with `{"field" : value}`

```
db.collection_name.deleteOne({"field" : value})
```

* Remove all the documents with `{"field" : value}`

```
db.collection_name.deleteMany({"field" : value})
```

* Remove the collection `collection_name`

``````
db.collection_name.drop()
``````